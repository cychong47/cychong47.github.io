<!doctype html><html lang=en-us><head><meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Play with Ansible | Keep calm and Write something</title><meta name=title content="Play with Ansible"><meta name=description content='Configuration

ansible client A
ansible target B, C

In client
Ansible targets(B,C) should be listed in the following file. If required additional parameters can be specified such as login account, ssh port and etc
# /etc/ansible/hosts

192.168.1.100 ansible_ssh_user=cychong ansible_ssh_port=22
192.168.1.200 ansible_ssh_user=cychong ansible_ssh_port=22
In ansible targets
A should be found on the following file
# grep A .ssh/authorized_keys

Test run from A
# ansible all -m ping
192.168.1.200 | SUCCESS => {
    "changed": false, 
    "failed": false, 
    "ping": "pong"
}
192.168.1.100 | SUCCESS => {
    "changed": false, 
    "failed": false, 
    "ping": "pong"
}
Test run from A #2
mbpr15:~ cychong$ ansible all -a "/usr/bin/du -hs Downloads"
192.168.1.100 | SUCCESS | rc=0 >>
 20G	Downloads

192.168.1.200 | SUCCESS | rc=0 >>
 11G	Downloads
Test run from A #3
mbpr15:~ cychong$ ansible all -a "/bin/df -h ."
192.168.1.200 | SUCCESS | rc=0 >>
Filesystem     Size   Used  Avail Capacity iused               ifree %iused  Mounted on
/dev/disk2s1  119Gi  103Gi   12Gi    90% 1178609 9223372036853597198    0%   /

192.168.1.100 | SUCCESS | rc=0 >>
Filesystem     Size   Used  Avail Capacity  iused    ifree %iused  Mounted on
/dev/disk0s2  115Gi   58Gi   57Gi    51% 15210230 14862623   51%   /
How ansible works

Playbooks contain plays
Play contain taks
Task call modules
Taks run sequentially
Handlers are triggered by task, and run once at the end of play

Playbooks

YAML files describes the desired state of something

Modules
list up all modules
$ ansible-doc -l 
Show man-page of a specific module
$ ansible-doc MODULE_NAME
$ ansible-doc homebrew  
Inventories

Statc lines of servers
ranges
dynamic list of servers : AWS, Azure, GCP

/etc/ansible/hosts'><meta name=keywords content="ansible,automation,"><meta property="og:url" content="https://cychong47.github.io/post/2017/ansible/"><meta property="og:site_name" content="Keep calm and Write something"><meta property="og:title" content="Play with Ansible"><meta property="og:description" content='Configuration ansible client A ansible target B, C In client Ansible targets(B,C) should be listed in the following file. If required additional parameters can be specified such as login account, ssh port and etc
# /etc/ansible/hosts 192.168.1.100 ansible_ssh_user=cychong ansible_ssh_port=22 192.168.1.200 ansible_ssh_user=cychong ansible_ssh_port=22 In ansible targets A should be found on the following file
# grep A .ssh/authorized_keys Test run from A # ansible all -m ping 192.168.1.200 | SUCCESS => { "changed": false, "failed": false, "ping": "pong" } 192.168.1.100 | SUCCESS => { "changed": false, "failed": false, "ping": "pong" } Test run from A #2 mbpr15:~ cychong$ ansible all -a "/usr/bin/du -hs Downloads" 192.168.1.100 | SUCCESS | rc=0 >> 20G	Downloads 192.168.1.200 | SUCCESS | rc=0 >> 11G	Downloads Test run from A #3 mbpr15:~ cychong$ ansible all -a "/bin/df -h ." 192.168.1.200 | SUCCESS | rc=0 >> Filesystem Size Used Avail Capacity iused ifree %iused Mounted on /dev/disk2s1 119Gi 103Gi 12Gi 90% 1178609 9223372036853597198 0% / 192.168.1.100 | SUCCESS | rc=0 >> Filesystem Size Used Avail Capacity iused ifree %iused Mounted on /dev/disk0s2 115Gi 58Gi 57Gi 51% 15210230 14862623 51% / How ansible works Playbooks contain plays Play contain taks Task call modules Taks run sequentially Handlers are triggered by task, and run once at the end of play Playbooks YAML files describes the desired state of something Modules list up all modules $ ansible-doc -l Show man-page of a specific module $ ansible-doc MODULE_NAME $ ansible-doc homebrew Inventories Statc lines of servers ranges dynamic list of servers : AWS, Azure, GCP /etc/ansible/hosts'><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2017-10-04T00:22:48+09:00"><meta property="article:modified_time" content="2018-04-01T02:38:51+00:00"><meta property="article:tag" content="Ansible"><meta property="article:tag" content="Automation"><meta name=twitter:card content="summary"><meta name=twitter:title content="Play with Ansible"><meta name=twitter:description content='Configuration ansible client A ansible target B, C In client Ansible targets(B,C) should be listed in the following file. If required additional parameters can be specified such as login account, ssh port and etc
# /etc/ansible/hosts 192.168.1.100 ansible_ssh_user=cychong ansible_ssh_port=22 192.168.1.200 ansible_ssh_user=cychong ansible_ssh_port=22 In ansible targets A should be found on the following file
# grep A .ssh/authorized_keys Test run from A # ansible all -m ping 192.168.1.200 | SUCCESS => { "changed": false, "failed": false, "ping": "pong" } 192.168.1.100 | SUCCESS => { "changed": false, "failed": false, "ping": "pong" } Test run from A #2 mbpr15:~ cychong$ ansible all -a "/usr/bin/du -hs Downloads" 192.168.1.100 | SUCCESS | rc=0 >> 20G	Downloads 192.168.1.200 | SUCCESS | rc=0 >> 11G	Downloads Test run from A #3 mbpr15:~ cychong$ ansible all -a "/bin/df -h ." 192.168.1.200 | SUCCESS | rc=0 >> Filesystem Size Used Avail Capacity iused ifree %iused Mounted on /dev/disk2s1 119Gi 103Gi 12Gi 90% 1178609 9223372036853597198 0% / 192.168.1.100 | SUCCESS | rc=0 >> Filesystem Size Used Avail Capacity iused ifree %iused Mounted on /dev/disk0s2 115Gi 58Gi 57Gi 51% 15210230 14862623 51% / How ansible works Playbooks contain plays Play contain taks Task call modules Taks run sequentially Handlers are triggered by task, and run once at the end of play Playbooks YAML files describes the desired state of something Modules list up all modules $ ansible-doc -l Show man-page of a specific module $ ansible-doc MODULE_NAME $ ansible-doc homebrew Inventories Statc lines of servers ranges dynamic list of servers : AWS, Azure, GCP /etc/ansible/hosts'><meta itemprop=name content="Play with Ansible"><meta itemprop=description content='Configuration ansible client A ansible target B, C In client Ansible targets(B,C) should be listed in the following file. If required additional parameters can be specified such as login account, ssh port and etc
# /etc/ansible/hosts 192.168.1.100 ansible_ssh_user=cychong ansible_ssh_port=22 192.168.1.200 ansible_ssh_user=cychong ansible_ssh_port=22 In ansible targets A should be found on the following file
# grep A .ssh/authorized_keys Test run from A # ansible all -m ping 192.168.1.200 | SUCCESS => { "changed": false, "failed": false, "ping": "pong" } 192.168.1.100 | SUCCESS => { "changed": false, "failed": false, "ping": "pong" } Test run from A #2 mbpr15:~ cychong$ ansible all -a "/usr/bin/du -hs Downloads" 192.168.1.100 | SUCCESS | rc=0 >> 20G	Downloads 192.168.1.200 | SUCCESS | rc=0 >> 11G	Downloads Test run from A #3 mbpr15:~ cychong$ ansible all -a "/bin/df -h ." 192.168.1.200 | SUCCESS | rc=0 >> Filesystem Size Used Avail Capacity iused ifree %iused Mounted on /dev/disk2s1 119Gi 103Gi 12Gi 90% 1178609 9223372036853597198 0% / 192.168.1.100 | SUCCESS | rc=0 >> Filesystem Size Used Avail Capacity iused ifree %iused Mounted on /dev/disk0s2 115Gi 58Gi 57Gi 51% 15210230 14862623 51% / How ansible works Playbooks contain plays Play contain taks Task call modules Taks run sequentially Handlers are triggered by task, and run once at the end of play Playbooks YAML files describes the desired state of something Modules list up all modules $ ansible-doc -l Show man-page of a specific module $ ansible-doc MODULE_NAME $ ansible-doc homebrew Inventories Statc lines of servers ranges dynamic list of servers : AWS, Azure, GCP /etc/ansible/hosts'><meta itemprop=datePublished content="2017-10-04T00:22:48+09:00"><meta itemprop=dateModified content="2018-04-01T02:38:51+00:00"><meta itemprop=wordCount content="723"><meta itemprop=keywords content="Ansible,Automation"><meta name=referrer content="no-referrer-when-downgrade"><style>:root{--width:720px;--font-main:Verdana, sans-serif;--font-secondary:Verdana, sans-serif;--font-scale:1em;--background-color:#fafafa;--heading-color:#222;--text-color:#444;--link-color:#3273dc;--visited-color:#8b6fcb;--blockquote-color:#222}@media(prefers-color-scheme:dark){:root{--background-color:#fafafa;--heading-color:#222;--text-color:#444;--link-color:#3273dc;--visited-color:#8b6fcb;--blockquote-color:#222}}body{font-family:var(--font-secondary);font-size:var(--font-scale);margin:auto;padding:20px;max-width:var(--width);text-align:left;background-color:var(--background-color);word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:var(--text-color)}h1,h2,h3,h4,h5,h6{font-family:var(--font-main);color:var(--heading-color)}a{color:var(--link-color);cursor:pointer;text-decoration:none}a:hover{text-decoration:underline}nav a{margin-right:8px}strong,b{color:var(--heading-color)}button{margin:0;cursor:pointer}time{font-family:monospace;font-style:normal;font-size:15px}main{line-height:1.6}table{width:100%}hr{border:0;border-top:1px dashed}img{max-width:100%}code{font-family:monospace;padding:2px;border-radius:3px}blockquote{border-left:1px solid #999;color:var(--blockquote-color);padding-left:20px;font-style:italic}footer{padding:25px 0;text-align:center}.title:hover{text-decoration:none}.title h1{font-size:1.5em}.inline{width:auto!important}.highlight,.code{border-radius:3px;margin-block-start:1em;margin-block-end:1em;overflow-x:auto}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:var(--visited-color)}</style></head><body><header><a href=/ class=title><h2>Keep calm and Write something</h2></a><nav><a href=/post/>Post</a>
<a href=/page/>Page</a>
<a href=/series/>Series</a>
<a href=/tags/>Tag</a>
<a href=/archive/>Archive</a>
<a href=/search/>Search</a></nav></header><main><content><h1 id=configuration>Configuration</h1><ul><li>ansible client A</li><li>ansible target B, C</li></ul><h2 id=in-client>In client</h2><p>Ansible targets(B,C) should be listed in the following file. If required additional parameters can be specified such as login account, ssh port and etc</p><pre><code># /etc/ansible/hosts
</code></pre><pre tabindex=0><code>192.168.1.100 ansible_ssh_user=cychong ansible_ssh_port=22
192.168.1.200 ansible_ssh_user=cychong ansible_ssh_port=22
</code></pre><h2 id=in-ansible-targets>In ansible targets</h2><p>A should be found on the following file</p><pre><code># grep A .ssh/authorized_keys
</code></pre><h2 id=test-run-from-a>Test run from A</h2><pre tabindex=0><code># ansible all -m ping
192.168.1.200 | SUCCESS =&gt; {
    &#34;changed&#34;: false, 
    &#34;failed&#34;: false, 
    &#34;ping&#34;: &#34;pong&#34;
}
192.168.1.100 | SUCCESS =&gt; {
    &#34;changed&#34;: false, 
    &#34;failed&#34;: false, 
    &#34;ping&#34;: &#34;pong&#34;
}
</code></pre><h2 id=test-run-from-a-2>Test run from A #2</h2><pre tabindex=0><code>mbpr15:~ cychong$ ansible all -a &#34;/usr/bin/du -hs Downloads&#34;
192.168.1.100 | SUCCESS | rc=0 &gt;&gt;
 20G	Downloads

192.168.1.200 | SUCCESS | rc=0 &gt;&gt;
 11G	Downloads
</code></pre><h2 id=test-run-from-a-3>Test run from A #3</h2><pre tabindex=0><code>mbpr15:~ cychong$ ansible all -a &#34;/bin/df -h .&#34;
192.168.1.200 | SUCCESS | rc=0 &gt;&gt;
Filesystem     Size   Used  Avail Capacity iused               ifree %iused  Mounted on
/dev/disk2s1  119Gi  103Gi   12Gi    90% 1178609 9223372036853597198    0%   /

192.168.1.100 | SUCCESS | rc=0 &gt;&gt;
Filesystem     Size   Used  Avail Capacity  iused    ifree %iused  Mounted on
/dev/disk0s2  115Gi   58Gi   57Gi    51% 15210230 14862623   51%   /
</code></pre><h1 id=how-ansible-works>How ansible works</h1><ul><li>Playbooks contain plays</li><li>Play contain taks</li><li>Task call modules</li><li>Taks run sequentially</li><li>Handlers are triggered by task, and run once at the end of play</li></ul><h2 id=playbooks>Playbooks</h2><ul><li>YAML files describes the desired state of something</li></ul><h2 id=modules>Modules</h2><h3 id=list-up-all-modules>list up all modules</h3><pre tabindex=0><code>$ ansible-doc -l 
</code></pre><h3 id=show-man-page-of-a-specific-module>Show man-page of a specific module</h3><pre tabindex=0><code>$ ansible-doc MODULE_NAME
$ ansible-doc homebrew  
</code></pre><h2 id=inventories>Inventories</h2><ul><li>Statc lines of servers</li><li>ranges</li><li>dynamic list of servers : AWS, Azure, GCP</li></ul><p><code>/etc/ansible/hosts</code></p><pre tabindex=0><code>mini1 ansible_host=192.168.1.100 ansible_ssh_user=cychong ansible_ssh_port=22
mini2 ansible_host=192.168.1.200 ansible_ssh_user=cychong ansible_ssh_port=22
localhost     ansible_connection=local
</code></pre><h1 id=test-run>Test run</h1><h2 id=check-git-version-of-each-targets>check git version of each targets</h2><pre tabindex=0><code>mbpr15:tmp cychong$ ansible all -m command -a &#34;/usr/local/bin/git --version&#34; 
192.168.1.200 | SUCCESS | rc=0 &gt;&gt;
git version 2.14.2

192.168.1.100 | SUCCESS | rc=0 &gt;&gt;
git version 2.14.2
</code></pre><h2 id=update-remote-homebrew-packages>update remote (home)brew packages</h2><p><strong>FIXME</strong> Have to use homebrew module</p><p>Why two machines returns different result?</p><pre tabindex=0><code>mbpr15:tmp cychong$ ansible all -m homebrew -a &#34;update_homebrew=yes&#34; --verbose
No config file found; using defaults
192.168.1.200 | FAILED! =&gt; {
    &#34;changed&#34;: false, 
    &#34;failed&#34;: true, 
    &#34;msg&#34;: &#34;Warning: git 2.14.2 is already installed\nError: Git must be installed and in your PATH!&#34;
}
192.168.1.100 | SUCCESS =&gt; {
    &#34;changed&#34;: false, 
    &#34;failed&#34;: false, 
    &#34;msg&#34;: &#34;Homebrew already up-to-date.&#34;
}
</code></pre><h3 id=update-homebrew-itself-and-upgrade-all-packages>update homebrew itself and upgrade all packages</h3><pre tabindex=0><code>mbpr15:tmp cychong$ ansible all -m homebrew -a &#34;update_homebrew=yes upgrade_all=yes&#34; --verbose
No config file found; using defaults
mini2 | FAILED! =&gt; {
    &#34;changed&#34;: false, 
    &#34;failed&#34;: true, 
    &#34;msg&#34;: &#34;Warning: git 2.14.2 is already installed\nError: Git must be installed and in your PATH!&#34;
}
mini1 | SUCCESS =&gt; {
    &#34;changed&#34;: false, 
    &#34;failed&#34;: false, 
    &#34;msg&#34;: &#34;Homebrew packages already upgraded.&#34;
}
localhost | SUCCESS =&gt; {
    &#34;changed&#34;: true, 
    &#34;failed&#34;: false, 
    &#34;msg&#34;: &#34;Homebrew upgraded.&#34;
}
</code></pre><h2 id=install-ack-homebrew-package>install ack homebrew package</h2><pre tabindex=0><code>mbpr15:~ cychong$ cat install_brew_ack.yaml 
---
- hosts: all
  tasks:
  - name : install ack in homebrew
    homebrew: 
      name: ack
      state: present
</code></pre><p>run</p><pre tabindex=0><code>mbpr15:~ cychong$ ansible-playbook install_brew_ack.yaml --verbose
No config file found; using defaults

PLAY [all] **********************************************************************************

TASK [Gathering Facts] **********************************************************************
ok: [localhost]
ok: [mini2]
ok: [mini1]

TASK [install ack in homebrew] **************************************************************
ok: [localhost] =&gt; {&#34;changed&#34;: false, &#34;failed&#34;: false, &#34;msg&#34;: &#34;Package already installed: ack&#34;}
ok: [mini2] =&gt; {&#34;changed&#34;: false, &#34;failed&#34;: false, &#34;msg&#34;: &#34;Package already installed: ack&#34;}
ok: [mini1] =&gt; {&#34;changed&#34;: false, &#34;failed&#34;: false, &#34;msg&#34;: &#34;Package already installed: ack&#34;}

PLAY RECAP **********************************************************************************
localhost                  : ok=2    changed=0    unreachable=0    failed=0   
mini1                      : ok=2    changed=0    unreachable=0    failed=0   
mini2                      : ok=2    changed=0    unreachable=0    failed=0   
</code></pre><p>After removing ack from mini2</p><p>mini2</p><pre tabindex=0><code>mini2:~ cychong$ brew uninstall ack
Uninstalling /usr/local/Cellar/ack/2.18... (4 files, 190.4KB)
ack 2.14 1 is still installed.
Remove all versions with `brew uninstall --force ack`.
mini2:~ cychong$ brew uninstall --force ack
Uninstalling ack... (3 files, 182.8KB)
mini2:~ cychong$ ack
-bash: ack: command not found
</code></pre><p>Try again - install ack in mini2</p><pre tabindex=0><code>mbpr15:~ cychong$ ansible-playbook install_brew_ack.yaml --verbose
No config file found; using defaults

PLAY [all] **************************************************************************************************

TASK [Gathering Facts] **************************************************************************************
ok: [localhost]
ok: [mini1]
ok: [mini2]

TASK [install ack in homebrew] ******************************************************************************
ok: [localhost] =&gt; {&#34;changed&#34;: false, &#34;failed&#34;: false, &#34;msg&#34;: &#34;Package already installed: ack&#34;}
ok: [mini1] =&gt; {&#34;changed&#34;: false, &#34;failed&#34;: false, &#34;msg&#34;: &#34;Package already installed: ack&#34;}
changed: [mini2] =&gt; {&#34;changed&#34;: true, &#34;failed&#34;: false, &#34;msg&#34;: &#34;Package installed: ack&#34;}

PLAY RECAP **************************************************************************************************
localhost                  : ok=2    changed=0    unreachable=0    failed=0   
mini1                      : ok=2    changed=0    unreachable=0    failed=0   
mini2                      : ok=2    changed=1    unreachable=0    failed=0   
</code></pre><p>Note that mini2 has <code>changed</code> as <code>true(1)</code> because ack is installed(state is changed).</p><h1 id=reference>reference</h1><ul><li><a href=https://mcchae.gitbooks.io/ansible_ko/content/ansible_c18c_ac1c.html>Asible 소개</a></li><li><a href=https://www.ansible.com/quick-start-video>Ansible Quick Guide</a></li><li><a href=https://github.com/ideasonpurpose/ansible-playbooks/tree/master/roles>https://github.com/ideasonpurpose/ansible-playbooks/tree/master/roles</a></li><li><a href=https://moonstrike.github.io/ansible/2016/09/22/Ansible-Playbooks.html>https://moonstrike.github.io/ansible/2016/09/22/Ansible-Playbooks.html</a></li><li><a href=http://docs.ansible.com/ansible/2.4/playbooks_reuse_roles.html>http://docs.ansible.com/ansible/2.4/playbooks_reuse_roles.html</a></li><li><a href=http://docs.ansible.com/ansible/latest/playbooks.html>http://docs.ansible.com/ansible/latest/playbooks.html</a></li></ul></content><p><a href=https://cychong47.github.io/tags/ansible/>#Ansible</a>
<a href=https://cychong47.github.io/tags/automation/>#Automation</a></p></main><footer>Made with <a href=https://github.com/janraasch/hugo-bearblog/>Hugo ʕ•ᴥ•ʔ Bear</a></footer></body></html>