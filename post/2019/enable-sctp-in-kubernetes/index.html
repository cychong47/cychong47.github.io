<!doctype html><html lang=en-us><head><meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Enable SCTP in kubernetes | Keep calm and Write something</title><meta name=title content="Enable SCTP in kubernetes"><meta name=description content='Check if SCTP is supported by creating SCTP service
https://blog.aweimeow.tw/enable-sctp-in-kubernetes-cluster/
cychong@mini1:~/work/sctp$ cat service.yaml
apiVersion: v1
kind: Service
metadata:
  name: sctp
spec:
  selector:
    app: sctp
  ports:
  - protocol: SCTP
    port: 9999
    targetPort: 30001
cychong@mini1:~/work/sctp$ kubectl create -f service.yaml
The Service "sctp" is invalid: spec.ports[0].protocol: Unsupported value: "SCTP": supported values: "TCP", "UDP"
Enable SCTP in running kubernetes cluster
https://stackoverflow.com/questions/55909512/how-to-configure-already-running-cluster-in-kubernetes

Basically you must pass this flag to kube-apiserver. How you can do that depends on how you set up the cluster. If you used kubeadm or kubespray then you should edit file /etc/kubernetes/manifests/kube-apiserver.yaml and add this flag somewhere under &ldquo;command&rdquo; field (somewhere between other flags). After that kube-apiserver pod should be restarted automatically. If not - you can kill it by hand.'><meta name=keywords content="kubernetes,sctp,"><meta property="og:url" content="https://cychong47.github.io/post/2019/enable-sctp-in-kubernetes/"><meta property="og:site_name" content="Keep calm and Write something"><meta property="og:title" content="Enable SCTP in kubernetes"><meta property="og:description" content='Check if SCTP is supported by creating SCTP service https://blog.aweimeow.tw/enable-sctp-in-kubernetes-cluster/
cychong@mini1:~/work/sctp$ cat service.yaml apiVersion: v1 kind: Service metadata: name: sctp spec: selector: app: sctp ports: - protocol: SCTP port: 9999 targetPort: 30001 cychong@mini1:~/work/sctp$ kubectl create -f service.yaml The Service "sctp" is invalid: spec.ports[0].protocol: Unsupported value: "SCTP": supported values: "TCP", "UDP" Enable SCTP in running kubernetes cluster https://stackoverflow.com/questions/55909512/how-to-configure-already-running-cluster-in-kubernetes
Basically you must pass this flag to kube-apiserver. How you can do that depends on how you set up the cluster. If you used kubeadm or kubespray then you should edit file /etc/kubernetes/manifests/kube-apiserver.yaml and add this flag somewhere under “command” field (somewhere between other flags). After that kube-apiserver pod should be restarted automatically. If not - you can kill it by hand.'><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2019-10-07T15:39:35+09:00"><meta property="article:modified_time" content="2019-10-07T15:43:15+00:00"><meta property="article:tag" content="Kubernetes"><meta property="article:tag" content="Sctp"><meta name=twitter:card content="summary"><meta name=twitter:title content="Enable SCTP in kubernetes"><meta name=twitter:description content='Check if SCTP is supported by creating SCTP service https://blog.aweimeow.tw/enable-sctp-in-kubernetes-cluster/
cychong@mini1:~/work/sctp$ cat service.yaml apiVersion: v1 kind: Service metadata: name: sctp spec: selector: app: sctp ports: - protocol: SCTP port: 9999 targetPort: 30001 cychong@mini1:~/work/sctp$ kubectl create -f service.yaml The Service "sctp" is invalid: spec.ports[0].protocol: Unsupported value: "SCTP": supported values: "TCP", "UDP" Enable SCTP in running kubernetes cluster https://stackoverflow.com/questions/55909512/how-to-configure-already-running-cluster-in-kubernetes
Basically you must pass this flag to kube-apiserver. How you can do that depends on how you set up the cluster. If you used kubeadm or kubespray then you should edit file /etc/kubernetes/manifests/kube-apiserver.yaml and add this flag somewhere under “command” field (somewhere between other flags). After that kube-apiserver pod should be restarted automatically. If not - you can kill it by hand.'><meta itemprop=name content="Enable SCTP in kubernetes"><meta itemprop=description content='Check if SCTP is supported by creating SCTP service https://blog.aweimeow.tw/enable-sctp-in-kubernetes-cluster/
cychong@mini1:~/work/sctp$ cat service.yaml apiVersion: v1 kind: Service metadata: name: sctp spec: selector: app: sctp ports: - protocol: SCTP port: 9999 targetPort: 30001 cychong@mini1:~/work/sctp$ kubectl create -f service.yaml The Service "sctp" is invalid: spec.ports[0].protocol: Unsupported value: "SCTP": supported values: "TCP", "UDP" Enable SCTP in running kubernetes cluster https://stackoverflow.com/questions/55909512/how-to-configure-already-running-cluster-in-kubernetes
Basically you must pass this flag to kube-apiserver. How you can do that depends on how you set up the cluster. If you used kubeadm or kubespray then you should edit file /etc/kubernetes/manifests/kube-apiserver.yaml and add this flag somewhere under “command” field (somewhere between other flags). After that kube-apiserver pod should be restarted automatically. If not - you can kill it by hand.'><meta itemprop=datePublished content="2019-10-07T15:39:35+09:00"><meta itemprop=dateModified content="2019-10-07T15:43:15+00:00"><meta itemprop=wordCount content="578"><meta itemprop=keywords content="Kubernetes,Sctp"><meta name=referrer content="no-referrer-when-downgrade"><style>:root{--width:720px;--font-main:Verdana, sans-serif;--font-secondary:Verdana, sans-serif;--font-scale:1em;--background-color:#fafafa;--heading-color:#222;--text-color:#444;--link-color:#3273dc;--visited-color:#8b6fcb;--blockquote-color:#222}@media(prefers-color-scheme:dark){:root{--background-color:#fafafa;--heading-color:#222;--text-color:#444;--link-color:#3273dc;--visited-color:#8b6fcb;--blockquote-color:#222}}body{font-family:var(--font-secondary);font-size:var(--font-scale);margin:auto;padding:20px;max-width:var(--width);text-align:left;background-color:var(--background-color);word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:var(--text-color)}h1,h2,h3,h4,h5,h6{font-family:var(--font-main);color:var(--heading-color)}a{color:var(--link-color);cursor:pointer;text-decoration:none}a:hover{text-decoration:underline}nav a{margin-right:8px}strong,b{color:var(--heading-color)}button{margin:0;cursor:pointer}time{font-family:monospace;font-style:normal;font-size:15px}main{line-height:1.6}table{width:100%}hr{border:0;border-top:1px dashed}img{max-width:100%}code{font-family:monospace;padding:2px;border-radius:3px}blockquote{border-left:1px solid #999;color:var(--blockquote-color);padding-left:20px;font-style:italic}footer{padding:25px 0;text-align:center}.title:hover{text-decoration:none}.title h1{font-size:1.5em}.inline{width:auto!important}.highlight,.code{border-radius:3px;margin-block-start:1em;margin-block-end:1em;overflow-x:auto}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:var(--visited-color)}</style></head><body><header><a href=/ class=title><h2>Keep calm and Write something</h2></a><nav><a href=/post/>Post</a>
<a href=/page/>Page</a>
<a href=/series/>Series</a>
<a href=/tags/>Tag</a>
<a href=/archive/>Archive</a>
<a href=/search/>Search</a></nav></header><main><content><h2 id=check-if-sctp-is-supported-by-creating-sctp-service>Check if SCTP is supported by creating SCTP service</h2><p><a href=https://blog.aweimeow.tw/enable-sctp-in-kubernetes-cluster/>https://blog.aweimeow.tw/enable-sctp-in-kubernetes-cluster/</a></p><pre tabindex=0><code>cychong@mini1:~/work/sctp$ cat service.yaml
apiVersion: v1
kind: Service
metadata:
  name: sctp
spec:
  selector:
    app: sctp
  ports:
  - protocol: SCTP
    port: 9999
    targetPort: 30001
</code></pre><pre tabindex=0><code>cychong@mini1:~/work/sctp$ kubectl create -f service.yaml
The Service &#34;sctp&#34; is invalid: spec.ports[0].protocol: Unsupported value: &#34;SCTP&#34;: supported values: &#34;TCP&#34;, &#34;UDP&#34;
</code></pre><h2 id=enable-sctp-in-running-kubernetes-cluster>Enable SCTP in running kubernetes cluster</h2><p><a href=https://stackoverflow.com/questions/55909512/how-to-configure-already-running-cluster-in-kubernetes>https://stackoverflow.com/questions/55909512/how-to-configure-already-running-cluster-in-kubernetes</a></p><blockquote><p>Basically you must pass this flag to kube-apiserver. How you can do that depends on how you set up the cluster. If you used kubeadm or kubespray then you should edit file <code>/etc/kubernetes/manifests/kube-apiserver.yaml</code> and add this flag somewhere under &ldquo;command&rdquo; field (somewhere between other flags). After that kube-apiserver pod should be restarted automatically. If not - you can kill it by hand.</p></blockquote><p>Add <code>--feature-gates=SCTPSupport=True</code> to <code>/etc/kubernetes/manifest/kube-apiserver.yaml</code></p><pre tabindex=0><code>    - --tls-private-key-file=/etc/kubernetes/pki/apiserver.key
    - --feature-gates=SCTPSupport=True
    image: k8s.gcr.io/kube-apiserver:v1.16.1
</code></pre><p>Restart <code>kube-apiserver</code>. Just kill it and wait restarted</p><pre tabindex=0><code>cychong@mini1:/etc/kubernetes$ ps -ef |grep kube-api
root     21846 21824  9 00:02 ?        00:00:24 kube-apiserver --advertise-address=192.168.1.100 --allow-privileged=true --authorization-mode=Node,RBAC --client-ca-file=/etc/kubernetes/pki/ca.crt --enable-admission-plugins=NodeRestriction --enable-bootstrap-token-auth=true --etcd-cafile=/etc/kubernetes/pki/etcd/ca.crt --etcd-certfile=/etc/kubernetes/pki/apiserver-etcd-client.crt --etcd-keyfile=/etc/kubernetes/pki/apiserver-etcd-client.key --etcd-servers=https://127.0.0.1:2379 --insecure-port=0 --kubelet-client-certificate=/etc/kubernetes/pki/apiserver-kubelet-client.crt --kubelet-client-key=/etc/kubernetes/pki/apiserver-kubelet-client.key --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --proxy-client-cert-file=/etc/kubernetes/pki/front-proxy-client.crt --proxy-client-key-file=/etc/kubernetes/pki/front-proxy-client.key --requestheader-allowed-names=front-proxy-client --requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6443 --service-account-key-file=/etc/kubernetes/pki/sa.pub --service-cluster-ip-range=10.96.0.0/12 --tls-cert-file=/etc/kubernetes/pki/apiserver.crt --tls-private-key-file=/etc/kubernetes/pki/apiserver.key --feature-gates=SCTPSupport=True
cychong  29605 13731  0 00:06 pts/1    00:00:00 grep --color=auto kube-api
cychong@mini1:/etc/kubernetes$ sudo kill -SIGHUP 21846


cychong@mini1:/etc/kubernetes$ ps -ef |grep kube-api
root     30272 30246 79 00:07 ?        00:00:06 kube-apiserver --advertise-address=192.168.1.100 --allow-privileged=true --authorization-mode=Node,RBAC --client-ca-file=/etc/kubernetes/pki/ca.crt --enable-admission-plugins=NodeRestriction --enable-bootstrap-token-auth=true --etcd-cafile=/etc/kubernetes/pki/etcd/ca.crt --etcd-certfile=/etc/kubernetes/pki/apiserver-etcd-client.crt --etcd-keyfile=/etc/kubernetes/pki/apiserver-etcd-client.key --etcd-servers=https://127.0.0.1:2379 --insecure-port=0 --kubelet-client-certificate=/etc/kubernetes/pki/apiserver-kubelet-client.crt --kubelet-client-key=/etc/kubernetes/pki/apiserver-kubelet-client.key --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --proxy-client-cert-file=/etc/kubernetes/pki/front-proxy-client.crt --proxy-client-key-file=/etc/kubernetes/pki/front-proxy-client.key --requestheader-allowed-names=front-proxy-client --requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6443 --service-account-key-file=/etc/kubernetes/pki/sa.pub --service-cluster-ip-range=10.96.0.0/12 --tls-cert-file=/etc/kubernetes/pki/apiserver.crt --tls-private-key-file=/etc/kubernetes/pki/apiserver.key --feature-gates=SCTPSupport=True
cychong  30644 13731  0 00:07 pts/1    00:00:00 grep --color=auto kube-api
</code></pre><h2 id=check-if-sctp-service-is-supported>Check if SCTP service is supported</h2><pre tabindex=0><code>cychong@mini1:~/work/sctp$ kubectl create -f service.yaml
service/sctp created
</code></pre><h3 id=check-iptables>Check iptables</h3><pre tabindex=0><code>cychong@mini1:~/work/sctp$ sudo iptables -L -n |grep 9999
REJECT     sctp --  0.0.0.0/0            10.98.74.252         /* default/sctp: has no endpoints */ sctp dpt:9999 reject-with icmp-port-unreachable
</code></pre><h2 id=check-sctp-by-creating-sample-sctp-server>Check SCTP by creating sample SCTP-server</h2><p>First delete manullay created service</p><pre tabindex=0><code>cychong@mini1:~/work/sctp$ kubectl delete svc sctp
service &#34;sctp&#34; deleted
</code></pre><p>Install helm chart from <code>https://github.com/aweimeow/sctp-server</code>. This helm chart will deploy a pod which has python based SCTP server.</p><pre tabindex=0><code>cychong@mini1:~/work/sctp$ git clone https://github.com/aweimeow/sctp-server
Cloning into &#39;sctp-server&#39;...
remote: Enumerating objects: 17, done.
remote: Total 17 (delta 0), reused 0 (delta 0), pack-reused 17
Unpacking objects: 100% (17/17), done.

cychong@mini1:~/work/sctp$ helm install -n sctp sctp-server
NAME:   sctp
LAST DEPLOYED: Tue Oct  8 00:12:01 2019
NAMESPACE: default
STATUS: DEPLOYED

RESOURCES:
==&gt; v1/Deployment
NAME  READY  UP-TO-DATE  AVAILABLE  AGE
sctp  0/1    0           0          3s

==&gt; v1/Namespace
NAME  STATUS  AGE
sctp  Active  4s

==&gt; v1/Pod(related)
NAME                   READY  STATUS   RESTARTS  AGE
sctp-7c94d9b5c9-wsjnd  0/1    Pending  0         1s

==&gt; v1/Service
NAME  TYPE      CLUSTER-IP      EXTERNAL-IP  PORT(S)          AGE
sctp  NodePort  10.108.218.164  &lt;none&gt;       9999:30001/SCTP  4s


NOTES:
1. Get the application URL by running these commands:
  export NODE_PORT=$(kubectl get --namespace default -o jsonpath=&#34;{.spec.ports[0].nodePort}&#34; services sctp)
  export NODE_IP=$(kubectl get nodes --namespace default -o jsonpath=&#34;{.items[0].status.addresses[0].address}&#34;)
  echo http://$NODE_IP:$NODE_PORT
</code></pre><p>Check the pod and service</p><pre tabindex=0><code>cychong@mini1:~/work/sctp$ kubectl get svc
NAME         TYPE        CLUSTER-IP       EXTERNAL-IP     PORT(S)           AGE
kubernetes   ClusterIP   10.96.0.1        &lt;none&gt;          443/TCP           29d
my-ghost     NodePort    10.105.125.54    192.168.1.100   2368:32326/TCP    11d
sctp         NodePort    10.108.218.164   &lt;none&gt;          9999:30001/SCTP   2m42s
cychong@mini1:~/work/sctp$ kubectl get pods -o wide
NAME                        READY   STATUS    RESTARTS   AGE     IP             NODE    NOMINATED NODE   READINESS GATES
my-ghost-5f6578fd76-lb7xc   1/1     Running   41         11d     10.244.51.82   mini1   &lt;none&gt;           &lt;none&gt;
sctp-7c94d9b5c9-wsjnd       1/1     Running   0          2m55s   10.244.51.90   mini1   &lt;none&gt;           &lt;none&gt;
</code></pre><p>From the host, check if SCTP server is reachable from the host</p><pre tabindex=0><code>cychong@mini1:~/work/sctp$ ncat --sctp mini1 30001
Howdy! What&#39;s your name?
Memphis
Ncat: Connection reset by peer.
cychong@mini1:~/work/sctp$
</code></pre><h2 id=todo---client-in-pod-and-server-in-outside-cluster>TODO - client in Pod and server in outside cluster</h2><h2 id=reference>Reference</h2><ul><li><a href=https://blog.aweimeow.tw/enable-sctp-in-kubernetes-cluster/>Enabled SCTP in Kubernetes Cluster - aweimeow</a></li><li><a href=https://hub.docker.com/r/aweimeow/sctp-server>SCTP-server docker image - aweimeow</a></li><li><a href=https://stackoverflow.com/questions/25628717/python-sctp-module-server-side/30663239#30663239>Python sctp module - server side</a></li><li><a href=https://github.com/aweimeow/sctp-server>SCTP-server Helm Chart - aweimeow</a></li><li><a href="https://bugzilla.redhat.com/show_bug.cgi?id=1717461">SCTP support in Openshift maybe be from 4.3</a></li><li><a href=https://discuss.kubernetes.io/t/sctp-support-for-version-1-12-1/3203/8>https://discuss.kubernetes.io/t/sctp-support-for-version-1-12-1/3203/8</a></li></ul></content><p><a href=https://cychong47.github.io/tags/kubernetes/>#Kubernetes</a>
<a href=https://cychong47.github.io/tags/sctp/>#Sctp</a></p></main><footer>Made with <a href=https://github.com/janraasch/hugo-bearblog/>Hugo ʕ•ᴥ•ʔ Bear</a></footer></body></html>