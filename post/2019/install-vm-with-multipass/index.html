<!doctype html><html lang=en-us><head><meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Install VM with multipass on OS X | Keep calm and Write something</title><meta name=title content="Install VM with multipass on OS X"><meta name=description content="multipass?

Multipass is a lightweight VM manager for Linux, Windows and macOS. It&rsquo;s designed for developers who want a fresh Ubuntu environment with a single command. It uses KVM on Linux, Hyper-V on Windows and HyperKit on macOS to run the VM with minimal overhead. It can also use VirtualBox on Windows and macOS. Multipass will fetch images for you and keep them up to date.
Since it supports metadata for cloud-init, you can simulate a small cloud deployment on your laptop or workstation."><meta name=keywords content="Vmware,ubuntu,multipass,"><meta property="og:url" content="https://cychong47.github.io/post/2019/install-vm-with-multipass/"><meta property="og:site_name" content="Keep calm and Write something"><meta property="og:title" content="Install VM with multipass on OS X"><meta property="og:description" content="multipass? Multipass is a lightweight VM manager for Linux, Windows and macOS. It‚Äôs designed for developers who want a fresh Ubuntu environment with a single command. It uses KVM on Linux, Hyper-V on Windows and HyperKit on macOS to run the VM with minimal overhead. It can also use VirtualBox on Windows and macOS. Multipass will fetch images for you and keep them up to date.
Since it supports metadata for cloud-init, you can simulate a small cloud deployment on your laptop or workstation."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2019-09-28T15:17:26+09:00"><meta property="article:modified_time" content="2019-09-28T15:19:40+00:00"><meta property="article:tag" content="Vmware"><meta property="article:tag" content="Ubuntu"><meta property="article:tag" content="Multipass"><meta name=twitter:card content="summary"><meta name=twitter:title content="Install VM with multipass on OS X"><meta name=twitter:description content="multipass? Multipass is a lightweight VM manager for Linux, Windows and macOS. It‚Äôs designed for developers who want a fresh Ubuntu environment with a single command. It uses KVM on Linux, Hyper-V on Windows and HyperKit on macOS to run the VM with minimal overhead. It can also use VirtualBox on Windows and macOS. Multipass will fetch images for you and keep them up to date.
Since it supports metadata for cloud-init, you can simulate a small cloud deployment on your laptop or workstation."><meta itemprop=name content="Install VM with multipass on OS X"><meta itemprop=description content="multipass? Multipass is a lightweight VM manager for Linux, Windows and macOS. It‚Äôs designed for developers who want a fresh Ubuntu environment with a single command. It uses KVM on Linux, Hyper-V on Windows and HyperKit on macOS to run the VM with minimal overhead. It can also use VirtualBox on Windows and macOS. Multipass will fetch images for you and keep them up to date.
Since it supports metadata for cloud-init, you can simulate a small cloud deployment on your laptop or workstation."><meta itemprop=datePublished content="2019-09-28T15:17:26+09:00"><meta itemprop=dateModified content="2019-09-28T15:19:40+00:00"><meta itemprop=wordCount content="2307"><meta itemprop=keywords content="Vmware,Ubuntu,Multipass"><meta name=referrer content="no-referrer-when-downgrade"><style>:root{--width:720px;--font-main:Verdana, sans-serif;--font-secondary:Verdana, sans-serif;--font-scale:1em;--background-color:#fafafa;--heading-color:#222;--text-color:#444;--link-color:#3273dc;--visited-color:#8b6fcb;--blockquote-color:#222}@media(prefers-color-scheme:dark){:root{--background-color:#fafafa;--heading-color:#222;--text-color:#444;--link-color:#3273dc;--visited-color:#8b6fcb;--blockquote-color:#222}}body{font-family:var(--font-secondary);font-size:var(--font-scale);margin:auto;padding:20px;max-width:var(--width);text-align:left;background-color:var(--background-color);word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:var(--text-color)}h1,h2,h3,h4,h5,h6{font-family:var(--font-main);color:var(--heading-color)}a{color:var(--link-color);cursor:pointer;text-decoration:none}a:hover{text-decoration:underline}nav a{margin-right:8px}strong,b{color:var(--heading-color)}button{margin:0;cursor:pointer}time{font-family:monospace;font-style:normal;font-size:15px}main{line-height:1.6}table{width:100%}hr{border:0;border-top:1px dashed}img{max-width:100%}code{font-family:monospace;padding:2px;border-radius:3px}blockquote{border-left:1px solid #999;color:var(--blockquote-color);padding-left:20px;font-style:italic}footer{padding:25px 0;text-align:center}.title:hover{text-decoration:none}.title h1{font-size:1.5em}.inline{width:auto!important}.highlight,.code{border-radius:3px;margin-block-start:1em;margin-block-end:1em;overflow-x:auto}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:var(--visited-color)}</style></head><body><header><a href=/ class=title><h2>Keep calm and Write something</h2></a><nav><a href=/post/>Post</a>
<a href=/page/>Page</a>
<a href=/series/>Series</a>
<a href=/tags/>Tag</a>
<a href=/archive/>Archive</a>
<a href=/search/>Search</a></nav></header><main><content><h2 id=multipass>multipass?</h2><blockquote><p>Multipass is a lightweight VM manager for Linux, Windows and macOS. It&rsquo;s designed for developers who want a fresh Ubuntu environment with a single command. It uses KVM on Linux, Hyper-V on Windows and HyperKit on macOS to run the VM with minimal overhead. It can also use VirtualBox on Windows and macOS. Multipass will fetch images for you and keep them up to date.</p><p>Since it supports metadata for cloud-init, you can simulate a small cloud deployment on your laptop or workstation.</p></blockquote><p><a href=https://github.com/CanonicalLtd/multipass>https://github.com/CanonicalLtd/multipass</a></p><p>Linux Ïô∏Ïóê Windows Í∑∏Î¶¨Í≥† Mac OSÎ•º ÏßÄÏõêÌïòÎäî multipassÎ•º ÏÇ¨Ïö©ÌïòÎ©¥ virtualboxÎ•º ÏÇ¨Ïö©ÌïòÏßÄ ÏïäÍ≥†ÎèÑ OS XÏóêÏÑú VMÏùÑ ÏâΩÍ≤å ÎßåÎì§Ïñ¥ linux Í∏∞Î∞òÏùò ÌôòÍ≤ΩÏùÑ Íµ¨ÏÑ±Ìï† Ïàò ÏûàÎã§.</p><p>ÏïÑÎûò ÏòàÏóêÏÑúÎäî OS XÏóêÏÑú multipassÎ•º Ïù¥Ïö©Ìï¥ÏÑú Linux(Ubuntu) VMÏùÑ ÏÉùÏÑ±ÌïòÍ≥†, kubernetesÎ•º ÏÑ§ÏπòÌï¥ Î≥∏Îã§.</p><h2 id=install-multipass-with-brew>install <code>multipass</code> with brew</h2><pre tabindex=0><code>mbpr15:~ cychong$ brew cask install multipass
Updating Homebrew...
...

==&gt; Satisfying dependencies
==&gt; Downloading https://github.com/CanonicalLtd/multipass/releases/download/v0.8.0/multipass-0.8.0+mac-Darwin.pkg
==&gt; Downloading from https://github-production-release-asset-2e65be.s3.amazonaws.com/114128199/8489a680-ac9c-11e9-99
######################################################################## 100.0%
==&gt; Verifying SHA-256 checksum for Cask &#39;multipass&#39;.
==&gt; Installing Cask multipass
==&gt; Running installer for multipass; your password may be necessary.
==&gt; Package installers may write to any location; options such as --appdir are ignored.
Password:
installer: Package name is multipass
installer: Installing at base path /
installer: The install was successful.
üç∫  multipass was successfully installed!
</code></pre><h2 id=multipass-1>Multipass</h2><h3 id=multipass-find>multipass find</h3><pre tabindex=0><code>mbpr15:~ cychong$ multipass find
Image                   Aliases           Version          Description
snapcraft:core          core16            20190819         Snapcraft builder for Core 16
snapcraft:core18                          20190820         Snapcraft builder for Core 18
16.04                   xenial            20190814         Ubuntu 16.04 LTS
18.04                   bionic,lts        20190813.1       Ubuntu 18.04 LTS
</code></pre><h2 id=create-vm>Create VM</h2><h3 id=multipass-launch>multipass launch</h3><pre tabindex=0><code>mbpr15:~ cychong$ multipass launch --name vm --mem 4G --disk 20G --cpus 2 
Launched: vm
</code></pre><h3 id=list-vms>list VMs</h3><pre tabindex=0><code>mbpr15:~ cychong$ multipass list
Name                    State             IPv4             Image
vm                      Running           192.168.64.2     Ubuntu 18.04 LTS
</code></pre><h4 id=execute-command-in-vm-from-host>execute command in VM from host</h4><pre tabindex=0><code>mbpr15:~ cychong$ multipass exec vm -- uname -a
Linux vm 4.15.0-58-generic #64-Ubuntu SMP Tue Aug 6 11:12:41 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux
</code></pre><h3 id=login-to-vm>login to VM</h3><pre tabindex=0><code>mbpr15:~ cychong$ multipass shell vm
Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0-58-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Sun Aug 25 20:26:01 KST 2019

  System load:  0.0               Processes:             101
  Usage of /:   5.1% of 19.21GB   Users logged in:       0
  Memory usage: 3%                IP address for enp0s2: 192.168.64.2
  Swap usage:   0%


0 packages can be updated.
0 updates are security updates.


To run a command as administrator (user &#34;root&#34;), use &#34;sudo &lt;command&gt;&#34;.
See &#34;man sudo_root&#34; for details.

multipass@vm:~$
</code></pre><h3 id=setup-a-single-node-kubernetes-cluster>Setup a single node kubernetes cluster</h3><pre tabindex=0><code>multipass@vm:~$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
OK
</code></pre><pre tabindex=0><code>multipass@vm:~$ sudo add-apt-repository &#34;deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable&#34;
Get:1 https://download.docker.com/linux/ubuntu bionic InRelease [64.4 kB]
Hit:2 http://archive.ubuntu.com/ubuntu bionic InRelease
Get:3 http://archive.ubuntu.com/ubuntu bionic-updates InRelease [88.7 kB]
Get:4 http://security.ubuntu.com/ubuntu bionic-security InRelease [88.7 kB]
Get:5 https://download.docker.com/linux/ubuntu bionic/stable amd64 Packages [7889 B]
Get:6 http://security.ubuntu.com/ubuntu bionic-security/main amd64 Packages [485 kB]
Get:7 http://archive.ubuntu.com/ubuntu bionic-backports InRelease [74.6 kB]
Get:8 http://archive.ubuntu.com/ubuntu bionic/universe amd64 Packages [8570 kB]
Get:9 http://security.ubuntu.com/ubuntu bionic-security/main Translation-en [165 kB]
Get:10 http://security.ubuntu.com/ubuntu bionic-security/restricted amd64 Packages [4976 B]
Get:11 http://security.ubuntu.com/ubuntu bionic-security/restricted Translation-en [2476 B]
Get:12 http://security.ubuntu.com/ubuntu bionic-security/universe amd64 Packages [598 kB]
Get:13 http://security.ubuntu.com/ubuntu bionic-security/universe Translation-en [199 kB]
Get:14 http://security.ubuntu.com/ubuntu bionic-security/multiverse amd64 Packages [4004 B]
Get:15 http://security.ubuntu.com/ubuntu bionic-security/multiverse Translation-en [2060 B]
Get:16 http://archive.ubuntu.com/ubuntu bionic/universe Translation-en [4941 kB]
Get:17 http://archive.ubuntu.com/ubuntu bionic/multiverse amd64 Packages [151 kB]
Get:18 http://archive.ubuntu.com/ubuntu bionic/multiverse Translation-en [108 kB]
Get:19 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 Packages [712 kB]
Get:20 http://archive.ubuntu.com/ubuntu bionic-updates/main Translation-en [259 kB]
Get:21 http://archive.ubuntu.com/ubuntu bionic-updates/restricted amd64 Packages [11.9 kB]
Get:22 http://archive.ubuntu.com/ubuntu bionic-updates/restricted Translation-en [4156 B]
Get:23 http://archive.ubuntu.com/ubuntu bionic-updates/universe amd64 Packages [999 kB]
Get:24 http://archive.ubuntu.com/ubuntu bionic-updates/universe Translation-en [306 kB]
Get:25 http://archive.ubuntu.com/ubuntu bionic-updates/multiverse amd64 Packages [6636 B]
Get:26 http://archive.ubuntu.com/ubuntu bionic-updates/multiverse Translation-en [3556 B]
Get:27 http://archive.ubuntu.com/ubuntu bionic-backports/main amd64 Packages [2512 B]
Get:28 http://archive.ubuntu.com/ubuntu bionic-backports/main Translation-en [1644 B]
Get:29 http://archive.ubuntu.com/ubuntu bionic-backports/universe amd64 Packages [4000 B]
Get:30 http://archive.ubuntu.com/ubuntu bionic-backports/universe Translation-en [1856 B]
Preparing to unpack .../1-aufs-tools_1%3a4.9+20170918-1ubuntu1_amd64.deb ...
Unpacking aufs-tools (1:4.9+20170918-1ubuntu1) ...
Selecting previously unselected package cgroupfs-mount.
Preparing to unpack .../2-cgroupfs-mount_1.4_all.deb ...
Unpacking cgroupfs-mount (1.4) ...
Selecting previously unselected package containerd.io.
Preparing to unpack .../3-containerd.io_1.2.6-3_amd64.deb ...
Unpacking containerd.io (1.2.6-3) ...
Selecting previously unselected package docker-ce-cli.
Preparing to unpack .../4-docker-ce-cli_5%3a19.03.1~3-0~ubuntu-bionic_amd64.deb ...
Unpacking docker-ce-cli (5:19.03.1~3-0~ubuntu-bionic) ...
Selecting previously unselected package docker-ce.
Preparing to unpack .../5-docker-ce_5%3a19.03.1~3-0~ubuntu-bionic_amd64.deb ...
Unpacking docker-ce (5:19.03.1~3-0~ubuntu-bionic) ...
Selecting previously unselected package libltdl7:amd64.
Preparing to unpack .../6-libltdl7_2.4.6-2_amd64.deb ...
Unpacking libltdl7:amd64 (2.4.6-2) ...
Setting up aufs-tools (1:4.9+20170918-1ubuntu1) ...
Setting up containerd.io (1.2.6-3) ...
Created symlink /etc/systemd/system/multi-user.target.wants/containerd.service ‚Üí /lib/systemd/system/containerd.service.
Processing triggers for ureadahead (0.100.0-21) ...
Setting up cgroupfs-mount (1.4) ...
Processing triggers for libc-bin (2.27-3ubuntu1) ...
Processing triggers for systemd (237-3ubuntu10.25) ...
Setting up libltdl7:amd64 (2.4.6-2) ...
Processing triggers for man-db (2.8.3-2ubuntu0.1) ...
Setting up docker-ce-cli (5:19.03.1~3-0~ubuntu-bionic) ...
Setting up pigz (2.4-1) ...
Setting up docker-ce (5:19.03.1~3-0~ubuntu-bionic) ...
Created symlink /etc/systemd/system/multi-user.target.wants/docker.service ‚Üí /lib/systemd/system/docker.service.
Created symlink /etc/systemd/system/sockets.target.wants/docker.socket ‚Üí /lib/systemd/system/docker.socket.
Processing triggers for ureadahead (0.100.0-21) ...
Processing triggers for libc-bin (2.27-3ubuntu1) ...
Processing triggers for systemd (237-3ubuntu10.25) ...
</code></pre><pre tabindex=0><code>multipass@vm:~$ sudo swapoff -a
multipass@vm:~$ sudo sed -i &#39;/ swap / s/^\(.*\)$/#\1/g&#39; /etc/fstab
</code></pre><pre tabindex=0><code>multipass@vm:~$ sudo apt-get update &amp;&amp; sudo apt-get install -y apt-transport-https &amp;&amp; curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add -
Hit:1 http://security.ubuntu.com/ubuntu bionic-security InRelease
Hit:2 http://archive.ubuntu.com/ubuntu bionic InRelease
Hit:3 https://download.docker.com/linux/ubuntu bionic InRelease
Hit:4 http://archive.ubuntu.com/ubuntu bionic-updates InRelease
Hit:5 http://archive.ubuntu.com/ubuntu bionic-backports InRelease
Reading package lists... Done
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following package was automatically installed and is no longer required:
  grub-pc-bin
Use &#39;sudo apt autoremove&#39; to remove it.
The following NEW packages will be installed:
  apt-transport-https
0 upgraded, 1 newly installed, 0 to remove and 6 not upgraded.
Need to get 1692 B of archives.
After this operation, 153 kB of additional disk space will be used.
Get:1 http://archive.ubuntu.com/ubuntu bionic-updates/universe amd64 apt-transport-https all 1.6.11 [1692 B]
Fetched 1692 B in 1s (2906 B/s)
Selecting previously unselected package apt-transport-https.
(Reading database ... 60304 files and directories currently installed.)
Preparing to unpack .../apt-transport-https_1.6.11_all.deb ...
Unpacking apt-transport-https (1.6.11) ...
Setting up apt-transport-https (1.6.11) ...
OK
</code></pre><pre tabindex=0><code>multipass@vm:~$ echo &#34;deb http://apt.kubernetes.io/ kubernetes-xenial main&#34; | sudo tee -a /etc/apt/sources.list.d/kubernetes.list &amp;&amp; sudo apt-get update
deb http://apt.kubernetes.io/ kubernetes-xenial main
Hit:1 http://security.ubuntu.com/ubuntu bionic-security InRelease
Hit:2 http://archive.ubuntu.com/ubuntu bionic InRelease
Hit:3 https://download.docker.com/linux/ubuntu bionic InRelease
Hit:4 http://archive.ubuntu.com/ubuntu bionic-updates InRelease
Hit:5 http://archive.ubuntu.com/ubuntu bionic-backports InRelease
Get:6 https://packages.cloud.google.com/apt kubernetes-xenial InRelease [8993 B]
Get:7 https://packages.cloud.google.com/apt kubernetes-xenial/main amd64 Packages [28.9 kB]
Fetched 37.9 kB in 2s (15.3 kB/s)
Reading package lists... Done
</code></pre><pre tabindex=0><code>multipass@vm:~$ sudo apt-get update &amp;&amp; sudo apt-get install -y apt-transport-https &amp;&amp; curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add -
Hit:1 http://security.ubuntu.com/ubuntu bionic-security InRelease
Hit:2 http://archive.ubuntu.com/ubuntu bionic InRelease
Hit:3 https://download.docker.com/linux/ubuntu bionic InRelease
Hit:4 http://archive.ubuntu.com/ubuntu bionic-updates InRelease
Hit:5 http://archive.ubuntu.com/ubuntu bionic-backports InRelease
Reading package lists... Done
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following package was automatically installed and is no longer required:
  grub-pc-bin
Use &#39;sudo apt autoremove&#39; to remove it.
The following NEW packages will be installed:
  apt-transport-https
0 upgraded, 1 newly installed, 0 to remove and 6 not upgraded.
Need to get 1692 B of archives.
After this operation, 153 kB of additional disk space will be used.
Get:1 http://archive.ubuntu.com/ubuntu bionic-updates/universe amd64 apt-transport-https all 1.6.11 [1692 B]
Fetched 1692 B in 1s (2906 B/s)
Selecting previously unselected package apt-transport-https.
(Reading database ... 60304 files and directories currently installed.)
Preparing to unpack .../apt-transport-https_1.6.11_all.deb ...
Unpacking apt-transport-https (1.6.11) ...
Get:3 https://packages.cloud.google.com/apt kubernetes-xenial/main amd64 kubelet amd64 1.15.3-00 [20.2 MB]
Get:4 https://packages.cloud.google.com/apt kubernetes-xenial/main amd64 kubectl amd64 1.15.3-00 [8763 kB]
Get:5 https://packages.cloud.google.com/apt kubernetes-xenial/main amd64 kubeadm amd64 1.15.3-00 [8248 kB]
Fetched 52.9 MB in 27s (1972 kB/s)
Selecting previously unselected package conntrack.
(Reading database ... 60308 files and directories currently installed.)
Preparing to unpack .../0-conntrack_1%3a1.4.4+snapshot20161117-6ubuntu2_amd64.deb ...
Unpacking conntrack (1:1.4.4+snapshot20161117-6ubuntu2) ...
Selecting previously unselected package cri-tools.
Preparing to unpack .../1-cri-tools_1.13.0-00_amd64.deb ...
Unpacking cri-tools (1.13.0-00) ...
Selecting previously unselected package kubernetes-cni.
Preparing to unpack .../2-kubernetes-cni_0.7.5-00_amd64.deb ...
Unpacking kubernetes-cni (0.7.5-00) ...
Selecting previously unselected package socat.
Preparing to unpack .../3-socat_1.7.3.2-2ubuntu2_amd64.deb ...
Unpacking socat (1.7.3.2-2ubuntu2) ...
Selecting previously unselected package kubelet.
Preparing to unpack .../4-kubelet_1.15.3-00_amd64.deb ...
Unpacking kubelet (1.15.3-00) ...
Selecting previously unselected package kubectl.
Preparing to unpack .../5-kubectl_1.15.3-00_amd64.deb ...
Unpacking kubectl (1.15.3-00) ...
Selecting previously unselected package kubeadm.
Preparing to unpack .../6-kubeadm_1.15.3-00_amd64.deb ...
Unpacking kubeadm (1.15.3-00) ...
Setting up conntrack (1:1.4.4+snapshot20161117-6ubuntu2) ...
Setting up kubernetes-cni (0.7.5-00) ...
Setting up cri-tools (1.13.0-00) ...
Setting up socat (1.7.3.2-2ubuntu2) ...
Setting up kubelet (1.15.3-00) ...
Created symlink /etc/systemd/system/multi-user.target.wants/kubelet.service ‚Üí /lib/systemd/system/kubelet.service.
Setting up kubectl (1.15.3-00) ...
Processing triggers for man-db (2.8.3-2ubuntu0.1) ...
Setting up kubeadm (1.15.3-00) ...
</code></pre><pre tabindex=0><code>multipass@vm:~$ sudo kubeadm init --pod-network-cidr=10.201.0.0/24 --token-ttl 0
...

multipass@vm:~$ mkdir -p $HOME/.kube
multipass@vm:~$ sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
multipass@vm:~$ sudo chown $(id -u):$(id -g) $HOME/.kube/config
</code></pre><pre tabindex=0><code>multipass@vm:~$ kubectl get pods --all-namespaces -o wide
NAMESPACE     NAME                         READY   STATUS    RESTARTS   AGE   IP             NODE     NOMINATED NODE   READINESS GATES
kube-system   coredns-5c98db65d4-ksh4p     0/1     Pending   0          21m   &lt;none&gt;         &lt;none&gt;   &lt;none&gt;           &lt;none&gt;
kube-system   coredns-5c98db65d4-nvvzg     0/1     Pending   0          21m   &lt;none&gt;         &lt;none&gt;   &lt;none&gt;           &lt;none&gt;
kube-system   etcd-vm                      1/1     Running   0          20m   192.168.64.2   vm       &lt;none&gt;           &lt;none&gt;
kube-system   kube-apiserver-vm            1/1     Running   0          20m   192.168.64.2   vm       &lt;none&gt;           &lt;none&gt;
kube-system   kube-controller-manager-vm   1/1     Running   0          20m   192.168.64.2   vm       &lt;none&gt;           &lt;none&gt;
kube-system   kube-proxy-b8qf2             1/1     Running   0          21m   192.168.64.2   vm       &lt;none&gt;           &lt;none&gt;
kube-system   kube-scheduler-vm            1/1     Running   0          20m   192.168.64.2   vm       &lt;none&gt;           &lt;none&gt;
</code></pre><h4 id=install-calico>install calico</h4><pre tabindex=0><code>multipass@vm:~$ wget https://docs.projectcalico.org/v3.8/manifests/calico.yaml
--2019-08-25 21:26:00--  https://docs.projectcalico.org/v3.8/manifests/calico.yaml
Resolving docs.projectcalico.org (docs.projectcalico.org)... 206.189.73.52, 2604:a880:2:d0::21e9:c001
Connecting to docs.projectcalico.org (docs.projectcalico.org)|206.189.73.52|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 20628 (20K) [application/x-yaml]
Saving to: ‚Äòcalico.yaml‚Äô

calico.yaml                  100%[==============================================&gt;]  20.14K  93.2KB/s    in 0.2s

2019-08-25 21:26:02 (93.2 KB/s) - ‚Äòcalico.yaml‚Äô saved [20628/20628]
</code></pre><p>Change <code>CALICO_IPV4POOL_CIDR</code></p><pre tabindex=0><code>            - name: CALICO_IPV4POOL_CIDR
              value: &#34;10.201.0.0/24&#34;
</code></pre><pre tabindex=0><code>multipass@vm:~$ kubectl apply -f calico.yaml
configmap/calico-config unchanged
customresourcedefinition.apiextensions.k8s.io/felixconfigurations.crd.projectcalico.org unchanged
customresourcedefinition.apiextensions.k8s.io/ipamblocks.crd.projectcalico.org unchanged
customresourcedefinition.apiextensions.k8s.io/blockaffinities.crd.projectcalico.org unchanged
customresourcedefinition.apiextensions.k8s.io/ipamhandles.crd.projectcalico.org unchanged
customresourcedefinition.apiextensions.k8s.io/ipamconfigs.crd.projectcalico.org unchanged
customresourcedefinition.apiextensions.k8s.io/bgppeers.crd.projectcalico.org unchanged
customresourcedefinition.apiextensions.k8s.io/bgpconfigurations.crd.projectcalico.org unchanged
customresourcedefinition.apiextensions.k8s.io/ippools.crd.projectcalico.org unchanged
customresourcedefinition.apiextensions.k8s.io/hostendpoints.crd.projectcalico.org unchanged
customresourcedefinition.apiextensions.k8s.io/clusterinformations.crd.projectcalico.org unchanged
customresourcedefinition.apiextensions.k8s.io/globalnetworkpolicies.crd.projectcalico.org unchanged
customresourcedefinition.apiextensions.k8s.io/globalnetworksets.crd.projectcalico.org unchanged
customresourcedefinition.apiextensions.k8s.io/networkpolicies.crd.projectcalico.org unchanged
customresourcedefinition.apiextensions.k8s.io/networksets.crd.projectcalico.org unchanged
clusterrole.rbac.authorization.k8s.io/calico-kube-controllers unchanged
clusterrolebinding.rbac.authorization.k8s.io/calico-kube-controllers unchanged
clusterrole.rbac.authorization.k8s.io/calico-node unchanged
clusterrolebinding.rbac.authorization.k8s.io/calico-node unchanged
daemonset.apps/calico-node configured
serviceaccount/calico-node unchanged
deployment.apps/calico-kube-controllers unchanged
serviceaccount/calico-kube-controllers unchanged
</code></pre><pre tabindex=0><code>multipass@vm:~$ kubectl get pods --all-namespaces -o wide
NAMESPACE     NAME                                       READY   STATUS    RESTARTS   AGE     IP               NODE   NOMINATED NODE   READINESS GATES
kube-system   calico-kube-controllers-65b8787765-5rftm   1/1     Running   0          3m57s   192.168.141.65   vm     &lt;none&gt;           &lt;none&gt;
kube-system   calico-node-dtbhl                          1/1     Running   0          44s     192.168.64.2     vm     &lt;none&gt;           &lt;none&gt;
kube-system   coredns-5c98db65d4-ksh4p                   1/1     Running   0          25m     192.168.141.66   vm     &lt;none&gt;           &lt;none&gt;
kube-system   coredns-5c98db65d4-nvvzg                   1/1     Running   0          25m     192.168.141.67   vm     &lt;none&gt;           &lt;none&gt;
kube-system   etcd-vm                                    1/1     Running   0          24m     192.168.64.2     vm     &lt;none&gt;           &lt;none&gt;
kube-system   kube-apiserver-vm                          1/1     Running   0          24m     192.168.64.2     vm     &lt;none&gt;           &lt;none&gt;
kube-system   kube-controller-manager-vm                 1/1     Running   0          24m     192.168.64.2     vm     &lt;none&gt;           &lt;none&gt;
kube-system   kube-proxy-b8qf2                           1/1     Running   0          25m     192.168.64.2     vm     &lt;none&gt;           &lt;none&gt;
kube-system   kube-scheduler-vm                          1/1     Running   0          25m     192.168.64.2     vm     &lt;none&gt;           &lt;none&gt;
</code></pre><pre tabindex=0><code>multipass@vm:~$ kubectl taint nodes --all node-role.kubernetes.io/master-
node/vm untainted
</code></pre><h3 id=install-calicoctl>Install calicoctl</h3><p><a href=https://docs.projectcalico.org/v3.5/usage/calicoctl/install>https://docs.projectcalico.org/v3.5/usage/calicoctl/install</a></p><pre tabindex=0><code>multipass@vm:~$ curl -O -L  https://github.com/projectcalico/calicoctl/releases/download/v3.5.8/calicoctl
multipass@vm:~$ chmod +x calicoctl
multipass@vm:~$ ./calicoctl get profiles
Failed to create Calico API client: no etcd endpoints specified
multipass@vm:~$ kubectl apply -f \
&gt;  https://docs.projectcalico.org/v3.5/getting-started/kubernetes/installation/hosted/calicoctl.yaml
pod/calicoctl created
multipass@vm:~$ kubectl exec -ti -n kube-system calicoctl -- /calicoctl get profiles -o wide
error: unable to upgrade connection: container not found (&#34;calicoctl&#34;)
</code></pre><pre tabindex=0><code>multipass@vm:~$ kubectl get pods --all-namespaces
NAMESPACE     NAME                                       READY   STATUS                       RESTARTS   AGE
kube-system   calico-kube-controllers-65b8787765-5rftm   1/1     Running                      0          10m
kube-system   calico-node-dtbhl                          1/1     Running                      0          7m46s
kube-system   calicoctl                                  0/1     CreateContainerConfigError   0          38s
kube-system   coredns-5c98db65d4-ksh4p                   1/1     Running                      0          33m
kube-system   coredns-5c98db65d4-nvvzg                   1/1     Running                      0          33m
kube-system   etcd-vm                                    1/1     Running                      0          32m
kube-system   kube-apiserver-vm                          1/1     Running                      0          31m
kube-system   kube-controller-manager-vm                 1/1     Running                      0          31m
kube-system   kube-proxy-b8qf2                           1/1     Running                      0          33m
kube-system   kube-scheduler-vm                          1/1     Running                      0          32m
</code></pre><pre tabindex=0><code>multipass@vm:~$ kubectl describe pod calicoctl --namespace=kube-system
Name:         calicoctl
Namespace:    kube-system
Priority:     0
Node:         vm/192.168.64.2
Start Time:   Sun, 25 Aug 2019 21:35:02 +0900
Labels:       &lt;none&gt;
Annotations:  kubectl.kubernetes.io/last-applied-configuration:
                {&#34;apiVersion&#34;:&#34;v1&#34;,&#34;kind&#34;:&#34;Pod&#34;,&#34;metadata&#34;:{&#34;annotations&#34;:{},&#34;name&#34;:&#34;calicoctl&#34;,&#34;namespace&#34;:&#34;kube-system&#34;},&#34;spec&#34;:{&#34;containers&#34;:[{&#34;command...
Status:       Pending
IP:           192.168.64.2
Containers:
  calicoctl:
    Container ID:
    Image:         calico/ctl:v3.5.8
    Image ID:
    Port:          &lt;none&gt;
    Host Port:     &lt;none&gt;
    Command:
      /bin/sh
      -c
      while true; do sleep 3600; done
    State:          Waiting
      Reason:       CreateContainerConfigError
    Ready:          False
    Restart Count:  0
    Environment:
      ETCD_ENDPOINTS:  &lt;set to the key &#39;etcd_endpoints&#39; of config map &#39;calico-config&#39;&gt;  Optional: false
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from default-token-w2l7q (ro)
Conditions:
  Type              Status
  Initialized       True
  Ready             False
  ContainersReady   False
  PodScheduled      True
Volumes:
  default-token-w2l7q:
    Type:        Secret (a volume populated by a Secret)
    SecretName:  default-token-w2l7q
    Optional:    false
QoS Class:       BestEffort
Node-Selectors:  beta.kubernetes.io/os=linux
Tolerations:     node.kubernetes.io/not-ready:NoExecute for 300s
                 node.kubernetes.io/unreachable:NoExecute for 300s
Events:
  Type     Reason     Age               From               Message
  ----     ------     ----              ----               -------
  Normal   Scheduled  72s               default-scheduler  Successfully assigned kube-system/calicoctl to vm
  Normal   Pulling    71s               kubelet, vm        Pulling image &#34;calico/ctl:v3.5.8&#34;
  Normal   Pulled     57s               kubelet, vm        Successfully pulled image &#34;calico/ctl:v3.5.8&#34;
  Warning  Failed     3s (x6 over 57s)  kubelet, vm        Error: Couldn&#39;t find key etcd_endpoints in ConfigMap kube-system/calico-config
  Normal   Pulled     3s (x5 over 57s)  kubelet, vm        Container image &#34;calico/ctl:v3.5.8&#34; already present on machine
</code></pre><h3 id=delete-kubenetes-cluster>delete kubenetes cluster</h3><pre tabindex=0><code>multipass@vm:~$ kubectl drain vm --delete-local-data --force --ignore-daemonsets
node/vm cordoned
WARNING: ignoring DaemonSet-managed Pods: kube-system/calico-node-dtbhl, kube-system/kube-proxy-b8qf2; deleting Pods not managed by ReplicationController, ReplicaSet, Job, DaemonSet or StatefulSet: kube-system/calicoctl
evicting pod &#34;coredns-5c98db65d4-nvvzg&#34;
evicting pod &#34;calico-kube-controllers-65b8787765-5rftm&#34;
evicting pod &#34;calicoctl&#34;
evicting pod &#34;coredns-5c98db65d4-ksh4p&#34;
pod/calicoctl evicted
pod/coredns-5c98db65d4-nvvzg evicted
pod/calico-kube-controllers-65b8787765-5rftm evicted
pod/coredns-5c98db65d4-ksh4p evicted
node/vm evicted
multipass@vm:~$ sudo kubeadm reset
[reset] Reading configuration from the cluster...
[reset] FYI: You can look at this config file with &#39;kubectl -n kube-system get cm kubeadm-config -oyaml&#39;
[reset] WARNING: Changes made to this host by &#39;kubeadm init&#39; or &#39;kubeadm join&#39; will be reverted.
[reset] Are you sure you want to proceed? [y/N]: y
[preflight] Running pre-flight checks
[reset] Removing info for node &#34;vm&#34; from the ConfigMap &#34;kubeadm-config&#34; in the &#34;kube-system&#34; Namespace
W0825 21:46:06.943208    4603 removeetcdmember.go:61] [reset] failed to remove etcd member: error syncing endpoints with etc: etcdclient: no available endpoints
.Please manually remove this etcd member using etcdctl
[reset] Stopping the kubelet service
[reset] Unmounting mounted directories in &#34;/var/lib/kubelet&#34;
[reset] Deleting contents of config directories: [/etc/kubernetes/manifests /etc/kubernetes/pki]
[reset] Deleting files: [/etc/kubernetes/admin.conf /etc/kubernetes/kubelet.conf /etc/kubernetes/bootstrap-kubelet.conf /etc/kubernetes/controller-manager.conf /etc/kubernetes/scheduler.conf]
[reset] Deleting contents of stateful directories: [/var/lib/etcd /var/lib/kubelet /etc/cni/net.d /var/lib/dockershim /var/run/kubernetes]

The reset process does not reset or clean up iptables rules or IPVS tables.
If you wish to reset iptables, you must do so manually.
For example:
iptables -F &amp;&amp; iptables -t nat -F &amp;&amp; iptables -t mangle -F &amp;&amp; iptables -X

If your cluster was setup to utilize IPVS, run ipvsadm --clear (or similar)
to reset your system&#39;s IPVS tables.

The reset process does not clean your kubeconfig files and you must remove them manually.
Please, check the contents of the $HOME/.kube/config file.

multipass@vm:~$ sudo rm -rf /var/etcd
</code></pre><h2 id=reference>Reference</h2><h3 id=multipass-2>multipass</h3><ul><li><a href=https://multipass.run>https://multipass.run</a></li><li><a href=https://github.com/CanonicalLtd/multipass>https://github.com/CanonicalLtd/multipass</a></li><li><a href=https://ubuntu.com/blog/kubernetes-on-mac-how-to-set-up>OS XÏóêÏÑú multipassÎ•º Ïù¥Ïö©ÌïòÏó¨ microk8s ÌôòÍ≤Ω Íµ¨ÏÑ±</a></li><li><a href=https://raaaimund.github.io/tech/2018/10/23/create-single-node-k8s-cluster/>Create a single node Kubernetes cluster on Ubuntu 18.04.1 (Bionic Beaver) with kubeadm</a></li><li><a href=https://docs.projectcalico.org/v3.8/getting-started/kubernetes/>https://docs.projectcalico.org/v3.8/getting-started/kubernetes/</a></li><li><a href=https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/>k8s ÏÑ§Ïπò ÏÉÅÏÑ∏ Ï†àÏ∞®</a></li><li><a href=https://bcho.tistory.com/1341>private helm repository Íµ¨ÏÑ±ÌïòÍ∏∞-Ï°∞ÎåÄÌòë</a></li></ul></content><p><a href=https://cychong47.github.io/tags/vmware/>#Vmware</a>
<a href=https://cychong47.github.io/tags/ubuntu/>#Ubuntu</a>
<a href=https://cychong47.github.io/tags/multipass/>#Multipass</a></p></main><footer>Made with <a href=https://github.com/janraasch/hugo-bearblog/>Hugo  ï‚Ä¢·¥•‚Ä¢ î Bear</a></footer></body></html>