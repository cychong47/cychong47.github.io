<!doctype html><html lang=en-us><head><meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Botkube to monitor K8s cluster in Slack | Keep calm and Write something</title><meta name=title content="Botkube to monitor K8s cluster in Slack"><meta name=description content='Install BotKube for k8s and slack
Slack :: Messaging bot for monitoring and debugging Kubernetes clusters
cychong@mini1:~$ helm repo add infracloudio https://infracloudio.github.io/charts
"infracloudio" has been added to your repositories
cychong@mini1:~$ helm repo update
Hang tight while we grab the latest from your chart repositories...
...Successfully got an update from the "infracloudio" chart repository
...Successfully got an update from the "myhelmrepo" chart repository
Update Complete. ⎈ Happy Helming!⎈
botkube를 위한 namespace 만들어주기'><meta name=keywords content="Slack,Kubernetes,TIL,"><meta property="og:url" content="https://cychong47.github.io/post/2020/2020-09-04-install-botkube/"><meta property="og:site_name" content="Keep calm and Write something"><meta property="og:title" content="Botkube to monitor K8s cluster in Slack"><meta property="og:description" content='Install BotKube for k8s and slack Slack :: Messaging bot for monitoring and debugging Kubernetes clusters
cychong@mini1:~$ helm repo add infracloudio https://infracloudio.github.io/charts "infracloudio" has been added to your repositories cychong@mini1:~$ helm repo update Hang tight while we grab the latest from your chart repositories... ...Successfully got an update from the "infracloudio" chart repository ...Successfully got an update from the "myhelmrepo" chart repository Update Complete. ⎈ Happy Helming!⎈ botkube를 위한 namespace 만들어주기'><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2020-09-04T23:51:45+09:00"><meta property="article:modified_time" content="2020-09-04T23:51:45+09:00"><meta property="article:tag" content="Slack"><meta property="article:tag" content="Kubernetes"><meta property="article:tag" content="TIL"><meta property="og:see_also" content="https://cychong47.github.io/post/2021/2021-04-13-install-kubernetes-on-mini3/"><meta property="og:see_also" content="https://cychong47.github.io/post/2019/setup-kubernetes-with-a-single-host/"><meta name=twitter:card content="summary"><meta name=twitter:title content="Botkube to monitor K8s cluster in Slack"><meta name=twitter:description content='Install BotKube for k8s and slack Slack :: Messaging bot for monitoring and debugging Kubernetes clusters
cychong@mini1:~$ helm repo add infracloudio https://infracloudio.github.io/charts "infracloudio" has been added to your repositories cychong@mini1:~$ helm repo update Hang tight while we grab the latest from your chart repositories... ...Successfully got an update from the "infracloudio" chart repository ...Successfully got an update from the "myhelmrepo" chart repository Update Complete. ⎈ Happy Helming!⎈ botkube를 위한 namespace 만들어주기'><meta itemprop=name content="Botkube to monitor K8s cluster in Slack"><meta itemprop=description content='Install BotKube for k8s and slack Slack :: Messaging bot for monitoring and debugging Kubernetes clusters
cychong@mini1:~$ helm repo add infracloudio https://infracloudio.github.io/charts "infracloudio" has been added to your repositories cychong@mini1:~$ helm repo update Hang tight while we grab the latest from your chart repositories... ...Successfully got an update from the "infracloudio" chart repository ...Successfully got an update from the "myhelmrepo" chart repository Update Complete. ⎈ Happy Helming!⎈ botkube를 위한 namespace 만들어주기'><meta itemprop=datePublished content="2020-09-04T23:51:45+09:00"><meta itemprop=dateModified content="2020-09-04T23:51:45+09:00"><meta itemprop=wordCount content="325"><meta itemprop=keywords content="Slack,Kubernetes,TIL"><meta name=referrer content="no-referrer-when-downgrade"><style>:root{--width:720px;--font-main:Verdana, sans-serif;--font-secondary:Verdana, sans-serif;--font-scale:1em;--background-color:#fafafa;--heading-color:#222;--text-color:#444;--link-color:#3273dc;--visited-color:#8b6fcb;--blockquote-color:#222}@media(prefers-color-scheme:dark){:root{--background-color:#fafafa;--heading-color:#222;--text-color:#444;--link-color:#3273dc;--visited-color:#8b6fcb;--blockquote-color:#222}}body{font-family:var(--font-secondary);font-size:var(--font-scale);margin:auto;padding:20px;max-width:var(--width);text-align:left;background-color:var(--background-color);word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:var(--text-color)}h1,h2,h3,h4,h5,h6{font-family:var(--font-main);color:var(--heading-color)}a{color:var(--link-color);cursor:pointer;text-decoration:none}a:hover{text-decoration:underline}nav a{margin-right:8px}strong,b{color:var(--heading-color)}button{margin:0;cursor:pointer}time{font-family:monospace;font-style:normal;font-size:15px}main{line-height:1.6}table{width:100%}hr{border:0;border-top:1px dashed}img{max-width:100%}code{font-family:monospace;padding:2px;border-radius:3px}blockquote{border-left:1px solid #999;color:var(--blockquote-color);padding-left:20px;font-style:italic}footer{padding:25px 0;text-align:center}.title:hover{text-decoration:none}.title h1{font-size:1.5em}.inline{width:auto!important}.highlight,.code{border-radius:3px;margin-block-start:1em;margin-block-end:1em;overflow-x:auto}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:var(--visited-color)}</style></head><body><header><a href=/ class=title><h2>Keep calm and Write something</h2></a><nav><a href=/post/>Post</a>
<a href=/page/>Page</a>
<a href=/series/>Series</a>
<a href=/tags/>Tag</a>
<a href=/archive/>Archive</a>
<a href=/search/>Search</a></nav></header><main><content><h1 id=install-botkube-for-k8s-and-slack>Install BotKube for k8s and slack</h1><p><a href=https://www.botkube.io/installation/slack/>Slack :: Messaging bot for monitoring and debugging Kubernetes clusters</a></p><pre tabindex=0><code>cychong@mini1:~$ helm repo add infracloudio https://infracloudio.github.io/charts
&#34;infracloudio&#34; has been added to your repositories
cychong@mini1:~$ helm repo update
Hang tight while we grab the latest from your chart repositories...
...Successfully got an update from the &#34;infracloudio&#34; chart repository
...Successfully got an update from the &#34;myhelmrepo&#34; chart repository
Update Complete. ⎈ Happy Helming!⎈
</code></pre><p>botkube를 위한 namespace 만들어주기</p><pre tabindex=0><code>cychong@mini1:~$ kubectl create ns botkube
namespace/botkube created
</code></pre><p>Cluster 이름 알아내기</p><pre tabindex=0><code>cychong@mini1:~$ kubectl config view
apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: DATA+OMITTED
    server: https://192.168.1.100:6443
  name: kubernetes
contexts:
- context:
    cluster: kubernetes
    user: kubernetes-admin
  name: kubernetes-admin@kubernetes
current-context: kubernetes-admin@kubernetes
kind: Config
preferences: {}
users:
- name: kubernetes-admin
  user:
    client-certificate-data: REDACTED
    client-key-data: REDACTED
</code></pre><p>Helm을 이용해서 botkube 설치</p><pre tabindex=0><code>cychong@mini1:~$ helm install --version v0.10.0 botkube --namespace botkube  \
&gt;        --set communications.slack.enabled=true   \
&gt; --set communications.slack.channel=notification \
&gt; --set communications.slack.token=&lt;BOTKUBE_TOKEN_ASSIGNED_DURING_BOTKUBE_APP_INSTALL&gt; \
&gt; --set config.settings.clustername=kubernetes   \
&gt; --set config.settings.allowkubectl=true   \
&gt; --set image.repository=infracloudio/botkube   \
&gt; --set image.tag=v0.10.0   \
&gt; infracloudio/botkube
NAME: botkube
LAST DEPLOYED: Fri Sep  4 23:26:16 2020
NAMESPACE: botkube
STATUS: deployed
REVISION: 1
TEST SUITE: None
</code></pre><pre tabindex=0><code>cychong@mini1:~$ kubectl get pods -n botkube
NAME                     READY   STATUS    RESTARTS   AGE
botkube-8cc75f5f-q6f52   1/1     Running   0          37s
</code></pre><h2 id=botkube-in-slack>BotKube in slack</h2><p>일단 <code>@BotKube</code>를 초대한 후
<img src=/images/2020/09/2020-09-03-botkube-in-slack.png alt></p><h3 id=kubectl-get-commands>kubectl get commands</h3><p><img src=/images/2020/09/2020-09-03-botkube-in-slack-get-pods.png alt></p><h3 id=notification-for-pod-deletion>Notification for pod deletion</h3><p>Pod를 임의로 삭제해 봤는데 이렇게 slack으로 이와 관련된 notification이.
받은 메시지 순서를 보면 우선 장애가 발생한 pod를 대체할 새로운 pod를 만들었다는 메시지가 먼저 오고, 그 다음 pod 장애, pod 삭제 등의 메시지가 수신된다. 요거 좀 확인해 봐야 겠다. 궁금하네.. 적어도 <code>Pod Error</code>가 먼저 올 줄 알았는데&mldr;</p><p><img src=/images/2020/09/2020-09-03-botkube-in-slack-delete-pod.png alt></p><p>Pod가 복구되었는 지 확인해 보니 새로운 pod 가 잘 동작하고 있다. <code>AGE 3m24s</code>
<img src=/images/2020/09/2020-09-03-botkube-in-slack-pod-recovered.png alt></p><p>기본 value에 적힌 권한은 모두 read-only라고 하니 Slack을 이용해서 설정을 변경하려면 value.yaml 파일을 원하는 값으로 만들어 helm 을 다시 적용하면 된다. 일단 오늘은 여기 까지 하고 자야겠다. - <a href=https://www.botkube.io/configuration/>Configuration :: Messaging bot for monitoring and debugging Kubernetes clusters</a> 참고.</p><h2 id=reference>Reference</h2><ul><li><a href=https://www.linuxadvise.com/post/get-set-go-with-botkube>Botkube + Kubernetes</a></li><li><a href=https://www.botkube.io/installation/slack/>Slack :: Messaging bot for monitoring and debugging Kubernetes clusters</a></li></ul><p>#fun-for-life #public</p></content><p><a href=https://cychong47.github.io/tags/slack/>#Slack</a>
<a href=https://cychong47.github.io/tags/kubernetes/>#Kubernetes</a>
<a href=https://cychong47.github.io/tags/til/>#TIL</a></p></main><footer>Made with <a href=https://github.com/janraasch/hugo-bearblog/>Hugo ʕ•ᴥ•ʔ Bear</a></footer></body></html>