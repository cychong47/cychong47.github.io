<!doctype html><html lang=en-us><head><meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Install Influxdb and Grafana With Helm | Keep calm and Write something</title><meta name=title content="Install Influxdb and Grafana With Helm"><meta name=description content='Install InfluxDB with helm
GitHub - influxdata/helm-charts: Official Helm Chart Repository for InfluxData Applications 가 helm chart를 이용한 설치법을 제공하는 공식 페이지.
helm repo add influxdata https://helm.influxdata.com/
$ helm repo list
WARNING: Kubernetes configuration file is group-readable. This is insecure. Location: /home/cychong/.kube/config
WARNING: Kubernetes configuration file is world-readable. This is insecure. Location: /home/cychong/.kube/config
NAME        	URL
myhelmrepo  	https://cychong47.github.io/helm-chart/
infracloudio	https://infracloudio.github.io/charts
influxdata  	https://helm.influxdata.com/
$ helm search repo influxdata
NAME                          	CHART VERSION	APP VERSION	DESCRIPTION
influxdata/chronograf         	1.1.17       	1.8.0      	Open-source web application written in Go and R...
influxdata/influxdb           	4.8.5        	1.8.0      	Scalable datastore for metrics, events, and rea...
influxdata/influxdb-enterprise	0.1.10       	1.8.0      	Run InfluxDB Enterprise on Kubernetes
influxdata/influxdb2          	1.0.7        	2.0.0-beta 	A Helm chart for InfluxDB v2
influxdata/kapacitor          	1.3.1        	1.5.4      	InfluxDB&#39;s native data processing engine. It ca...
influxdata/telegraf           	1.7.25       	1.14       	Telegraf is an agent written in Go for collecti...
influxdata/telegraf-ds        	1.0.16       	1.14       	Telegraf is an agent written in Go for collecti...
influxdata/telegraf-operator  	1.1.3        	v1.1.0     	A Helm chart for Kubernetes to deploy telegraf-...
$ helm upgrade --install -f influxdb-value.yaml influxdb influxdata/influxdb
Release "influxdb" does not exist. Installing it now.
NAME: influxdb
LAST DEPLOYED: Sat Oct  3 10:22:32 2020
NAMESPACE: default
STATUS: deployed
REVISION: 1
TEST SUITE: None
NOTES:
InfluxDB can be accessed via port 8086 on the following DNS name from within your cluster:

  http://influxdb.default:8086

You can connect to the remote instance with the influx CLI. To forward the API port to localhost:8086, run the following:

  kubectl port-forward --namespace default $(kubectl get pods --namespace default -l app=influxdb -o jsonpath=&#39;{ .items[0].metadata.name }&#39;) 8086:8086

You can also connect to the influx CLI from inside the container. To open a shell session in the InfluxDB pod, run the following:

  kubectl exec -i -t --namespace default $(kubectl get pods --namespace default -l app=influxdb -o jsonpath=&#39;{.items[0].metadata.name}&#39;) /bin/sh

To view the logs for the InfluxDB pod, run the following:

  kubectl logs -f --namespace default $(kubectl get pods --namespace default -l app=influxdb -o jsonpath=&#39;{ .items[0].metadata.name }&#39;)
$ kubectl get pods
NAME                             READY   STATUS    RESTARTS   AGE
influxdb-0                       1/1     Running   0          87s
podcast-nginx-659bcb6485-ps7qq   1/1     Running   0          86m
sosa0sa-nginx-87fc9949c-wb4jp    1/1     Running   0          95m

$ kubectl get svc
NAME            TYPE        CLUSTER-IP      EXTERNAL-IP     PORT(S)             AGE
influxdb        ClusterIP   10.110.66.138   <none>          8086/TCP,8088/TCP   92s
kubernetes      ClusterIP   10.96.0.1       <none>          443/TCP             390d
podcast-nginx   NodePort    10.108.15.141   192.168.1.100   8099:30912/TCP      86m
sosa0sa-nginx   NodePort    10.100.21.119   192.168.1.100   80:31806/TCP        95m
InfluxDB container에 접속해서 CLI확인
kubectl exec [POD] [COMMAND] is DEPRECATED and will be removed in a future version. Use kubectl kubectl exec [POD] -- [COMMAND] instead.
bash-4.4# influx
Connected to http://localhost:8086 version 1.8.0
InfluxDB shell version: 1.8.0
>  show databases
name: databases
name
----
_internal
$ helm install -f pocket-stat-value.yaml pocket-stat helm-chart/charts/pocket-stat/
NAME: pocket-stat
LAST DEPLOYED: Sun Oct  4 20:40:11 2020
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
1. Get the application URL by running these commands:
  export NODE_PORT=$(kubectl get --namespace default -o jsonpath="{.spec.ports[0].nodePort}" services pocket-stat)
  export NODE_IP=$(kubectl get nodes --namespace default -o jsonpath="{.items[0].status.addresses[0].address}")
  echo http://$NODE_IP:$NODE_PORT
pocket-stat container를 이용해서 임시 데이터 입력
$ helm install -f pocket-stat-value.yaml pocket-stat ./helm-chart/charts/pocket-stat
NAME: pocket-stat
LAST DEPLOYED: Sun Oct  4 22:46:26 2020
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
1. Get the application URL by running these commands:
  export NODE_PORT=$(kubectl get --namespace default -o jsonpath="{.spec.ports[0].nodePort}" services pocket-stat)
  export NODE_IP=$(kubectl get nodes --namespace default -o jsonpath="{.items[0].status.addresses[0].address}")
  echo http://$NODE_IP:$NODE_PORT

$ kubectl get pods
NAME                             READY   STATUS    RESTARTS   AGE
influxdb-0                       1/1     Running   0          36h
pocket-stat-5b86fbc8f7-xpf9j     1/1     Running   0          20s
podcast-nginx-659bcb6485-ps7qq   1/1     Running   0          37h
sosa0sa-nginx-87fc9949c-wb4jp    1/1     Running   0          37h
pocket-stat example app은 5초 주기로 임의의 데이터를 influxdb에 저장하는 동작 수행'><meta name=keywords content='helm,influxdb,grafana",TIL,'><meta property="og:url" content="https://cychong47.github.io/post/2020/2020-10-04-install-influxdb-grafana-with-helm/"><meta property="og:site_name" content="Keep calm and Write something"><meta property="og:title" content="Install Influxdb and Grafana With Helm"><meta property="og:description" content='Install InfluxDB with helm GitHub - influxdata/helm-charts: Official Helm Chart Repository for InfluxData Applications 가 helm chart를 이용한 설치법을 제공하는 공식 페이지.
helm repo add influxdata https://helm.influxdata.com/ $ helm repo list WARNING: Kubernetes configuration file is group-readable. This is insecure. Location: /home/cychong/.kube/config WARNING: Kubernetes configuration file is world-readable. This is insecure. Location: /home/cychong/.kube/config NAME URL myhelmrepo https://cychong47.github.io/helm-chart/ infracloudio	https://infracloudio.github.io/charts influxdata https://helm.influxdata.com/ $ helm search repo influxdata NAME CHART VERSION	APP VERSION	DESCRIPTION influxdata/chronograf 1.1.17 1.8.0 Open-source web application written in Go and R... influxdata/influxdb 4.8.5 1.8.0 Scalable datastore for metrics, events, and rea... influxdata/influxdb-enterprise	0.1.10 1.8.0 Run InfluxDB Enterprise on Kubernetes influxdata/influxdb2 1.0.7 2.0.0-beta A Helm chart for InfluxDB v2 influxdata/kapacitor 1.3.1 1.5.4 InfluxDB&#39;s native data processing engine. It ca... influxdata/telegraf 1.7.25 1.14 Telegraf is an agent written in Go for collecti... influxdata/telegraf-ds 1.0.16 1.14 Telegraf is an agent written in Go for collecti... influxdata/telegraf-operator 1.1.3 v1.1.0 A Helm chart for Kubernetes to deploy telegraf-... $ helm upgrade --install -f influxdb-value.yaml influxdb influxdata/influxdb Release "influxdb" does not exist. Installing it now. NAME: influxdb LAST DEPLOYED: Sat Oct 3 10:22:32 2020 NAMESPACE: default STATUS: deployed REVISION: 1 TEST SUITE: None NOTES: InfluxDB can be accessed via port 8086 on the following DNS name from within your cluster: http://influxdb.default:8086 You can connect to the remote instance with the influx CLI. To forward the API port to localhost:8086, run the following: kubectl port-forward --namespace default $(kubectl get pods --namespace default -l app=influxdb -o jsonpath=&#39;{ .items[0].metadata.name }&#39;) 8086:8086 You can also connect to the influx CLI from inside the container. To open a shell session in the InfluxDB pod, run the following: kubectl exec -i -t --namespace default $(kubectl get pods --namespace default -l app=influxdb -o jsonpath=&#39;{.items[0].metadata.name}&#39;) /bin/sh To view the logs for the InfluxDB pod, run the following: kubectl logs -f --namespace default $(kubectl get pods --namespace default -l app=influxdb -o jsonpath=&#39;{ .items[0].metadata.name }&#39;) $ kubectl get pods NAME READY STATUS RESTARTS AGE influxdb-0 1/1 Running 0 87s podcast-nginx-659bcb6485-ps7qq 1/1 Running 0 86m sosa0sa-nginx-87fc9949c-wb4jp 1/1 Running 0 95m $ kubectl get svc NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE influxdb ClusterIP 10.110.66.138 <none> 8086/TCP,8088/TCP 92s kubernetes ClusterIP 10.96.0.1 <none> 443/TCP 390d podcast-nginx NodePort 10.108.15.141 192.168.1.100 8099:30912/TCP 86m sosa0sa-nginx NodePort 10.100.21.119 192.168.1.100 80:31806/TCP 95m InfluxDB container에 접속해서 CLI확인 kubectl exec [POD] [COMMAND] is DEPRECATED and will be removed in a future version. Use kubectl kubectl exec [POD] -- [COMMAND] instead. bash-4.4# influx Connected to http://localhost:8086 version 1.8.0 InfluxDB shell version: 1.8.0 > show databases name: databases name ---- _internal $ helm install -f pocket-stat-value.yaml pocket-stat helm-chart/charts/pocket-stat/ NAME: pocket-stat LAST DEPLOYED: Sun Oct 4 20:40:11 2020 NAMESPACE: default STATUS: deployed REVISION: 1 NOTES: 1. Get the application URL by running these commands: export NODE_PORT=$(kubectl get --namespace default -o jsonpath="{.spec.ports[0].nodePort}" services pocket-stat) export NODE_IP=$(kubectl get nodes --namespace default -o jsonpath="{.items[0].status.addresses[0].address}") echo http://$NODE_IP:$NODE_PORT pocket-stat container를 이용해서 임시 데이터 입력 $ helm install -f pocket-stat-value.yaml pocket-stat ./helm-chart/charts/pocket-stat NAME: pocket-stat LAST DEPLOYED: Sun Oct 4 22:46:26 2020 NAMESPACE: default STATUS: deployed REVISION: 1 NOTES: 1. Get the application URL by running these commands: export NODE_PORT=$(kubectl get --namespace default -o jsonpath="{.spec.ports[0].nodePort}" services pocket-stat) export NODE_IP=$(kubectl get nodes --namespace default -o jsonpath="{.items[0].status.addresses[0].address}") echo http://$NODE_IP:$NODE_PORT $ kubectl get pods NAME READY STATUS RESTARTS AGE influxdb-0 1/1 Running 0 36h pocket-stat-5b86fbc8f7-xpf9j 1/1 Running 0 20s podcast-nginx-659bcb6485-ps7qq 1/1 Running 0 37h sosa0sa-nginx-87fc9949c-wb4jp 1/1 Running 0 37h pocket-stat example app은 5초 주기로 임의의 데이터를 influxdb에 저장하는 동작 수행'><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2020-10-04T23:36:26+09:00"><meta property="article:modified_time" content="2020-10-04T23:36:26+09:00"><meta property="article:tag" content="Helm"><meta property="article:tag" content="Influxdb"><meta property="article:tag" content='Grafana"'><meta property="article:tag" content="TIL"><meta name=twitter:card content="summary"><meta name=twitter:title content="Install Influxdb and Grafana With Helm"><meta name=twitter:description content='Install InfluxDB with helm GitHub - influxdata/helm-charts: Official Helm Chart Repository for InfluxData Applications 가 helm chart를 이용한 설치법을 제공하는 공식 페이지.
helm repo add influxdata https://helm.influxdata.com/ $ helm repo list WARNING: Kubernetes configuration file is group-readable. This is insecure. Location: /home/cychong/.kube/config WARNING: Kubernetes configuration file is world-readable. This is insecure. Location: /home/cychong/.kube/config NAME URL myhelmrepo https://cychong47.github.io/helm-chart/ infracloudio	https://infracloudio.github.io/charts influxdata https://helm.influxdata.com/ $ helm search repo influxdata NAME CHART VERSION	APP VERSION	DESCRIPTION influxdata/chronograf 1.1.17 1.8.0 Open-source web application written in Go and R... influxdata/influxdb 4.8.5 1.8.0 Scalable datastore for metrics, events, and rea... influxdata/influxdb-enterprise	0.1.10 1.8.0 Run InfluxDB Enterprise on Kubernetes influxdata/influxdb2 1.0.7 2.0.0-beta A Helm chart for InfluxDB v2 influxdata/kapacitor 1.3.1 1.5.4 InfluxDB&#39;s native data processing engine. It ca... influxdata/telegraf 1.7.25 1.14 Telegraf is an agent written in Go for collecti... influxdata/telegraf-ds 1.0.16 1.14 Telegraf is an agent written in Go for collecti... influxdata/telegraf-operator 1.1.3 v1.1.0 A Helm chart for Kubernetes to deploy telegraf-... $ helm upgrade --install -f influxdb-value.yaml influxdb influxdata/influxdb Release "influxdb" does not exist. Installing it now. NAME: influxdb LAST DEPLOYED: Sat Oct 3 10:22:32 2020 NAMESPACE: default STATUS: deployed REVISION: 1 TEST SUITE: None NOTES: InfluxDB can be accessed via port 8086 on the following DNS name from within your cluster: http://influxdb.default:8086 You can connect to the remote instance with the influx CLI. To forward the API port to localhost:8086, run the following: kubectl port-forward --namespace default $(kubectl get pods --namespace default -l app=influxdb -o jsonpath=&#39;{ .items[0].metadata.name }&#39;) 8086:8086 You can also connect to the influx CLI from inside the container. To open a shell session in the InfluxDB pod, run the following: kubectl exec -i -t --namespace default $(kubectl get pods --namespace default -l app=influxdb -o jsonpath=&#39;{.items[0].metadata.name}&#39;) /bin/sh To view the logs for the InfluxDB pod, run the following: kubectl logs -f --namespace default $(kubectl get pods --namespace default -l app=influxdb -o jsonpath=&#39;{ .items[0].metadata.name }&#39;) $ kubectl get pods NAME READY STATUS RESTARTS AGE influxdb-0 1/1 Running 0 87s podcast-nginx-659bcb6485-ps7qq 1/1 Running 0 86m sosa0sa-nginx-87fc9949c-wb4jp 1/1 Running 0 95m $ kubectl get svc NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE influxdb ClusterIP 10.110.66.138 <none> 8086/TCP,8088/TCP 92s kubernetes ClusterIP 10.96.0.1 <none> 443/TCP 390d podcast-nginx NodePort 10.108.15.141 192.168.1.100 8099:30912/TCP 86m sosa0sa-nginx NodePort 10.100.21.119 192.168.1.100 80:31806/TCP 95m InfluxDB container에 접속해서 CLI확인 kubectl exec [POD] [COMMAND] is DEPRECATED and will be removed in a future version. Use kubectl kubectl exec [POD] -- [COMMAND] instead. bash-4.4# influx Connected to http://localhost:8086 version 1.8.0 InfluxDB shell version: 1.8.0 > show databases name: databases name ---- _internal $ helm install -f pocket-stat-value.yaml pocket-stat helm-chart/charts/pocket-stat/ NAME: pocket-stat LAST DEPLOYED: Sun Oct 4 20:40:11 2020 NAMESPACE: default STATUS: deployed REVISION: 1 NOTES: 1. Get the application URL by running these commands: export NODE_PORT=$(kubectl get --namespace default -o jsonpath="{.spec.ports[0].nodePort}" services pocket-stat) export NODE_IP=$(kubectl get nodes --namespace default -o jsonpath="{.items[0].status.addresses[0].address}") echo http://$NODE_IP:$NODE_PORT pocket-stat container를 이용해서 임시 데이터 입력 $ helm install -f pocket-stat-value.yaml pocket-stat ./helm-chart/charts/pocket-stat NAME: pocket-stat LAST DEPLOYED: Sun Oct 4 22:46:26 2020 NAMESPACE: default STATUS: deployed REVISION: 1 NOTES: 1. Get the application URL by running these commands: export NODE_PORT=$(kubectl get --namespace default -o jsonpath="{.spec.ports[0].nodePort}" services pocket-stat) export NODE_IP=$(kubectl get nodes --namespace default -o jsonpath="{.items[0].status.addresses[0].address}") echo http://$NODE_IP:$NODE_PORT $ kubectl get pods NAME READY STATUS RESTARTS AGE influxdb-0 1/1 Running 0 36h pocket-stat-5b86fbc8f7-xpf9j 1/1 Running 0 20s podcast-nginx-659bcb6485-ps7qq 1/1 Running 0 37h sosa0sa-nginx-87fc9949c-wb4jp 1/1 Running 0 37h pocket-stat example app은 5초 주기로 임의의 데이터를 influxdb에 저장하는 동작 수행'><meta itemprop=name content="Install Influxdb and Grafana With Helm"><meta itemprop=description content='Install InfluxDB with helm GitHub - influxdata/helm-charts: Official Helm Chart Repository for InfluxData Applications 가 helm chart를 이용한 설치법을 제공하는 공식 페이지.
helm repo add influxdata https://helm.influxdata.com/ $ helm repo list WARNING: Kubernetes configuration file is group-readable. This is insecure. Location: /home/cychong/.kube/config WARNING: Kubernetes configuration file is world-readable. This is insecure. Location: /home/cychong/.kube/config NAME URL myhelmrepo https://cychong47.github.io/helm-chart/ infracloudio	https://infracloudio.github.io/charts influxdata https://helm.influxdata.com/ $ helm search repo influxdata NAME CHART VERSION	APP VERSION	DESCRIPTION influxdata/chronograf 1.1.17 1.8.0 Open-source web application written in Go and R... influxdata/influxdb 4.8.5 1.8.0 Scalable datastore for metrics, events, and rea... influxdata/influxdb-enterprise	0.1.10 1.8.0 Run InfluxDB Enterprise on Kubernetes influxdata/influxdb2 1.0.7 2.0.0-beta A Helm chart for InfluxDB v2 influxdata/kapacitor 1.3.1 1.5.4 InfluxDB&#39;s native data processing engine. It ca... influxdata/telegraf 1.7.25 1.14 Telegraf is an agent written in Go for collecti... influxdata/telegraf-ds 1.0.16 1.14 Telegraf is an agent written in Go for collecti... influxdata/telegraf-operator 1.1.3 v1.1.0 A Helm chart for Kubernetes to deploy telegraf-... $ helm upgrade --install -f influxdb-value.yaml influxdb influxdata/influxdb Release "influxdb" does not exist. Installing it now. NAME: influxdb LAST DEPLOYED: Sat Oct 3 10:22:32 2020 NAMESPACE: default STATUS: deployed REVISION: 1 TEST SUITE: None NOTES: InfluxDB can be accessed via port 8086 on the following DNS name from within your cluster: http://influxdb.default:8086 You can connect to the remote instance with the influx CLI. To forward the API port to localhost:8086, run the following: kubectl port-forward --namespace default $(kubectl get pods --namespace default -l app=influxdb -o jsonpath=&#39;{ .items[0].metadata.name }&#39;) 8086:8086 You can also connect to the influx CLI from inside the container. To open a shell session in the InfluxDB pod, run the following: kubectl exec -i -t --namespace default $(kubectl get pods --namespace default -l app=influxdb -o jsonpath=&#39;{.items[0].metadata.name}&#39;) /bin/sh To view the logs for the InfluxDB pod, run the following: kubectl logs -f --namespace default $(kubectl get pods --namespace default -l app=influxdb -o jsonpath=&#39;{ .items[0].metadata.name }&#39;) $ kubectl get pods NAME READY STATUS RESTARTS AGE influxdb-0 1/1 Running 0 87s podcast-nginx-659bcb6485-ps7qq 1/1 Running 0 86m sosa0sa-nginx-87fc9949c-wb4jp 1/1 Running 0 95m $ kubectl get svc NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE influxdb ClusterIP 10.110.66.138 <none> 8086/TCP,8088/TCP 92s kubernetes ClusterIP 10.96.0.1 <none> 443/TCP 390d podcast-nginx NodePort 10.108.15.141 192.168.1.100 8099:30912/TCP 86m sosa0sa-nginx NodePort 10.100.21.119 192.168.1.100 80:31806/TCP 95m InfluxDB container에 접속해서 CLI확인 kubectl exec [POD] [COMMAND] is DEPRECATED and will be removed in a future version. Use kubectl kubectl exec [POD] -- [COMMAND] instead. bash-4.4# influx Connected to http://localhost:8086 version 1.8.0 InfluxDB shell version: 1.8.0 > show databases name: databases name ---- _internal $ helm install -f pocket-stat-value.yaml pocket-stat helm-chart/charts/pocket-stat/ NAME: pocket-stat LAST DEPLOYED: Sun Oct 4 20:40:11 2020 NAMESPACE: default STATUS: deployed REVISION: 1 NOTES: 1. Get the application URL by running these commands: export NODE_PORT=$(kubectl get --namespace default -o jsonpath="{.spec.ports[0].nodePort}" services pocket-stat) export NODE_IP=$(kubectl get nodes --namespace default -o jsonpath="{.items[0].status.addresses[0].address}") echo http://$NODE_IP:$NODE_PORT pocket-stat container를 이용해서 임시 데이터 입력 $ helm install -f pocket-stat-value.yaml pocket-stat ./helm-chart/charts/pocket-stat NAME: pocket-stat LAST DEPLOYED: Sun Oct 4 22:46:26 2020 NAMESPACE: default STATUS: deployed REVISION: 1 NOTES: 1. Get the application URL by running these commands: export NODE_PORT=$(kubectl get --namespace default -o jsonpath="{.spec.ports[0].nodePort}" services pocket-stat) export NODE_IP=$(kubectl get nodes --namespace default -o jsonpath="{.items[0].status.addresses[0].address}") echo http://$NODE_IP:$NODE_PORT $ kubectl get pods NAME READY STATUS RESTARTS AGE influxdb-0 1/1 Running 0 36h pocket-stat-5b86fbc8f7-xpf9j 1/1 Running 0 20s podcast-nginx-659bcb6485-ps7qq 1/1 Running 0 37h sosa0sa-nginx-87fc9949c-wb4jp 1/1 Running 0 37h pocket-stat example app은 5초 주기로 임의의 데이터를 influxdb에 저장하는 동작 수행'><meta itemprop=datePublished content="2020-10-04T23:36:26+09:00"><meta itemprop=dateModified content="2020-10-04T23:36:26+09:00"><meta itemprop=wordCount content="1197"><meta itemprop=keywords content='Helm,Influxdb,Grafana",TIL'><meta name=referrer content="no-referrer-when-downgrade"><style>:root{--width:720px;--font-main:Verdana, sans-serif;--font-secondary:Verdana, sans-serif;--font-scale:1em;--background-color:#fafafa;--heading-color:#222;--text-color:#444;--link-color:#3273dc;--visited-color:#8b6fcb;--blockquote-color:#222}@media(prefers-color-scheme:dark){:root{--background-color:#fafafa;--heading-color:#222;--text-color:#444;--link-color:#3273dc;--visited-color:#8b6fcb;--blockquote-color:#222}}body{font-family:var(--font-secondary);font-size:var(--font-scale);margin:auto;padding:20px;max-width:var(--width);text-align:left;background-color:var(--background-color);word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:var(--text-color)}h1,h2,h3,h4,h5,h6{font-family:var(--font-main);color:var(--heading-color)}a{color:var(--link-color);cursor:pointer;text-decoration:none}a:hover{text-decoration:underline}nav a{margin-right:8px}strong,b{color:var(--heading-color)}button{margin:0;cursor:pointer}time{font-family:monospace;font-style:normal;font-size:15px}main{line-height:1.6}table{width:100%}hr{border:0;border-top:1px dashed}img{max-width:100%}code{font-family:monospace;padding:2px;border-radius:3px}blockquote{border-left:1px solid #999;color:var(--blockquote-color);padding-left:20px;font-style:italic}footer{padding:25px 0;text-align:center}.title:hover{text-decoration:none}.title h1{font-size:1.5em}.inline{width:auto!important}.highlight,.code{border-radius:3px;margin-block-start:1em;margin-block-end:1em;overflow-x:auto}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:var(--visited-color)}</style></head><body><header><a href=/ class=title><h2>Keep calm and Write something</h2></a><nav><a href=/post/>Post</a>
<a href=/page/>Page</a>
<a href=/series/>Series</a>
<a href=/tags/>Tag</a>
<a href=/archive/>Archive</a>
<a href=/search/>Search</a></nav></header><main><content><h2 id=install-influxdb-with-helm>Install InfluxDB with helm</h2><p><a href=https://github.com/influxdata/helm-charts>GitHub - influxdata/helm-charts: Official Helm Chart Repository for InfluxData Applications</a> 가 helm chart를 이용한 설치법을 제공하는 공식 페이지.</p><pre tabindex=0><code>helm repo add influxdata https://helm.influxdata.com/
</code></pre><pre tabindex=0><code>$ helm repo list
WARNING: Kubernetes configuration file is group-readable. This is insecure. Location: /home/cychong/.kube/config
WARNING: Kubernetes configuration file is world-readable. This is insecure. Location: /home/cychong/.kube/config
NAME        	URL
myhelmrepo  	https://cychong47.github.io/helm-chart/
infracloudio	https://infracloudio.github.io/charts
influxdata  	https://helm.influxdata.com/
</code></pre><pre tabindex=0><code>$ helm search repo influxdata
NAME                          	CHART VERSION	APP VERSION	DESCRIPTION
influxdata/chronograf         	1.1.17       	1.8.0      	Open-source web application written in Go and R...
influxdata/influxdb           	4.8.5        	1.8.0      	Scalable datastore for metrics, events, and rea...
influxdata/influxdb-enterprise	0.1.10       	1.8.0      	Run InfluxDB Enterprise on Kubernetes
influxdata/influxdb2          	1.0.7        	2.0.0-beta 	A Helm chart for InfluxDB v2
influxdata/kapacitor          	1.3.1        	1.5.4      	InfluxDB&#39;s native data processing engine. It ca...
influxdata/telegraf           	1.7.25       	1.14       	Telegraf is an agent written in Go for collecti...
influxdata/telegraf-ds        	1.0.16       	1.14       	Telegraf is an agent written in Go for collecti...
influxdata/telegraf-operator  	1.1.3        	v1.1.0     	A Helm chart for Kubernetes to deploy telegraf-...
</code></pre><pre tabindex=0><code>$ helm upgrade --install -f influxdb-value.yaml influxdb influxdata/influxdb
Release &#34;influxdb&#34; does not exist. Installing it now.
NAME: influxdb
LAST DEPLOYED: Sat Oct  3 10:22:32 2020
NAMESPACE: default
STATUS: deployed
REVISION: 1
TEST SUITE: None
NOTES:
InfluxDB can be accessed via port 8086 on the following DNS name from within your cluster:

  http://influxdb.default:8086

You can connect to the remote instance with the influx CLI. To forward the API port to localhost:8086, run the following:

  kubectl port-forward --namespace default $(kubectl get pods --namespace default -l app=influxdb -o jsonpath=&#39;{ .items[0].metadata.name }&#39;) 8086:8086

You can also connect to the influx CLI from inside the container. To open a shell session in the InfluxDB pod, run the following:

  kubectl exec -i -t --namespace default $(kubectl get pods --namespace default -l app=influxdb -o jsonpath=&#39;{.items[0].metadata.name}&#39;) /bin/sh

To view the logs for the InfluxDB pod, run the following:

  kubectl logs -f --namespace default $(kubectl get pods --namespace default -l app=influxdb -o jsonpath=&#39;{ .items[0].metadata.name }&#39;)
</code></pre><pre tabindex=0><code>$ kubectl get pods
NAME                             READY   STATUS    RESTARTS   AGE
influxdb-0                       1/1     Running   0          87s
podcast-nginx-659bcb6485-ps7qq   1/1     Running   0          86m
sosa0sa-nginx-87fc9949c-wb4jp    1/1     Running   0          95m

$ kubectl get svc
NAME            TYPE        CLUSTER-IP      EXTERNAL-IP     PORT(S)             AGE
influxdb        ClusterIP   10.110.66.138   &lt;none&gt;          8086/TCP,8088/TCP   92s
kubernetes      ClusterIP   10.96.0.1       &lt;none&gt;          443/TCP             390d
podcast-nginx   NodePort    10.108.15.141   192.168.1.100   8099:30912/TCP      86m
sosa0sa-nginx   NodePort    10.100.21.119   192.168.1.100   80:31806/TCP        95m
</code></pre><h3 id=influxdb-container에-접속해서-cli확인>InfluxDB container에 접속해서 CLI확인</h3><pre tabindex=0><code>kubectl exec [POD] [COMMAND] is DEPRECATED and will be removed in a future version. Use kubectl kubectl exec [POD] -- [COMMAND] instead.
bash-4.4# influx
Connected to http://localhost:8086 version 1.8.0
InfluxDB shell version: 1.8.0
&gt;  show databases
name: databases
name
----
_internal
</code></pre><pre tabindex=0><code>$ helm install -f pocket-stat-value.yaml pocket-stat helm-chart/charts/pocket-stat/
NAME: pocket-stat
LAST DEPLOYED: Sun Oct  4 20:40:11 2020
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
1. Get the application URL by running these commands:
  export NODE_PORT=$(kubectl get --namespace default -o jsonpath=&#34;{.spec.ports[0].nodePort}&#34; services pocket-stat)
  export NODE_IP=$(kubectl get nodes --namespace default -o jsonpath=&#34;{.items[0].status.addresses[0].address}&#34;)
  echo http://$NODE_IP:$NODE_PORT
</code></pre><h2 id=pocket-stat-container를-이용해서-임시-데이터-입력><code>pocket-stat</code> container를 이용해서 임시 데이터 입력</h2><pre tabindex=0><code>$ helm install -f pocket-stat-value.yaml pocket-stat ./helm-chart/charts/pocket-stat
NAME: pocket-stat
LAST DEPLOYED: Sun Oct  4 22:46:26 2020
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
1. Get the application URL by running these commands:
  export NODE_PORT=$(kubectl get --namespace default -o jsonpath=&#34;{.spec.ports[0].nodePort}&#34; services pocket-stat)
  export NODE_IP=$(kubectl get nodes --namespace default -o jsonpath=&#34;{.items[0].status.addresses[0].address}&#34;)
  echo http://$NODE_IP:$NODE_PORT

$ kubectl get pods
NAME                             READY   STATUS    RESTARTS   AGE
influxdb-0                       1/1     Running   0          36h
pocket-stat-5b86fbc8f7-xpf9j     1/1     Running   0          20s
podcast-nginx-659bcb6485-ps7qq   1/1     Running   0          37h
sosa0sa-nginx-87fc9949c-wb4jp    1/1     Running   0          37h
</code></pre><p><code>pocket-stat</code> example app은 5초 주기로 임의의 데이터를 influxdb에 저장하는 동작 수행</p><p>이제 <code>influxdb</code>에 접속해서 database에 데이터가 입력되고 있는 지 확인</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl exec -it influxdb-0 /bin/bash
</span></span><span style=display:flex><span>kubectl exec <span style=color:#f92672>[</span>POD<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>COMMAND<span style=color:#f92672>]</span> is DEPRECATED and will be removed in a future version. Use kubectl kubectl exec <span style=color:#f92672>[</span>POD<span style=color:#f92672>]</span> -- <span style=color:#f92672>[</span>COMMAND<span style=color:#f92672>]</span> instead.
</span></span><span style=display:flex><span>bash-4.4# influx
</span></span><span style=display:flex><span>Connected to http://localhost:8086 version 1.8.0
</span></span><span style=display:flex><span>InfluxDB shell version: 1.8.0
</span></span><span style=display:flex><span>&gt; show databases
</span></span><span style=display:flex><span>name: databases
</span></span><span style=display:flex><span>name
</span></span><span style=display:flex><span>----
</span></span><span style=display:flex><span>_internal
</span></span><span style=display:flex><span>example
</span></span><span style=display:flex><span>&gt; use example
</span></span><span style=display:flex><span>Using database example
</span></span><span style=display:flex><span>&gt; show field keys;
</span></span><span style=display:flex><span>name: throughput
</span></span><span style=display:flex><span>fieldKey fieldType
</span></span><span style=display:flex><span>-------- ---------
</span></span><span style=display:flex><span>dl_tp    integer
</span></span><span style=display:flex><span>ul_tp    integer
</span></span><span style=display:flex><span>&gt; <span style=color:#66d9ef>select</span> * from throughput;
</span></span><span style=display:flex><span>name: throughput
</span></span><span style=display:flex><span>time                dl_tp host     region  ul_tp
</span></span><span style=display:flex><span>----                ----- ----     ------  -----
</span></span><span style=display:flex><span><span style=color:#ae81ff>1601819189000000000</span> <span style=color:#ae81ff>192</span>   server01 us-west <span style=color:#ae81ff>52</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1601819194000000000</span> <span style=color:#ae81ff>156</span>   server01 us-west <span style=color:#ae81ff>53</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1601819199000000000</span> <span style=color:#ae81ff>189</span>   server01 us-west <span style=color:#ae81ff>62</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1601819204000000000</span> <span style=color:#ae81ff>168</span>   server01 us-west <span style=color:#ae81ff>55</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1601819209000000000</span> <span style=color:#ae81ff>191</span>   server01 us-west <span style=color:#ae81ff>54</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1601819214000000000</span> <span style=color:#ae81ff>182</span>   server01 us-west <span style=color:#ae81ff>51</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1601819219000000000</span> <span style=color:#ae81ff>181</span>   server01 us-west <span style=color:#ae81ff>60</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1601819224000000000</span> <span style=color:#ae81ff>166</span>   server01 us-west <span style=color:#ae81ff>58</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1601819229000000000</span> <span style=color:#ae81ff>198</span>   server01 us-west <span style=color:#ae81ff>69</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1601819234000000000</span> <span style=color:#ae81ff>190</span>   server01 us-west <span style=color:#ae81ff>55</span>
</span></span></code></pre></div><h2 id=install-grafana-with-helm>Install Grafana with helm</h2><p><a href=https://github.com/grafana/helm-charts>GitHub - grafana/helm-charts</a> 의 내용을 참고한다.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ helm repo add grafana https://grafana.github.io/helm-charts
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;grafana&#34;</span> has been added to your repositories
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ helm search repo grafana
</span></span><span style=display:flex><span>NAME           	CHART VERSION	APP VERSION	DESCRIPTION
</span></span><span style=display:flex><span>grafana/grafana	5.7.0        	7.2.0      	The leading tool <span style=color:#66d9ef>for</span> querying and visualizing t...
</span></span></code></pre></div><p>ClusterIP를</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>service</span>:
</span></span><span style=display:flex><span>        <span style=color:#75715e># type: ClusterIP</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># port: 80</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># targetPort: 3000</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>#   # targetPort: 4181 To be used with a proxy extraContainer</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>NodePort</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>3000</span>              <span style=color:#75715e># container app. itself</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>port</span>: <span style=color:#ae81ff>3000</span>                    <span style=color:#75715e># pod</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>nodePort</span>: <span style=color:#ae81ff>3000</span>                <span style=color:#75715e># cluster-wise</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>externalTrafficPolicy</span>: <span style=color:#ae81ff>Local</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>externalIPs</span>: [<span style=color:#ae81ff>192.168.1.100</span>]
</span></span><span style=display:flex><span>  <span style=color:#f92672>annotations</span>: {}
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>: {}
</span></span><span style=display:flex><span>  <span style=color:#f92672>portName</span>: <span style=color:#ae81ff>service</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ helm install -f grafana-value.yaml grafana grafana/grafana
</span></span><span style=display:flex><span>Error: Service <span style=color:#e6db74>&#34;grafana&#34;</span> is invalid: spec.ports<span style=color:#f92672>[</span>0<span style=color:#f92672>]</span>.nodePort: Invalid value: 3000: provided port is not in the valid range. The range of valid ports is 30000-32767
</span></span></code></pre></div><p>흠.. 다른 경우에 이렇게 사용했는데 뭔가 제대로 확인하는 것 같은 느낌.. 일단 다음과 같이 수정했다.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>service</span>:
</span></span><span style=display:flex><span>        <span style=color:#75715e># type: ClusterIP</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># port: 80</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># targetPort: 3000</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>#   # targetPort: 4181 To be used with a proxy extraContainer</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>NodePort</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>3000</span>              <span style=color:#75715e># container app. itself</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>port</span>: <span style=color:#ae81ff>80</span>                      <span style=color:#75715e># pod</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>nodePort</span>: <span style=color:#ae81ff>30000</span>               <span style=color:#75715e># cluster-wise</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>externalTrafficPolicy</span>: <span style=color:#ae81ff>Local</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>externalIPs</span>: [<span style=color:#ae81ff>192.168.1.100</span>]
</span></span><span style=display:flex><span>  <span style=color:#f92672>annotations</span>: {}
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>: {}
</span></span><span style=display:flex><span>  <span style=color:#f92672>portName</span>: <span style=color:#ae81ff>service</span>
</span></span></code></pre></div><pre tabindex=0><code>$ helm install -f grafana-value.yaml grafana grafana/grafana
NAME: grafana
LAST DEPLOYED: Sun Oct  4 23:01:12 2020
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
1. Get your &#39;admin&#39; user password by running:

   kubectl get secret --namespace default grafana -o jsonpath=&#34;{.data.admin-password}&#34; | base64 --decode ; echo

2. The Grafana server can be accessed via port 80 on the following DNS name from within your cluster:

   grafana.default.svc.cluster.local

   Get the Grafana URL to visit by running these commands in the same shell:
export NODE_PORT=$(kubectl get --namespace default -o jsonpath=&#34;{.spec.ports[0].nodePort}&#34; services grafana)
     export NODE_IP=$(kubectl get nodes --namespace default -o jsonpath=&#34;{.items[0].status.addresses[0].address}&#34;)
     echo http://$NODE_IP:$NODE_PORT


3. Login with the password from step 1 and the username: admin
#################################################################################
######   WARNING: Persistence is disabled!!! You will lose your data when   #####
######            the Grafana pod is terminated.                            #####
#################################################################################
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl get secret --namespace default grafana -o jsonpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;{.data.admin-password}&#34;</span> | base64 --decode ; echo
</span></span><span style=display:flex><span>!@#!$!@!%!$
</span></span></code></pre></div><pre tabindex=0><code>$ export NODE_PORT=$(kubectl get --namespace default -o jsonpath=&#34;{.spec.ports[0].nodePort}&#34; services grafana)

$ echo $NODE_PORT
30000
</code></pre><p>이제 web을 통해 접속하면.
로그인 ID는 Grafana를 deploy했을 때 나온 안내에 있는 대로 <code>admin</code> 이고, 암호는 위의 명령을 통해 찾은 값을 사용해서 로그인한다.<br><img src=/images/2020/10/2020-10-04-install-grafana-with-helm-login.png alt></p><p>로그인하면 이상한(?) 기본 데이터가 보이는데 뭔가 의미있는 정보겠지. 아마도 Grafana자체가 가지고 있는 어떤 metric이 아닌가 싶은데.</p><p><img src=/images/2020/10/2020-10-04-install-grafana-with-helm-default-grafana-dashboard.png alt></p><p>원하는 것은 influxdb에 저장된 데이터를 사용하는 것이므로, 아래 화면과 같이 “Data Sources”를 선택해서 Influxdb를 연결한다.</p><p>어렴풋이 <a href=https://cychong47.github.io/post/2018/grafana-influxdb-and-python/>예전에 했던</a> 기억이 살짝 나려고 한다.</p><p><img src=/images/2020/10/2020-10-04-install-grafana-with-helm-add-influxdb-1.png alt></p><p><img src=/images/2020/10/2020-10-04-install-grafana-with-helm-add-influxdb-2.png alt></p><p>influxdb container에 대한 정보를 넣어주고 <code>Save & Test</code>를 누르니 한번에 OK가 뜬다. 이런 경우는 잘 없었는데 ….
<img src=/images/2020/10/2020-10-04-install-grafana-with-helm-add-influxdb-3.png alt></p><p>역시 이전에 했던 기억을 되살려 데이터를 지정해 보는데
<img src=/images/2020/10/2020-10-04-install-grafana-with-helm-set-query-1.png alt></p><p><img src=/images/2020/10/2020-10-04-install-grafana-with-helm-set-query-2.png alt></p><p>이제 3개 pod가 연동하는 걸 봤으니 test app은 삭제하고, 실제 의미있는 데이터를 넣어봐야겠다.</p><pre tabindex=0><code>$ helm uninstall pocket-stat
release &#34;pocket-stat&#34; uninstalled
</code></pre><h2 id=reference>Reference</h2><ul><li><a href=https://github.com/influxdata/helm-charts>GitHub - influxdata/helm-charts: Official Helm Chart Repository for InfluxData Applications</a> influxdb를 helm으로 설치하기</li><li><a href=https://github.com/influxdata/helm-charts/tree/master/charts/influxdb>helm-charts/charts/influxdb at master · influxdata/helm-charts · GitHub</a></li></ul><ul><li><a href=https://cychong47.github.io/post/2018/grafana-influxdb-and-python/>Grafana, influxDB and python - Keep calm and write something</a></li><li><a href=https://github.com/grafana/helm-charts>GitHub - grafana/helm-charts</a> Grafana를 helm으로 설치하기</li></ul><p>#fun-for-life #helm #publish</p></content><p><a href=https://cychong47.github.io/tags/helm/>#Helm</a>
<a href=https://cychong47.github.io/tags/influxdb/>#Influxdb</a>
<a href=https://cychong47.github.io/tags/grafana/>#Grafana"</a>
<a href=https://cychong47.github.io/tags/til/>#TIL</a></p></main><footer>Made with <a href=https://github.com/janraasch/hugo-bearblog/>Hugo ʕ•ᴥ•ʔ Bear</a></footer></body></html>