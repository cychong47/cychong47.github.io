<!doctype html><html lang=en-us><head><meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Setup Ingress with Traefik | Keep calm and Write something</title><meta name=title content="Setup Ingress with Traefik"><meta name=description content='Ingress Controller ë¥¼ ì„¤ì¹˜(Helmìœ¼ë¡œ Traefik ì„¤ì¹˜í•˜ê¸°)í–ˆìœ¼ë‹ˆ ì´ì œ Ingressë¥¼ ì„¤ì •í•´ì„œ ì‹¤ì œ cluster ì™¸ë¶€ë¡œë¶€í„°ì˜ http/https ë©”ì‹œì§€ë¥¼ nginx podì— ì „ë‹¬ë˜ê²Œ í•´ ë³¸ë‹¤.
Ingress
IngressëŠ” Cluster ì™¸ë¶€ì—ì„œ ì ‘ê·¼í•˜ëŠ” http/https requestì— ëŒ€í•œ ë¼ìš°íŒ…ì„ ì œì–´í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.
Ingress | Kubernetes
ingress.yaml íŒŒì¼ì„ ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•œë‹¤. . ì•„ë˜ëŠ” ë‘ ê°€ì§€ ruleì„ ì„¤ì •í•˜ê³  ìˆëŠ”ë° hostê°€ â€˜mini1â€™ì´ê³ , URL pathê°€ /ostë©´ podcast-nginxë¼ëŠ” ì„œë¹„ìŠ¤ë¡œ ì „ë‹¬í•˜ê²Œ í•˜ëŠ” ê²ƒê³¼ hostëŠ” ìƒê´€ì—†ì´ pathê°€ /ostë©´ ì—­ì‹œ ê°™ì€ podcast-nginxë¡œ ë³´ë‚´ëŠ” ê²ƒì´ë‹¤.
kind: Ingress
apiVersion: extensions/v1beta1
metadata:
  name: "test"
  namespace: default

spec:
  rules:
    - host: mini1
      http:
        paths:
          - path: /ost
            backend:
              serviceName: podcast-nginx
              servicePort: 8099
    - http:
        paths:
          - path: /ost
            backend:
              serviceName: podcast-nginx
              servicePort: 8099
Kubectl ëª…ë ¹ì„ ì´ìš©í•´ ì ìš©í•´ ë³¸ë‹¤.'><meta name=keywords content="Traefik,"><meta property="og:url" content="https://cychong47.github.io/post/2021/2021-03-31-setup-ingress-with-traefik/"><meta property="og:site_name" content="Keep calm and Write something"><meta property="og:title" content="Setup Ingress with Traefik"><meta property="og:description" content='Ingress Controller ë¥¼ ì„¤ì¹˜(Helmìœ¼ë¡œ Traefik ì„¤ì¹˜í•˜ê¸°)í–ˆìœ¼ë‹ˆ ì´ì œ Ingressë¥¼ ì„¤ì •í•´ì„œ ì‹¤ì œ cluster ì™¸ë¶€ë¡œë¶€í„°ì˜ http/https ë©”ì‹œì§€ë¥¼ nginx podì— ì „ë‹¬ë˜ê²Œ í•´ ë³¸ë‹¤.
Ingress IngressëŠ” Cluster ì™¸ë¶€ì—ì„œ ì ‘ê·¼í•˜ëŠ” http/https requestì— ëŒ€í•œ ë¼ìš°íŒ…ì„ ì œì–´í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤. Ingress | Kubernetes
ingress.yaml íŒŒì¼ì„ ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•œë‹¤. . ì•„ë˜ëŠ” ë‘ ê°€ì§€ ruleì„ ì„¤ì •í•˜ê³  ìˆëŠ”ë° hostê°€ â€˜mini1â€™ì´ê³ , URL pathê°€ /ostë©´ podcast-nginxë¼ëŠ” ì„œë¹„ìŠ¤ë¡œ ì „ë‹¬í•˜ê²Œ í•˜ëŠ” ê²ƒê³¼ hostëŠ” ìƒê´€ì—†ì´ pathê°€ /ostë©´ ì—­ì‹œ ê°™ì€ podcast-nginxë¡œ ë³´ë‚´ëŠ” ê²ƒì´ë‹¤.
kind: Ingress apiVersion: extensions/v1beta1 metadata: name: "test" namespace: default spec: rules: - host: mini1 http: paths: - path: /ost backend: serviceName: podcast-nginx servicePort: 8099 - http: paths: - path: /ost backend: serviceName: podcast-nginx servicePort: 8099 Kubectl ëª…ë ¹ì„ ì´ìš©í•´ ì ìš©í•´ ë³¸ë‹¤.'><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2021-03-31T23:00:00+09:00"><meta property="article:modified_time" content="2021-03-31T23:00:00+09:00"><meta property="article:tag" content="Traefik"><meta property="og:see_also" content="https://cychong47.github.io/post/2021/2021-05-08-access-control-with-traefik-middleware/"><meta property="og:see_also" content="https://cychong47.github.io/post/2021/2021-03-31-change-nodeport-to-clusterip/"><meta property="og:see_also" content="https://cychong47.github.io/post/2021/2021-03-30-install-traefik-with-helm/"><meta name=twitter:card content="summary"><meta name=twitter:title content="Setup Ingress with Traefik"><meta name=twitter:description content='Ingress Controller ë¥¼ ì„¤ì¹˜(Helmìœ¼ë¡œ Traefik ì„¤ì¹˜í•˜ê¸°)í–ˆìœ¼ë‹ˆ ì´ì œ Ingressë¥¼ ì„¤ì •í•´ì„œ ì‹¤ì œ cluster ì™¸ë¶€ë¡œë¶€í„°ì˜ http/https ë©”ì‹œì§€ë¥¼ nginx podì— ì „ë‹¬ë˜ê²Œ í•´ ë³¸ë‹¤.
Ingress IngressëŠ” Cluster ì™¸ë¶€ì—ì„œ ì ‘ê·¼í•˜ëŠ” http/https requestì— ëŒ€í•œ ë¼ìš°íŒ…ì„ ì œì–´í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤. Ingress | Kubernetes
ingress.yaml íŒŒì¼ì„ ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•œë‹¤. . ì•„ë˜ëŠ” ë‘ ê°€ì§€ ruleì„ ì„¤ì •í•˜ê³  ìˆëŠ”ë° hostê°€ â€˜mini1â€™ì´ê³ , URL pathê°€ /ostë©´ podcast-nginxë¼ëŠ” ì„œë¹„ìŠ¤ë¡œ ì „ë‹¬í•˜ê²Œ í•˜ëŠ” ê²ƒê³¼ hostëŠ” ìƒê´€ì—†ì´ pathê°€ /ostë©´ ì—­ì‹œ ê°™ì€ podcast-nginxë¡œ ë³´ë‚´ëŠ” ê²ƒì´ë‹¤.
kind: Ingress apiVersion: extensions/v1beta1 metadata: name: "test" namespace: default spec: rules: - host: mini1 http: paths: - path: /ost backend: serviceName: podcast-nginx servicePort: 8099 - http: paths: - path: /ost backend: serviceName: podcast-nginx servicePort: 8099 Kubectl ëª…ë ¹ì„ ì´ìš©í•´ ì ìš©í•´ ë³¸ë‹¤.'><meta itemprop=name content="Setup Ingress with Traefik"><meta itemprop=description content='Ingress Controller ë¥¼ ì„¤ì¹˜(Helmìœ¼ë¡œ Traefik ì„¤ì¹˜í•˜ê¸°)í–ˆìœ¼ë‹ˆ ì´ì œ Ingressë¥¼ ì„¤ì •í•´ì„œ ì‹¤ì œ cluster ì™¸ë¶€ë¡œë¶€í„°ì˜ http/https ë©”ì‹œì§€ë¥¼ nginx podì— ì „ë‹¬ë˜ê²Œ í•´ ë³¸ë‹¤.
Ingress IngressëŠ” Cluster ì™¸ë¶€ì—ì„œ ì ‘ê·¼í•˜ëŠ” http/https requestì— ëŒ€í•œ ë¼ìš°íŒ…ì„ ì œì–´í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤. Ingress | Kubernetes
ingress.yaml íŒŒì¼ì„ ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•œë‹¤. . ì•„ë˜ëŠ” ë‘ ê°€ì§€ ruleì„ ì„¤ì •í•˜ê³  ìˆëŠ”ë° hostê°€ â€˜mini1â€™ì´ê³ , URL pathê°€ /ostë©´ podcast-nginxë¼ëŠ” ì„œë¹„ìŠ¤ë¡œ ì „ë‹¬í•˜ê²Œ í•˜ëŠ” ê²ƒê³¼ hostëŠ” ìƒê´€ì—†ì´ pathê°€ /ostë©´ ì—­ì‹œ ê°™ì€ podcast-nginxë¡œ ë³´ë‚´ëŠ” ê²ƒì´ë‹¤.
kind: Ingress apiVersion: extensions/v1beta1 metadata: name: "test" namespace: default spec: rules: - host: mini1 http: paths: - path: /ost backend: serviceName: podcast-nginx servicePort: 8099 - http: paths: - path: /ost backend: serviceName: podcast-nginx servicePort: 8099 Kubectl ëª…ë ¹ì„ ì´ìš©í•´ ì ìš©í•´ ë³¸ë‹¤.'><meta itemprop=datePublished content="2021-03-31T23:00:00+09:00"><meta itemprop=dateModified content="2021-03-31T23:00:00+09:00"><meta itemprop=wordCount content="1175"><meta itemprop=keywords content="Traefik"><meta name=referrer content="no-referrer-when-downgrade"><style>:root{--width:720px;--font-main:Verdana, sans-serif;--font-secondary:Verdana, sans-serif;--font-scale:1em;--background-color:#fafafa;--heading-color:#222;--text-color:#444;--link-color:#3273dc;--visited-color:#8b6fcb;--blockquote-color:#222}@media(prefers-color-scheme:dark){:root{--background-color:#fafafa;--heading-color:#222;--text-color:#444;--link-color:#3273dc;--visited-color:#8b6fcb;--blockquote-color:#222}}body{font-family:var(--font-secondary);font-size:var(--font-scale);margin:auto;padding:20px;max-width:var(--width);text-align:left;background-color:var(--background-color);word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:var(--text-color)}h1,h2,h3,h4,h5,h6{font-family:var(--font-main);color:var(--heading-color)}a{color:var(--link-color);cursor:pointer;text-decoration:none}a:hover{text-decoration:underline}nav a{margin-right:8px}strong,b{color:var(--heading-color)}button{margin:0;cursor:pointer}time{font-family:monospace;font-style:normal;font-size:15px}main{line-height:1.6}table{width:100%}hr{border:0;border-top:1px dashed}img{max-width:100%}code{font-family:monospace;padding:2px;border-radius:3px}blockquote{border-left:1px solid #999;color:var(--blockquote-color);padding-left:20px;font-style:italic}footer{padding:25px 0;text-align:center}.title:hover{text-decoration:none}.title h1{font-size:1.5em}.inline{width:auto!important}.highlight,.code{border-radius:3px;margin-block-start:1em;margin-block-end:1em;overflow-x:auto}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:var(--visited-color)}</style></head><body><header><a href=/ class=title><h2>Keep calm and Write something</h2></a><nav><a href=/post/>Post</a>
<a href=/page/>Page</a>
<a href=/series/>Series</a>
<a href=/tags/>Tag</a>
<a href=/archive/>Archive</a>
<a href=/search/>Search</a></nav></header><main><content><p>Ingress Controller ë¥¼ ì„¤ì¹˜(<a href=https://cychong47.github.io/post/2021/2021-03-30-install-traefik-with-helm/>Helmìœ¼ë¡œ Traefik ì„¤ì¹˜í•˜ê¸°</a>)í–ˆìœ¼ë‹ˆ ì´ì œ Ingressë¥¼ ì„¤ì •í•´ì„œ ì‹¤ì œ cluster ì™¸ë¶€ë¡œë¶€í„°ì˜ http/https ë©”ì‹œì§€ë¥¼ nginx podì— ì „ë‹¬ë˜ê²Œ í•´ ë³¸ë‹¤.</p><h1 id=ingress>Ingress</h1><p>IngressëŠ” Cluster ì™¸ë¶€ì—ì„œ ì ‘ê·¼í•˜ëŠ” http/https requestì— ëŒ€í•œ ë¼ìš°íŒ…ì„ ì œì–´í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.
<a href=https://kubernetes.io/docs/concepts/services-networking/ingress/>Ingress | Kubernetes</a></p><p>ingress.yaml íŒŒì¼ì„ ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•œë‹¤. . ì•„ë˜ëŠ” ë‘ ê°€ì§€ ruleì„ ì„¤ì •í•˜ê³  ìˆëŠ”ë° hostê°€ â€˜mini1â€™ì´ê³ , URL pathê°€ <code>/ost</code>ë©´ podcast-nginxë¼ëŠ” ì„œë¹„ìŠ¤ë¡œ ì „ë‹¬í•˜ê²Œ í•˜ëŠ” ê²ƒê³¼ hostëŠ” ìƒê´€ì—†ì´ pathê°€ <code>/ost</code>ë©´ ì—­ì‹œ ê°™ì€ podcast-nginxë¡œ ë³´ë‚´ëŠ” ê²ƒì´ë‹¤.</p><pre tabindex=0><code>kind: Ingress
apiVersion: extensions/v1beta1
metadata:
  name: &#34;test&#34;
  namespace: default

spec:
  rules:
    - host: mini1
      http:
        paths:
          - path: /ost
            backend:
              serviceName: podcast-nginx
              servicePort: 8099
    - http:
        paths:
          - path: /ost
            backend:
              serviceName: podcast-nginx
              servicePort: 8099
</code></pre><p>Kubectl ëª…ë ¹ì„ ì´ìš©í•´ ì ìš©í•´ ë³¸ë‹¤.</p><pre tabindex=0><code>$ kubectl apply -f ingress.yaml
ingress.extensions/test created
</code></pre><p>í™•ì¸ì€ ì—¬ëŠ resourceì™€ ë§ˆì°¬ê°€ì§€ë¡œ <code>get</code> ëª…ë ¹ì–´ ì‚¬ìš©</p><pre tabindex=0><code>$ kubectl get ingress
NAME   CLASS    HOSTS   ADDRESS   PORTS   AGE
test   &lt;none&gt;   mini1             80      8s
</code></pre><p>ìƒì„¸ ë‚´ìš©ì„ ë³´ë ¤ë©´ ì—­ì‹œ <code>describe</code> ëª…ë ¹ì„ ì‚¬ìš©í•œë‹¤.</p><pre tabindex=0><code>$ kubectl describe ingress test
Name:             test
Namespace:        default
Address:
Default backend:  default-http-backend:80 (&lt;error: endpoints &#34;default-http-backend&#34; not found&gt;)
Rules:
  Host        Path  Backends
  ----        ----  --------
  mini1
              /ost   podcast-nginx:8099 ()
  *
              /ost     podcast-nginx:8099 ()
Annotations:  Events:  &lt;none&gt;
</code></pre><p>YAML íŒŒì¼ì— ê¸°ìˆ í•œ ëŒ€ë¡œ 2ê°€ì§€ ruleì´ ì„¤ì •ë˜ì—ˆë‹¤.
<code>{mini1, /ost} -> podcast-nginx:8099</code>
<code>{*,/ost} -> podcast-nginx:8099</code></p><h1 id=404-not-found>404 Not Found</h1><p>ì´ì „ì—ëŠ” NodePortì— ì„¤ì •í•œ IP ì£¼ì†Œì™€ NodePort ì¡°í•©ìœ¼ë¡œ <code>http://192.168.0.100:8099</code>ë¡œ ì ‘ê·¼í–ˆëŠ”ë° ì´ë²ˆì—ëŠ” <code>http://192.168.0.100/ost</code>ë¡œ ì ‘ê·¼ì„ ì‹œë„í–ˆë‹¤.
ê·¸ë ‡ì§€ë§Œ ë³„ë¡œ ë§Œë‚˜ê³  ì‹¶ì€ ì•Šì€ 404 ì—ëŸ¬ë§Œ ë©ê·¸ëŸ¬ë‹ˆâ€¦</p><pre tabindex=0><code>404 Not Found

nginx/1.19.0
</code></pre><h1 id=pod-logs>Pod logs</h1><p>ê·¸ë˜ë„ nginx ì—ëŸ¬ê°€ ë‚˜ì™”ë‹¤ëŠ” ê±´ ì ì–´ë„ Traefikì„ ê±°ì³ nginxê°€ ë™ì‘í•˜ê³  ìˆëŠ” podê¹Œì§€ëŠ” requestê°€ ì™”ë‹¤ëŠ” ê±¸ë¡œ ë³´ì¸ë‹¤. ì¦‰ ì´ê±´ Ingress ì„¤ì •ì´ë‚˜ Traefik ë™ì‘ì—ëŠ” ë¬¸ì œê°€ ì—†ë‹¤ëŠ” ê±°.</p><p>ê·¸ë˜ì„œ nginxê°€ ë™ì‘í•˜ê³  ìˆëŠ” Podì˜ ë¡œê·¸ë¥¼ ë³´ê¸°ë¡œ í–ˆë‹¤. <a href=https://github.com/derailed/k9s>GitHub - derailed/k9s: ğŸ¶ Kubernetes CLI To Manage Your Clusters In Style!</a>ë¥¼ ì´ìš©í•´ì„œ attach ëª…ë ¹ì„ ì´ìš©í•˜ë©´ í¸ë¦¬í•˜ê²Œ ë¡œê·¸ë¥¼ ë³¼ ìˆ˜ ìˆë‹¤(ì‹¬ì§€ì–´? kubeconfig íŒŒì¼ì„ ì´ìš©í•´ì„œ ë‹¤ë¥¸ ë¨¸ì‹ ì—ì„œ clusterì— ì›ê²©ìœ¼ë¡œ ì ‘ì†í•  ìˆ˜ ìˆë‹¤ëŠ”. <code>k9s --kubeconfig ~/.kube/config_mini1</code></p><pre tabindex=0><code>Unable to use a TTY - container nginx did not allocate one
If you don&#39;t see a command prompt, try pressing enter.
10.244.51.100 - - [30/Mar/2021:14:11:54 +0000] &#34;GET /ost HTTP/1.1&#34; 404 153 &#34;-&#34; &#34;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.0.3 Safari/605.1.15&#34; &#34;192.168.0.100&#34;
2021/03/30 14:11:54 [error] 28#28: *793087 open() &#34;/usr/share/nginx/html/ost&#34; failed (2: No such file or directory), client: 10.244.51.100, server: localhost, request: &#34;GET /ost HTTP/1.1&#34;, host: &#34;192.168.0.100&#34;
</code></pre><p>í˜¹ì‹œë‚˜ í–ˆëŠ”ë° ì˜ˆìƒëŒ€ë¡œ ìš”ì²­í•˜ëŠ” html íŒŒì¼ì˜ ê²½ë¡œê°€ <code>/usr/share/nginx/html/ost</code> ë‹¤. í•˜ì§€ë§Œ nginxëŠ” ëª¨ë‘ subpath ì—†ì´ <code>/</code> ì— íŒŒì¼ì„ ë‘ê³  ìˆìœ¼ë¯€ë¡œ <code>/</code>ë¥¼ ì°¾ë„ë¡ redirect ì‹œì¼œì•¼ í•˜ëŠ”ë°.</p><p><a href=https://kubernetes.io/docs/concepts/services-networking/ingress/>Ingress | Kubernetes</a> ë¥¼ ë³´ë©´ <code>rewrite-target</code>ì´ë¼ëŠ” annotationì„ ì‚¬ìš©í•˜ëŠ” ë“¯ í•œë°, í•´ë‹¹ annotationì˜ prefixë¥¼ ë³´ë‹ˆ ì•„ë¬´ë˜ë„ <code>nginx</code>ë§Œ ì§€ì›ì´ë˜ëŠ” ê²Œ ì•„ë‹Œê°€ ì‹¶ë‹¤.</p><pre tabindex=0><code>$ kubectl describe ingress test

Name:             test
Namespace:        default
Address:          178.91.123.132
Default backend:  default-http-backend:80 (10.8.2.3:8080)
Rules:
  Host         Path  Backends
  ----         ----  --------
  foo.bar.com
               /foo   service1:80 (10.8.0.90:80)
Annotations:
  nginx.ingress.kubernetes.io/rewrite-target:  /
Events:
  Type     Reason  Age                From                     Message
  ----     ------  ----               ----                     -------
  Normal   ADD     35s                loadbalancer-controller  default/test 
</code></pre><p>ê·¸ë˜ì„œ Traefikì´ path rewritingì„ ì§€ì›í•˜ëŠ” ì§€ ê²€ìƒ‰í•´ ë³´ë‹ˆ ë‹¹ì—°í•˜ê²Œë„ ë™ì¼í•œ ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤ê³ . <a href=https://stackoverflow.com/questions/50504881/rewriting-paths-with-traefik>docker - Rewriting paths with Traefik - Stack Overflow</a></p><p>ìœ„ ê¸€ì— ìˆëŠ” ì˜ˆì œëŠ” <code>http://monitor.app.com/service-one</code> ë¥¼ <code>http://service-one/monitor</code>ë¡œ rewritingí•˜ëŠ” ê²½ìš°ì´ë‹¤.</p><pre tabindex=0><code>apiVersion: v1
kind: Service
metadata:
  name: service-one
spec:
  selector:
    k8s-app: service-one-app
  ports:
  - port: 80
    targetPort: 8080
---
kind: Ingress
metadata:
  name: monitor.app
  annotations:
    kubernetes.io/ingress.class: traefik
    traefik.ingress.kubernetes.io/rewrite-target: /monitor # set path to result request
spec:
  rules:
  - host: monitor.app.com
    http:
      paths:
      - path /service-one  # path for routing, it will be removed because of PathPrefixStrip settings
        backend:
          serviceName: service-one
          servicePort: 80
</code></pre><p>ê·¸ëŸ°ë° ë˜ ì°¾ì•„ ë³´ë‹ˆ ìœ„ì˜ ë‚´ìš©ì€ Traefik v1ì—ë§Œ í•´ë‹¹í•˜ëŠ” ê±°ë¼ê³ . v2ì—ì„œëŠ” <code>PathPrefixStrip</code> ê¸°ëŠ¥ì´ <code>Middleware</code>ì˜ ê¸°ëŠ¥ìœ¼ë¡œ ì˜®ê²¨ì¡Œë‹¤ê³  í•œë‹¤.</p><blockquote><p>In the v2, the <a href=https://docs.traefik.io/v1.7/basics/#modifiers>â€œmodifiersâ€</a> became middleware: <a href=https://docs.traefik.io/v2.0/middlewares/stripprefix/>https://docs.traefik.io/v2.0/middlewares/stripprefix/</a> ><br>Source : <a href=https://github.com/traefik/traefik/issues/5004>https://github.com/traefik/traefik/issues/5004</a></p></blockquote><h1 id=middleware>Middleware</h1><p>`Middlewareë¼ë‹ˆ ì´ê±´ ë˜ ë­”ê°€.
<img src=/images/2021/03/2021-03-31-traefik-middleware-overview.png alt></p><p><a href=https://doc.traefik.io/traefik/v2.0/middlewares/overview/>Overview - Traefik | Site | v2.0</a></p><blockquote><p>Attached to the routers, pieces of middleware are a mean of tweaking the requests before they are sent to your <a href=https://doc.traefik.io/traefik/v2.0/routing/services/>service</a> (or before the answer from the services are sent to the clients)</p></blockquote><p>Route ë™ì‘ ì¤‘ì— ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ì—¬ëŸ¬ê°€ì§€ ì‘ì—…ì„ ì •ì˜í•œ ê²ƒì´ Middlewareë¼ê³  ì´í•´ëœë‹¤. í™•ì¥ì„±ì„ ìœ„í•´ ë‹¨ìˆœíˆ ê²½ë¡œë¥¼ ì°¨ëŠ” Routingê³¼ ê²½ë¡œë¥¼ ì¡°ì‘(?)í•˜ëŠ” ë“±ì˜ ì‘ì—…ì„ ë¶„ë¦¬í•´ì„œ Middlewareë¼ê³  ë¶€ë¥´ëŠ” ê²ƒ ê°™ë‹¤.</p><p>Middlewareë¥¼ ìœ„í•œ CRDê°€ ì •ì˜ë˜ì–´ ìˆëŠ”ë°, Helmìœ¼ë¡œ ì„¤ì¹˜í•˜ë©´ ì´ë¯¸ middlewareê°€ ì„¤ì¹˜ë˜ì–´ ìˆë‹¤</p><pre tabindex=0><code> k get CustomResourceDefinition |grep traefik
ingressroutes.traefik.containo.us             2021-01-25T13:25:26Z
ingressroutetcps.traefik.containo.us          2021-01-25T13:25:26Z
ingressrouteudps.traefik.containo.us          2021-01-25T13:25:26Z
middlewares.traefik.containo.us               2021-01-25T13:25:26Z
serverstransports.traefik.containo.us         2021-01-25T13:25:26Z
tlsoptions.traefik.containo.us                2021-01-25T13:25:26Z
tlsstores.traefik.containo.us                 2021-01-25T13:25:27Z
traefikservices.traefik.containo.us           2021-01-25T13:25:27Z
</code></pre><p>ì´ì œ ì›í•˜ëŠ” ì‘ì—…ì¸ <code>/ost</code>ë¥¼ request pathì—ì„œ ì œê±°í•˜ë ¤ë©´ <code>stripPrefix</code> ê¸°ëŠ¥ì„ ì´ìš©í•˜ë©´ ëœë‹¤.
<a href=https://doc.traefik.io/traefik/v2.0/middlewares/stripprefix/>StripPrefix - Traefik | Site | v2.0</a>
ìœ„ í˜ì´ì§€ì— ìˆëŠ” ì˜ˆì œì¸ë° ì‰½ê²Œ ì˜ˆìƒë˜ëŠ” ê²ƒì²˜ëŸ¼ <code>/foobar</code>, <code>/filibar</code>ë¼ëŠ” ê²½ë¡œê°€ ìˆìœ¼ë©´ ì œê±°í•˜ë¼ëŠ” ì˜ë¯¸ì´ë‹¤.</p><pre tabindex=0><code># Strip prefix /foobar and /fiibar
apiVersion: traefik.containo.us/v1alpha1
kind: Middleware
metadata:
  name: test-stripprefix
spec:
  stripPrefix:
    prefixes:
      - /foobar
      - /fiibar
</code></pre><h1 id=ì ìš©í•´-ë³´ê¸°>ì ìš©í•´ ë³´ê¸°</h1><p>ìœ„ ì˜ˆì œë¥¼ ì°¸ì¡°í•´ì„œ ë‹¤ìŒê³¼ ê°™ì´ Middleware ë¥¼ ì„¤ì •í•œë‹¤.</p><pre tabindex=0><code>$ cat traefik-pathstrip.yaml
apiVersion: traefik.containo.us/v1alpha1
kind: Middleware
metadata:
  name: stripprefix
spec:
  stripPrefix:
    prefixes:
      - /ost
</code></pre><pre tabindex=0><code>$ kubectl apply -f traefik-pathstrip.yaml
middleware.traefik.containo.us/stripprefix created
</code></pre><p>ë‹¤ë§Œ, middlewareë¥¼ route ruleì— ì ìš©í•˜ë ¤ë©´ kubernetesì˜ ê¸°ë³¸ objectì¸ <code>ingress</code>ê°€ ì•„ë‹ˆë¼ <code>ingressRoute</code>ë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ë“¯ í•˜ë‹¤. IngressRouteëŠ” ë˜ ë­”ì§€.</p><h1 id=ingressroute-vs-ingress>IngressRoute vs. Ingress</h1><p><code>Ingress</code> is a standard kubernetes object while <code>IngressRoute</code> is CRD of Traefik</p><blockquote><p>An ingressRoute is specific to Traefik. Itâ€™s not native to Kubernetes. It is a Custom Resource Definition which allows you to take advantage of Traefik features not exposed in the Kubernetes ingress resource</p></blockquote><p>Source : <a href=https://stackoverflow.com/questions/60177488/what-is-the-difference-between-a-kubernetes-ingress-and-a-ingressroute>What is the difference between a Kubernetes Ingress and a IngressRoute? - Stack Overflow</a></p><p>IngressRoute ì˜ˆì œì˜ ë‚´ìš©ì—ì„œ Routing ruleê³¼ Middlewareë¥¼ ë‚´ê°€ í•„ìš”í•œ ëŒ€ë¡œ ìˆ˜ì •í•œë‹¤.</p><pre tabindex=0><code>$ cat ingress-route.yaml
kind: IngressRoute
apiVersion: traefik.containo.us/v1alpha1
metadata:
  name: ingressroutebar
  namespace: default

spec:
  entryPoints:
    - web
  routes:
          #- match: Host(`bar.com`) &amp;&amp; PathPrefix(`/stripit`)
  - match: PathPrefix(`/ost`)
    kind: Rule
    services:
    - name: podcast-nginx
      port: 8099
    middlewares:
    - name: stripprefix
      namespace: default
</code></pre><p>ê·¸ ê²°ê³¼ëŠ”</p><p><img src=/images/2021/03/2021-03-30-traefik-works-but.png alt></p><p>í â€¦</p><p>ì¼ë‹¨ ì›¹ í˜ì´ì§€ ìì²´ëŠ” ì˜ ë³´ì´ë‹ˆ routingì€ ì˜ ëœ ë“¯ í•œë°, ìŠ¤íƒ€ì¼ì´ ì´ìƒí•œ ê±¸ ë³´ë‹ˆ CSS íŒŒì¼ë“¤ì´ ì œëŒ€ë¡œ ì ìš©ë˜ì§€ ì•Šì€ ë“¯ í•˜ë‹¤. ê·¸ë¦¬ê³  ì œì¼ ìœ„ ìª½ì— ì´ë¯¸ì§€ê°€ ë³´ì—¬ì§€ì§€ ì•ŠëŠ” ê±¸ ë³´ë‹ˆ CSS íŒŒì¼ ì™¸ì— ë‹¤ë¥¸ íŒŒì¼ë“¤ì˜ ê²½ë¡œê°€ ì•ˆ ë§ëŠ” ë“¯ í•˜ë‹¤. ìœ„ í˜ì´ì§€ì—ì„œ ë§í¬ë¥¼ í´ë¦­í•˜ë©´ ë§í¬ë„ ì œëŒ€ë¡œ ë™ì‘í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ”. ê²°êµ­ `URL/ost/index.htmlâ€™ë§Œ ì œëŒ€ë¡œ ë¼ìš°íŒ…ì´ ë˜ì„œ í™”ë©´ì— ë³´ì´ê³  ë‚˜ë¨¸ì§€ëŠ” ëª¨ë‘ ì œëŒ€ë¡œ ë™ì‘í•˜ì§€ ì•ŠëŠ” ëª¨ì–‘ì´ã…ã„·.</p><p>ì´ë¯¸ì§€ íŒŒì¼ì˜ ê²½ë¡œë“¤ì„ ì´ì „ì— ì˜ ë™ì‘í•  ë•Œì™€ ì§€ê¸ˆ ìƒí™©ì„ ë¹„êµí•˜ë‹ˆ ì´ë ‡ë‹¤.</p><pre tabindex=0><code># ì´ì „
http://192.168.0.100:8099/
http://192.168.0.100:8099/images/logo.png
http://192.168.0.100:8099/podcast/cinema-2021-03-30/

# ì§€ê¸ˆ
http://192.168.0.100/
http://192.168.0.100/images/logo.png
http://192.168.0.100/podcast/cinema-2021-03-30/
</code></pre><p>ì¦‰ 8099 í¬íŠ¸ ì§€ì •í•˜ëŠ” ë¶€ë¶„ë§Œ ë‹¬ë¼ì§„ í˜•íƒœë‹¤.</p><p>ê·¸ëŸ°ë° ìƒê°í•´ ë³´ë‹ˆ ìœ„ ë‘ ë²ˆì§¸ ê²½ë¡œë“¤ì€ ë‹¤ìŒê³¼ ê°™ì•„ì•¼ í•  ê²ƒ ê°™ë‹¤.
ê²½ë¡œì— <code>/ost</code>ê°€ ìˆì–´ì•¼ nginx podë¡œ ì „ë‹¬ì´ ë  í…ë° ê·¸ê²Œ ì—†ì–´ì„œ nginx podë¡œ ì „ë‹¬ì´ ë˜ì§€ ì•Šì•„ì„œ web browserì— í‘œì‹œê°€ ì•ˆëœ ê²ƒì´ë‹¤.</p><pre tabindex=0><code>http://192.168.0.100/ost
http://192.168.0.100/ost/images/logo.png
http://192.168.0.100/ost/podcast/cinema-2021-03-30/
</code></pre><p>ì•„ë¬´ë˜ë„ ì´ê±´ nginxì—ì„œ ì„¤ì •ì„ ë³€ê²½í•´ì•¼ í•˜ëŠ” ê²ƒ ê°™ì€ë°â€¦</p><pre tabindex=0><code>$ wget http://192.168.0.100/ost/index.html
--2021-03-30 23:50:44--  http://192.168.0.100/ost/index.html
Connecting to 192.168.0.100:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 34351 (34K) [text/html]
Saving to: â€˜index.htmlâ€™

index.html                                    100%[================================================================================================&gt;]  33.55K  --.-KB/s    in 0s

2021-03-30 23:50:44 (155 MB/s) - â€˜index.htmlâ€™ saved [34351/34351]

$ wget http://192.168.0.100:8099/index.html
--2021-03-30 23:50:53--  http://192.168.0.100:8099/index.html
Connecting to 192.168.0.100:8099... connected.
HTTP request sent, awaiting response... 200 OK
Length: 34351 (34K) [text/html]
Saving to: â€˜index.html.1â€™

index.html.1                                  100%[================================================================================================&gt;]  33.55K  --.-KB/s    in 0s

2021-03-30 23:50:53 (179 MB/s) - â€˜index.html.1â€™ saved [34351/34351]

$ diff index.html index.html.1
$ 
</code></pre><h1 id=í•´ê²°>í•´ê²°</h1><p>ì˜ˆìƒëŒ€ë¡œ í•´ê²°ì±…ì€ nginx ì˜ ì„¤ì •ì„ ë³€ê²½í•˜ëŠ” ê°„ë‹¨í•œ ìˆ˜ì •ìœ¼ë¡œ ì¶©ë¶„í–ˆë‹¤.
nginxê°€ hostingí•˜ëŠ” ì‚¬ì´íŠ¸ëŠ” SSG(Static Site Generator)ì¸ hugoë¥¼ ì´ìš©í•´ì„œ ìƒì„±í•œ íŒŒì¼ë“¤ë¡œ êµ¬ì„±ë˜ëŠ”ë°, ê·¸ siteì˜ rootì— <code>/ost</code>ë¥¼ ì¶”ê°€í•˜ëŠ” ê²ƒì´ë‹¤. ì¦‰ hugo ì„¤ì • íŒŒì¼ì—ì„œ baseURLì— <code>/ost</code>ë¥¼ ì¶”ê°€í•˜ëŠ” ê±°</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>$ cat config.yaml</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span><span style=color:#f92672>baseURL</span>: <span style=color:#e6db74>&#34;http://sosa0sa.com/ost/&#34;</span>     <span style=color:#ae81ff>&lt;&lt; ì´ì „ ê°’ &#34;http://sosa0sa.com:8099&#34; </span>
</span></span></code></pre></div><p>ìƒˆë¡œ site íŒŒì¼ì„ ë¹Œë“œí•´ì„œ nginxì— ë°€ì–´ë„£ì—ˆë”ë‹ˆ ë‹¤ìŒê³¼ ê°™ì´ ì œëŒ€ë¡œ ê²½ë¡œê°€ ë°”ë€Œì—ˆë‹¤.</p><pre tabindex=0><code>http://192.168.0.100/ost
http://192.168.0.100/ost/images/logo.png
http://192.168.0.100/ost/podcast/cinema-2021-03-30/
</code></pre><p>ì§œì”. ì´ì   ì˜ ë™ì‘í•œë‹¤.
<img src=/images/2021/03/2021-03-31-traefik-works-1.png alt></p><p>ë‹¹ì—°íˆ ì§‘ ë‚´ê°€ ì•„ë‹ˆë¼ ì™¸ë¶€ì—ì„œë„ ì ‘ì†ì´ ì˜ ë˜ê³ .
<img src=/images/2021/03/2021-03-31-traefik-works-2.png alt></p></content><p><a href=https://cychong47.github.io/tags/traefik/>#Traefik</a></p></main><footer>Made with <a href=https://github.com/janraasch/hugo-bearblog/>Hugo Ê•â€¢á´¥â€¢Ê” Bear</a></footer></body></html>