<!doctype html><html lang=en-us><head><meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Elastic stack and Metricbeat | Keep calm and Write something</title><meta name=title content="Elastic stack and Metricbeat"><meta name=description content="Install Elastic Stack(ELK stack) with docker
mbpr15:elk-wireshark cychong$ git clonehttps://github.com/deviantony/docker-elk.git
git: 'clonehttps://github.com/deviantony/docker-elk.git' is not a git command. See 'git --help'.
mbpr15:elk-wireshark cychong$ git clone https://github.com/deviantony/docker-elk.git
Cloning into 'docker-elk'...
remote: Counting objects: 1235, done.
remote: Total 1235 (delta 0), reused 0 (delta 0), pack-reused 1235
Receiving objects: 100% (1235/1235), 259.29 KiB | 77.00 KiB/s, done.
Resolving deltas: 100% (470/470), done.
mbpr15:elk-wireshark cychong$ cd elk
mbpr15:elk-wireshark cychong$ cd docker-elk/
mbpr15:docker-elk cychong$ ls
LICENSE			elasticsearch		logstash
README.md		extensions
docker-compose.yml	kibana
Install ELK with docker-compose
mbpr15:docker-elk cychong$ docker-compose up -d
Creating network &#34;docker-elk_elk&#34; with driver &#34;bridge&#34;
Building elasticsearch
Step 1/1 : FROM docker.elastic.co/elasticsearch/elasticsearch-oss:6.2.4
6.2.4: Pulling from elasticsearch/elasticsearch-oss
469cfcc7a4b3: Pull complete
8e27facfa9e0: Pull complete
cdd15392adc7: Pull complete
19ff08a29664: Pull complete
ddc4fd93fdcc: Pull complete
b723bede0878: Pull complete
Digest: sha256:2d9c774c536bd1f64abc4993ebc96a2344404d780cbeb81a8b3b4c3807550e57
Status: Downloaded newer image for docker.elastic.co/elasticsearch/elasticsearch-oss:6.2.4
 ---> 3822ba554fe9
Successfully built 3822ba554fe9
Successfully tagged docker-elk_elasticsearch:latest
WARNING: Image for service elasticsearch was built because it did not already exist. To rebuild this image you must use `docker-compose build` or `docker-compose up --build`.
Building logstash
Step 1/1 : FROM docker.elastic.co/logstash/logstash-oss:6.2.4
6.2.4: Pulling from logstash/logstash-oss
469cfcc7a4b3: Already exists
b4cfa2eb1616: Pull complete
ec994fa6fa7f: Pull complete
ccf455902ac6: Pull complete
6d54f3767ae5: Pull complete
af0dd1a720da: Pull complete
457dbabd3f63: Pull complete
f2c481bd6da1: Pull complete
d04342e2b9a1: Pull complete
e8bca7e9b0d9: Pull complete
d0096563f301: Pull complete
Digest: sha256:28668a65f6b6a4f1e2abef7aa3fd3b9c8476a16aa5bebc1a9acf0f7de5b80eef
Status: Downloaded newer image for docker.elastic.co/logstash/logstash-oss:6.2.4
 ---> 0bade66b6bee
Successfully built 0bade66b6bee
Successfully tagged docker-elk_logstash:latest
WARNING: Image for service logstash was built because it did not already exist. To rebuild this image you must use `docker-compose build` or `docker-compose up --build`.
Building kibana
Step 1/1 : FROM docker.elastic.co/kibana/kibana-oss:6.2.4
6.2.4: Pulling from kibana/kibana-oss
469cfcc7a4b3: Already exists
78e4c5fdc069: Pull complete
d9ecdaefa1b8: Pull complete
c8e48c8f74d7: Pull complete
1606c56cdbff: Pull complete
4e23ce1503d4: Pull complete
d36b703b3f90: Pull complete
da5da7625f92: Pull complete
Digest: sha256:1d1f9bac326bf276010df82a2b4593619f48a5207619e8817c8b20d5a1bb3547
Status: Downloaded newer image for docker.elastic.co/kibana/kibana-oss:6.2.4
 ---> 32510971af4e
Successfully built 32510971af4e
Successfully tagged docker-elk_kibana:latest
WARNING: Image for service kibana was built because it did not already exist. To rebuild this image you must use `docker-compose build` or `docker-compose up --build`.
Creating docker-elk_elasticsearch_1 ... done
Creating docker-elk_kibana_1        ... done
Creating docker-elk_logstash_1      ... done
mbpr15:docker-elk cychong$ docker ps
CONTAINER ID        IMAGE                      COMMAND                  CREATED             STATUS              PORTS                                            NAMES
4fc052e81fae        docker-elk_logstash        “/usr/local/bin/dock…”   9 minutes ago       Up 9 minutes        5044/tcp, 0.0.0.0:5000->5000/tcp, 9600/tcp       docker-elk_logstash_1
46f049297c7b        docker-elk_kibana          “/bin/bash /usr/loca…”   9 minutes ago       Up 9 minutes        0.0.0.0:5601->5601/tcp                           docker-elk_kibana_1
8ff911ebab03        docker-elk_elasticsearch   “/usr/local/bin/dock…”   9 minutes ago       Up 9 minutes        0.0.0.0:9200->9200/tcp, 0.0.0.0:9300->9300/tcp   docker-elk_elasticsearch_1
mbpr15:docker-elk cychong$ curl http://localhost:9200
{
  “name” : “npNAiWg”,
  “cluster_name” : “docker-cluster”,
  “cluster_uuid” : “7nY4KVvNS4epY4Z80NCUZw”,
  “version” : {
    “number” : “6.2.4”,
    “build_hash” : “ccec39f”,
    “build_date” : “2018-04-12T20:37:28.497551Z”,
    “build_snapshot” : false,
    “lucene_version” : “7.2.1”,
    “minimum_wire_compatibility_version” : “5.6.0”,
    “minimum_index_compatibility_version” : “5.0.0”
  },
  “tagline” : “You Know, for Search”
}
Open http://localhost:5601 with browser
install metricbeats with docker - check the latest version from elastic.co
docker pull docker.elastic.co/beats/metricbeat:6.2.4
metricbeat 는 시스템 통계 정보를 수집해서 elasticsearch로 보내는 역할을 함.
다양한 모듈들이 modules.d 디렉토리 아래 위치하고, metricbeats.yml은 수집한 정보를 보낼 위치를 변경하는 정도면 기본적인 동작을 확인할 수 있음."><meta name=keywords content="docker,container,elk,elasticsearch,metricbeat,monitoring,"><meta property="og:url" content="https://cychong47.github.io/post/2018/install_elasticstack_and_metricbeat/"><meta property="og:site_name" content="Keep calm and Write something"><meta property="og:title" content="Elastic stack and Metricbeat"><meta property="og:description" content="Install Elastic Stack(ELK stack) with docker mbpr15:elk-wireshark cychong$ git clonehttps://github.com/deviantony/docker-elk.git git: 'clonehttps://github.com/deviantony/docker-elk.git' is not a git command. See 'git --help'. mbpr15:elk-wireshark cychong$ git clone https://github.com/deviantony/docker-elk.git Cloning into 'docker-elk'... remote: Counting objects: 1235, done. remote: Total 1235 (delta 0), reused 0 (delta 0), pack-reused 1235 Receiving objects: 100% (1235/1235), 259.29 KiB | 77.00 KiB/s, done. Resolving deltas: 100% (470/470), done. mbpr15:elk-wireshark cychong$ cd elk mbpr15:elk-wireshark cychong$ cd docker-elk/ mbpr15:docker-elk cychong$ ls LICENSE	elasticsearch	logstash README.md	extensions docker-compose.yml	kibana Install ELK with docker-compose mbpr15:docker-elk cychong$ docker-compose up -d Creating network &#34;docker-elk_elk&#34; with driver &#34;bridge&#34; Building elasticsearch Step 1/1 : FROM docker.elastic.co/elasticsearch/elasticsearch-oss:6.2.4 6.2.4: Pulling from elasticsearch/elasticsearch-oss 469cfcc7a4b3: Pull complete 8e27facfa9e0: Pull complete cdd15392adc7: Pull complete 19ff08a29664: Pull complete ddc4fd93fdcc: Pull complete b723bede0878: Pull complete Digest: sha256:2d9c774c536bd1f64abc4993ebc96a2344404d780cbeb81a8b3b4c3807550e57 Status: Downloaded newer image for docker.elastic.co/elasticsearch/elasticsearch-oss:6.2.4 ---> 3822ba554fe9 Successfully built 3822ba554fe9 Successfully tagged docker-elk_elasticsearch:latest WARNING: Image for service elasticsearch was built because it did not already exist. To rebuild this image you must use `docker-compose build` or `docker-compose up --build`. Building logstash Step 1/1 : FROM docker.elastic.co/logstash/logstash-oss:6.2.4 6.2.4: Pulling from logstash/logstash-oss 469cfcc7a4b3: Already exists b4cfa2eb1616: Pull complete ec994fa6fa7f: Pull complete ccf455902ac6: Pull complete 6d54f3767ae5: Pull complete af0dd1a720da: Pull complete 457dbabd3f63: Pull complete f2c481bd6da1: Pull complete d04342e2b9a1: Pull complete e8bca7e9b0d9: Pull complete d0096563f301: Pull complete Digest: sha256:28668a65f6b6a4f1e2abef7aa3fd3b9c8476a16aa5bebc1a9acf0f7de5b80eef Status: Downloaded newer image for docker.elastic.co/logstash/logstash-oss:6.2.4 ---> 0bade66b6bee Successfully built 0bade66b6bee Successfully tagged docker-elk_logstash:latest WARNING: Image for service logstash was built because it did not already exist. To rebuild this image you must use `docker-compose build` or `docker-compose up --build`. Building kibana Step 1/1 : FROM docker.elastic.co/kibana/kibana-oss:6.2.4 6.2.4: Pulling from kibana/kibana-oss 469cfcc7a4b3: Already exists 78e4c5fdc069: Pull complete d9ecdaefa1b8: Pull complete c8e48c8f74d7: Pull complete 1606c56cdbff: Pull complete 4e23ce1503d4: Pull complete d36b703b3f90: Pull complete da5da7625f92: Pull complete Digest: sha256:1d1f9bac326bf276010df82a2b4593619f48a5207619e8817c8b20d5a1bb3547 Status: Downloaded newer image for docker.elastic.co/kibana/kibana-oss:6.2.4 ---> 32510971af4e Successfully built 32510971af4e Successfully tagged docker-elk_kibana:latest WARNING: Image for service kibana was built because it did not already exist. To rebuild this image you must use `docker-compose build` or `docker-compose up --build`. Creating docker-elk_elasticsearch_1 ... done Creating docker-elk_kibana_1 ... done Creating docker-elk_logstash_1 ... done mbpr15:docker-elk cychong$ docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 4fc052e81fae docker-elk_logstash “/usr/local/bin/dock…” 9 minutes ago Up 9 minutes 5044/tcp, 0.0.0.0:5000->5000/tcp, 9600/tcp docker-elk_logstash_1 46f049297c7b docker-elk_kibana “/bin/bash /usr/loca…” 9 minutes ago Up 9 minutes 0.0.0.0:5601->5601/tcp docker-elk_kibana_1 8ff911ebab03 docker-elk_elasticsearch “/usr/local/bin/dock…” 9 minutes ago Up 9 minutes 0.0.0.0:9200->9200/tcp, 0.0.0.0:9300->9300/tcp docker-elk_elasticsearch_1 mbpr15:docker-elk cychong$ curl http://localhost:9200 { “name” : “npNAiWg”, “cluster_name” : “docker-cluster”, “cluster_uuid” : “7nY4KVvNS4epY4Z80NCUZw”, “version” : { “number” : “6.2.4”, “build_hash” : “ccec39f”, “build_date” : “2018-04-12T20:37:28.497551Z”, “build_snapshot” : false, “lucene_version” : “7.2.1”, “minimum_wire_compatibility_version” : “5.6.0”, “minimum_index_compatibility_version” : “5.0.0” }, “tagline” : “You Know, for Search” } Open http://localhost:5601 with browser install metricbeats with docker - check the latest version from elastic.co docker pull docker.elastic.co/beats/metricbeat:6.2.4 metricbeat 는 시스템 통계 정보를 수집해서 elasticsearch로 보내는 역할을 함. 다양한 모듈들이 modules.d 디렉토리 아래 위치하고, metricbeats.yml은 수집한 정보를 보낼 위치를 변경하는 정도면 기본적인 동작을 확인할 수 있음."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2018-05-31T21:58:51+09:00"><meta property="article:modified_time" content="2018-06-07T13:43:49+00:00"><meta property="article:tag" content="Docker"><meta property="article:tag" content="Container"><meta property="article:tag" content="Elk"><meta property="article:tag" content="Elasticsearch"><meta property="article:tag" content="Metricbeat"><meta property="article:tag" content="Monitoring"><meta name=twitter:card content="summary"><meta name=twitter:title content="Elastic stack and Metricbeat"><meta name=twitter:description content="Install Elastic Stack(ELK stack) with docker mbpr15:elk-wireshark cychong$ git clonehttps://github.com/deviantony/docker-elk.git git: 'clonehttps://github.com/deviantony/docker-elk.git' is not a git command. See 'git --help'. mbpr15:elk-wireshark cychong$ git clone https://github.com/deviantony/docker-elk.git Cloning into 'docker-elk'... remote: Counting objects: 1235, done. remote: Total 1235 (delta 0), reused 0 (delta 0), pack-reused 1235 Receiving objects: 100% (1235/1235), 259.29 KiB | 77.00 KiB/s, done. Resolving deltas: 100% (470/470), done. mbpr15:elk-wireshark cychong$ cd elk mbpr15:elk-wireshark cychong$ cd docker-elk/ mbpr15:docker-elk cychong$ ls LICENSE	elasticsearch	logstash README.md	extensions docker-compose.yml	kibana Install ELK with docker-compose mbpr15:docker-elk cychong$ docker-compose up -d Creating network &#34;docker-elk_elk&#34; with driver &#34;bridge&#34; Building elasticsearch Step 1/1 : FROM docker.elastic.co/elasticsearch/elasticsearch-oss:6.2.4 6.2.4: Pulling from elasticsearch/elasticsearch-oss 469cfcc7a4b3: Pull complete 8e27facfa9e0: Pull complete cdd15392adc7: Pull complete 19ff08a29664: Pull complete ddc4fd93fdcc: Pull complete b723bede0878: Pull complete Digest: sha256:2d9c774c536bd1f64abc4993ebc96a2344404d780cbeb81a8b3b4c3807550e57 Status: Downloaded newer image for docker.elastic.co/elasticsearch/elasticsearch-oss:6.2.4 ---> 3822ba554fe9 Successfully built 3822ba554fe9 Successfully tagged docker-elk_elasticsearch:latest WARNING: Image for service elasticsearch was built because it did not already exist. To rebuild this image you must use `docker-compose build` or `docker-compose up --build`. Building logstash Step 1/1 : FROM docker.elastic.co/logstash/logstash-oss:6.2.4 6.2.4: Pulling from logstash/logstash-oss 469cfcc7a4b3: Already exists b4cfa2eb1616: Pull complete ec994fa6fa7f: Pull complete ccf455902ac6: Pull complete 6d54f3767ae5: Pull complete af0dd1a720da: Pull complete 457dbabd3f63: Pull complete f2c481bd6da1: Pull complete d04342e2b9a1: Pull complete e8bca7e9b0d9: Pull complete d0096563f301: Pull complete Digest: sha256:28668a65f6b6a4f1e2abef7aa3fd3b9c8476a16aa5bebc1a9acf0f7de5b80eef Status: Downloaded newer image for docker.elastic.co/logstash/logstash-oss:6.2.4 ---> 0bade66b6bee Successfully built 0bade66b6bee Successfully tagged docker-elk_logstash:latest WARNING: Image for service logstash was built because it did not already exist. To rebuild this image you must use `docker-compose build` or `docker-compose up --build`. Building kibana Step 1/1 : FROM docker.elastic.co/kibana/kibana-oss:6.2.4 6.2.4: Pulling from kibana/kibana-oss 469cfcc7a4b3: Already exists 78e4c5fdc069: Pull complete d9ecdaefa1b8: Pull complete c8e48c8f74d7: Pull complete 1606c56cdbff: Pull complete 4e23ce1503d4: Pull complete d36b703b3f90: Pull complete da5da7625f92: Pull complete Digest: sha256:1d1f9bac326bf276010df82a2b4593619f48a5207619e8817c8b20d5a1bb3547 Status: Downloaded newer image for docker.elastic.co/kibana/kibana-oss:6.2.4 ---> 32510971af4e Successfully built 32510971af4e Successfully tagged docker-elk_kibana:latest WARNING: Image for service kibana was built because it did not already exist. To rebuild this image you must use `docker-compose build` or `docker-compose up --build`. Creating docker-elk_elasticsearch_1 ... done Creating docker-elk_kibana_1 ... done Creating docker-elk_logstash_1 ... done mbpr15:docker-elk cychong$ docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 4fc052e81fae docker-elk_logstash “/usr/local/bin/dock…” 9 minutes ago Up 9 minutes 5044/tcp, 0.0.0.0:5000->5000/tcp, 9600/tcp docker-elk_logstash_1 46f049297c7b docker-elk_kibana “/bin/bash /usr/loca…” 9 minutes ago Up 9 minutes 0.0.0.0:5601->5601/tcp docker-elk_kibana_1 8ff911ebab03 docker-elk_elasticsearch “/usr/local/bin/dock…” 9 minutes ago Up 9 minutes 0.0.0.0:9200->9200/tcp, 0.0.0.0:9300->9300/tcp docker-elk_elasticsearch_1 mbpr15:docker-elk cychong$ curl http://localhost:9200 { “name” : “npNAiWg”, “cluster_name” : “docker-cluster”, “cluster_uuid” : “7nY4KVvNS4epY4Z80NCUZw”, “version” : { “number” : “6.2.4”, “build_hash” : “ccec39f”, “build_date” : “2018-04-12T20:37:28.497551Z”, “build_snapshot” : false, “lucene_version” : “7.2.1”, “minimum_wire_compatibility_version” : “5.6.0”, “minimum_index_compatibility_version” : “5.0.0” }, “tagline” : “You Know, for Search” } Open http://localhost:5601 with browser install metricbeats with docker - check the latest version from elastic.co docker pull docker.elastic.co/beats/metricbeat:6.2.4 metricbeat 는 시스템 통계 정보를 수집해서 elasticsearch로 보내는 역할을 함. 다양한 모듈들이 modules.d 디렉토리 아래 위치하고, metricbeats.yml은 수집한 정보를 보낼 위치를 변경하는 정도면 기본적인 동작을 확인할 수 있음."><meta itemprop=name content="Elastic stack and Metricbeat"><meta itemprop=description content="Install Elastic Stack(ELK stack) with docker mbpr15:elk-wireshark cychong$ git clonehttps://github.com/deviantony/docker-elk.git git: 'clonehttps://github.com/deviantony/docker-elk.git' is not a git command. See 'git --help'. mbpr15:elk-wireshark cychong$ git clone https://github.com/deviantony/docker-elk.git Cloning into 'docker-elk'... remote: Counting objects: 1235, done. remote: Total 1235 (delta 0), reused 0 (delta 0), pack-reused 1235 Receiving objects: 100% (1235/1235), 259.29 KiB | 77.00 KiB/s, done. Resolving deltas: 100% (470/470), done. mbpr15:elk-wireshark cychong$ cd elk mbpr15:elk-wireshark cychong$ cd docker-elk/ mbpr15:docker-elk cychong$ ls LICENSE	elasticsearch	logstash README.md	extensions docker-compose.yml	kibana Install ELK with docker-compose mbpr15:docker-elk cychong$ docker-compose up -d Creating network &#34;docker-elk_elk&#34; with driver &#34;bridge&#34; Building elasticsearch Step 1/1 : FROM docker.elastic.co/elasticsearch/elasticsearch-oss:6.2.4 6.2.4: Pulling from elasticsearch/elasticsearch-oss 469cfcc7a4b3: Pull complete 8e27facfa9e0: Pull complete cdd15392adc7: Pull complete 19ff08a29664: Pull complete ddc4fd93fdcc: Pull complete b723bede0878: Pull complete Digest: sha256:2d9c774c536bd1f64abc4993ebc96a2344404d780cbeb81a8b3b4c3807550e57 Status: Downloaded newer image for docker.elastic.co/elasticsearch/elasticsearch-oss:6.2.4 ---> 3822ba554fe9 Successfully built 3822ba554fe9 Successfully tagged docker-elk_elasticsearch:latest WARNING: Image for service elasticsearch was built because it did not already exist. To rebuild this image you must use `docker-compose build` or `docker-compose up --build`. Building logstash Step 1/1 : FROM docker.elastic.co/logstash/logstash-oss:6.2.4 6.2.4: Pulling from logstash/logstash-oss 469cfcc7a4b3: Already exists b4cfa2eb1616: Pull complete ec994fa6fa7f: Pull complete ccf455902ac6: Pull complete 6d54f3767ae5: Pull complete af0dd1a720da: Pull complete 457dbabd3f63: Pull complete f2c481bd6da1: Pull complete d04342e2b9a1: Pull complete e8bca7e9b0d9: Pull complete d0096563f301: Pull complete Digest: sha256:28668a65f6b6a4f1e2abef7aa3fd3b9c8476a16aa5bebc1a9acf0f7de5b80eef Status: Downloaded newer image for docker.elastic.co/logstash/logstash-oss:6.2.4 ---> 0bade66b6bee Successfully built 0bade66b6bee Successfully tagged docker-elk_logstash:latest WARNING: Image for service logstash was built because it did not already exist. To rebuild this image you must use `docker-compose build` or `docker-compose up --build`. Building kibana Step 1/1 : FROM docker.elastic.co/kibana/kibana-oss:6.2.4 6.2.4: Pulling from kibana/kibana-oss 469cfcc7a4b3: Already exists 78e4c5fdc069: Pull complete d9ecdaefa1b8: Pull complete c8e48c8f74d7: Pull complete 1606c56cdbff: Pull complete 4e23ce1503d4: Pull complete d36b703b3f90: Pull complete da5da7625f92: Pull complete Digest: sha256:1d1f9bac326bf276010df82a2b4593619f48a5207619e8817c8b20d5a1bb3547 Status: Downloaded newer image for docker.elastic.co/kibana/kibana-oss:6.2.4 ---> 32510971af4e Successfully built 32510971af4e Successfully tagged docker-elk_kibana:latest WARNING: Image for service kibana was built because it did not already exist. To rebuild this image you must use `docker-compose build` or `docker-compose up --build`. Creating docker-elk_elasticsearch_1 ... done Creating docker-elk_kibana_1 ... done Creating docker-elk_logstash_1 ... done mbpr15:docker-elk cychong$ docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 4fc052e81fae docker-elk_logstash “/usr/local/bin/dock…” 9 minutes ago Up 9 minutes 5044/tcp, 0.0.0.0:5000->5000/tcp, 9600/tcp docker-elk_logstash_1 46f049297c7b docker-elk_kibana “/bin/bash /usr/loca…” 9 minutes ago Up 9 minutes 0.0.0.0:5601->5601/tcp docker-elk_kibana_1 8ff911ebab03 docker-elk_elasticsearch “/usr/local/bin/dock…” 9 minutes ago Up 9 minutes 0.0.0.0:9200->9200/tcp, 0.0.0.0:9300->9300/tcp docker-elk_elasticsearch_1 mbpr15:docker-elk cychong$ curl http://localhost:9200 { “name” : “npNAiWg”, “cluster_name” : “docker-cluster”, “cluster_uuid” : “7nY4KVvNS4epY4Z80NCUZw”, “version” : { “number” : “6.2.4”, “build_hash” : “ccec39f”, “build_date” : “2018-04-12T20:37:28.497551Z”, “build_snapshot” : false, “lucene_version” : “7.2.1”, “minimum_wire_compatibility_version” : “5.6.0”, “minimum_index_compatibility_version” : “5.0.0” }, “tagline” : “You Know, for Search” } Open http://localhost:5601 with browser install metricbeats with docker - check the latest version from elastic.co docker pull docker.elastic.co/beats/metricbeat:6.2.4 metricbeat 는 시스템 통계 정보를 수집해서 elasticsearch로 보내는 역할을 함. 다양한 모듈들이 modules.d 디렉토리 아래 위치하고, metricbeats.yml은 수집한 정보를 보낼 위치를 변경하는 정도면 기본적인 동작을 확인할 수 있음."><meta itemprop=datePublished content="2018-05-31T21:58:51+09:00"><meta itemprop=dateModified content="2018-06-07T13:43:49+00:00"><meta itemprop=wordCount content="874"><meta itemprop=keywords content="Docker,Container,Elk,Elasticsearch,Metricbeat,Monitoring"><meta name=referrer content="no-referrer-when-downgrade"><style>:root{--width:720px;--font-main:Verdana, sans-serif;--font-secondary:Verdana, sans-serif;--font-scale:1em;--background-color:#fafafa;--heading-color:#222;--text-color:#444;--link-color:#3273dc;--visited-color:#8b6fcb;--blockquote-color:#222}@media(prefers-color-scheme:dark){:root{--background-color:#fafafa;--heading-color:#222;--text-color:#444;--link-color:#3273dc;--visited-color:#8b6fcb;--blockquote-color:#222}}body{font-family:var(--font-secondary);font-size:var(--font-scale);margin:auto;padding:20px;max-width:var(--width);text-align:left;background-color:var(--background-color);word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:var(--text-color)}h1,h2,h3,h4,h5,h6{font-family:var(--font-main);color:var(--heading-color)}a{color:var(--link-color);cursor:pointer;text-decoration:none}a:hover{text-decoration:underline}nav a{margin-right:8px}strong,b{color:var(--heading-color)}button{margin:0;cursor:pointer}time{font-family:monospace;font-style:normal;font-size:15px}main{line-height:1.6}table{width:100%}hr{border:0;border-top:1px dashed}img{max-width:100%}code{font-family:monospace;padding:2px;border-radius:3px}blockquote{border-left:1px solid #999;color:var(--blockquote-color);padding-left:20px;font-style:italic}footer{padding:25px 0;text-align:center}.title:hover{text-decoration:none}.title h1{font-size:1.5em}.inline{width:auto!important}.highlight,.code{border-radius:3px;margin-block-start:1em;margin-block-end:1em;overflow-x:auto}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:var(--visited-color)}</style></head><body><header><a href=/ class=title><h2>Keep calm and Write something</h2></a><nav><a href=/post/>Post</a>
<a href=/page/>Page</a>
<a href=/series/>Series</a>
<a href=/tags/>Tag</a>
<a href=/archive/>Archive</a>
<a href=/search/>Search</a></nav></header><main><content><h2 id=install-elastic-stackelk-stack-with-docker>Install Elastic Stack(ELK stack) with docker</h2><pre tabindex=0><code>mbpr15:elk-wireshark cychong$ git clonehttps://github.com/deviantony/docker-elk.git
git: &#39;clonehttps://github.com/deviantony/docker-elk.git&#39; is not a git command. See &#39;git --help&#39;.
mbpr15:elk-wireshark cychong$ git clone https://github.com/deviantony/docker-elk.git
Cloning into &#39;docker-elk&#39;...
remote: Counting objects: 1235, done.
remote: Total 1235 (delta 0), reused 0 (delta 0), pack-reused 1235
Receiving objects: 100% (1235/1235), 259.29 KiB | 77.00 KiB/s, done.
Resolving deltas: 100% (470/470), done.
mbpr15:elk-wireshark cychong$ cd elk
mbpr15:elk-wireshark cychong$ cd docker-elk/
mbpr15:docker-elk cychong$ ls
LICENSE			elasticsearch		logstash
README.md		extensions
docker-compose.yml	kibana
</code></pre><h2 id=install-elk-with-docker-compose>Install ELK with docker-compose</h2><pre tabindex=0><code>mbpr15:docker-elk cychong$ docker-compose up -d
Creating network &#34;docker-elk_elk&#34; with driver &#34;bridge&#34;
Building elasticsearch
Step 1/1 : FROM docker.elastic.co/elasticsearch/elasticsearch-oss:6.2.4
6.2.4: Pulling from elasticsearch/elasticsearch-oss
469cfcc7a4b3: Pull complete
8e27facfa9e0: Pull complete
cdd15392adc7: Pull complete
19ff08a29664: Pull complete
ddc4fd93fdcc: Pull complete
b723bede0878: Pull complete
Digest: sha256:2d9c774c536bd1f64abc4993ebc96a2344404d780cbeb81a8b3b4c3807550e57
Status: Downloaded newer image for docker.elastic.co/elasticsearch/elasticsearch-oss:6.2.4
 ---&gt; 3822ba554fe9
Successfully built 3822ba554fe9
Successfully tagged docker-elk_elasticsearch:latest
WARNING: Image for service elasticsearch was built because it did not already exist. To rebuild this image you must use `docker-compose build` or `docker-compose up --build`.
Building logstash
Step 1/1 : FROM docker.elastic.co/logstash/logstash-oss:6.2.4
6.2.4: Pulling from logstash/logstash-oss
469cfcc7a4b3: Already exists
b4cfa2eb1616: Pull complete
ec994fa6fa7f: Pull complete
ccf455902ac6: Pull complete
6d54f3767ae5: Pull complete
af0dd1a720da: Pull complete
457dbabd3f63: Pull complete
f2c481bd6da1: Pull complete
d04342e2b9a1: Pull complete
e8bca7e9b0d9: Pull complete
d0096563f301: Pull complete
Digest: sha256:28668a65f6b6a4f1e2abef7aa3fd3b9c8476a16aa5bebc1a9acf0f7de5b80eef
Status: Downloaded newer image for docker.elastic.co/logstash/logstash-oss:6.2.4
 ---&gt; 0bade66b6bee
Successfully built 0bade66b6bee
Successfully tagged docker-elk_logstash:latest
WARNING: Image for service logstash was built because it did not already exist. To rebuild this image you must use `docker-compose build` or `docker-compose up --build`.
Building kibana
Step 1/1 : FROM docker.elastic.co/kibana/kibana-oss:6.2.4
6.2.4: Pulling from kibana/kibana-oss
469cfcc7a4b3: Already exists
78e4c5fdc069: Pull complete
d9ecdaefa1b8: Pull complete
c8e48c8f74d7: Pull complete
1606c56cdbff: Pull complete
4e23ce1503d4: Pull complete
d36b703b3f90: Pull complete
da5da7625f92: Pull complete
Digest: sha256:1d1f9bac326bf276010df82a2b4593619f48a5207619e8817c8b20d5a1bb3547
Status: Downloaded newer image for docker.elastic.co/kibana/kibana-oss:6.2.4
 ---&gt; 32510971af4e
Successfully built 32510971af4e
Successfully tagged docker-elk_kibana:latest
WARNING: Image for service kibana was built because it did not already exist. To rebuild this image you must use `docker-compose build` or `docker-compose up --build`.
Creating docker-elk_elasticsearch_1 ... done
Creating docker-elk_kibana_1        ... done
Creating docker-elk_logstash_1      ... done
</code></pre><pre tabindex=0><code>mbpr15:docker-elk cychong$ docker ps
CONTAINER ID        IMAGE                      COMMAND                  CREATED             STATUS              PORTS                                            NAMES
4fc052e81fae        docker-elk_logstash        “/usr/local/bin/dock…”   9 minutes ago       Up 9 minutes        5044/tcp, 0.0.0.0:5000-&gt;5000/tcp, 9600/tcp       docker-elk_logstash_1
46f049297c7b        docker-elk_kibana          “/bin/bash /usr/loca…”   9 minutes ago       Up 9 minutes        0.0.0.0:5601-&gt;5601/tcp                           docker-elk_kibana_1
8ff911ebab03        docker-elk_elasticsearch   “/usr/local/bin/dock…”   9 minutes ago       Up 9 minutes        0.0.0.0:9200-&gt;9200/tcp, 0.0.0.0:9300-&gt;9300/tcp   docker-elk_elasticsearch_1
</code></pre><pre tabindex=0><code>mbpr15:docker-elk cychong$ curl http://localhost:9200
{
  “name” : “npNAiWg”,
  “cluster_name” : “docker-cluster”,
  “cluster_uuid” : “7nY4KVvNS4epY4Z80NCUZw”,
  “version” : {
    “number” : “6.2.4”,
    “build_hash” : “ccec39f”,
    “build_date” : “2018-04-12T20:37:28.497551Z”,
    “build_snapshot” : false,
    “lucene_version” : “7.2.1”,
    “minimum_wire_compatibility_version” : “5.6.0”,
    “minimum_index_compatibility_version” : “5.0.0”
  },
  “tagline” : “You Know, for Search”
}
</code></pre><h2 id=open-httplocalhost5601-with-browser>Open http://localhost:5601 with browser</h2><h2 id=install-metricbeats-with-docker---check-the-latest-version-from-elasticco>install metricbeats with docker - check the latest version from elastic.co</h2><pre tabindex=0><code>docker pull docker.elastic.co/beats/metricbeat:6.2.4
</code></pre><p>metricbeat 는 시스템 통계 정보를 수집해서 elasticsearch로 보내는 역할을 함.
다양한 모듈들이 <code>modules.d</code> 디렉토리 아래 위치하고, metricbeats.yml은 수집한 정보를 보낼 위치를 변경하는 정도면 기본적인 동작을 확인할 수 있음.</p><pre tabindex=0><code>mbpr15:metricbeat-6.2.4-darwin-x86_64 cychong$ tree -f modules.d/
modules.d
├── modules.d/aerospike.yml.disabled
├── modules.d/apache.yml.disabled
├── modules.d/ceph.yml.disabled
├── modules.d/couchbase.yml.disabled
├── modules.d/docker.yml.disabled
├── modules.d/dropwizard.yml.disabled
├── modules.d/elasticsearch.yml.disabled
├── modules.d/etcd.yml.disabled
├── modules.d/golang.yml.disabled
├── modules.d/graphite.yml.disabled
├── modules.d/haproxy.yml.disabled
├── modules.d/http.yml.disabled
├── modules.d/jolokia.yml.disabled
├── modules.d/kafka.yml.disabled
├── modules.d/kibana.yml.disabled
├── modules.d/kubernetes.yml.disabled
├── modules.d/logstash.yml.disabled
├── modules.d/memcached.yml.disabled
├── modules.d/mongodb.yml.disabled
├── modules.d/mysql.yml.disabled
├── modules.d/nginx.yml.disabled
├── modules.d/php_fpm.yml.disabled
├── modules.d/postgresql.yml.disabled
├── modules.d/prometheus.yml.disabled
├── modules.d/rabbitmq.yml.disabled
├── modules.d/redis.yml.disabled
├── modules.d/system.yml
├── modules.d/uwsgi.yml.disabled
├── modules.d/vsphere.yml.disabled
├── modules.d/windows.yml.disabled
└── modules.d/zookeeper.yml.disabled

0 directories, 31 files
</code></pre><p>아래에서 <code>hosts</code>의 기본값은 localhost이므로, 필요한 경우 elasticisearch가 동작하고 있는 특정 서버의 IP로 변경한다.</p><pre tabindex=0><code>#-------------------------- Elasticsearch output ------------------------------
output.elasticsearch:
  # Array of hosts to connect to.
  hosts: [&#34;192.168.1.70:9200&#34;]
</code></pre><p>MBPr15와 mini2 에서 각각 metricbeat를 실행해서 metric 정보를 elasticsearch로 보내도록 함.
아래는 기본 yml인 <code>metricbeat.yml</code>에서 위 output부분만 수정하여 <code>memphis.yml</code>로 저장후 사용</p><pre tabindex=0><code>mbpr15:metricbeat-6.2.4-darwin-x86_64 cychong$ sudo ./metricbeat -e -c memphis.yml 
</code></pre><pre tabindex=0><code>mini2:metricbeat-6.2.4-darwin-x86_64 cychong$ ./metricbeat -e -c mini2.yaml 
</code></pre><p>이렇게 하면 화면에 주기적으로 elasticsearch로 보내는 정보를 출력한다.(전체 정보는 아닐 듯&mldr;.) 이렇게 옵션을 주면 화면에 별도의 로그 출력이 없다.</p><pre tabindex=0><code>sudo metricbeat -e &gt; /dev/null 2&gt;&amp;1 &amp;
</code></pre><p>이걸 하긴 했는데 굳이 따로 할 필요는 없는 듯. Kibana에 default dashboard를 생성하는 거라고 하는데(다시 확인해 보자)</p><pre tabindex=0><code>sudo ./metricbeat setup -c memphis.yml
</code></pre><pre tabindex=0><code>mbpr15:~ cychong$ curl -XGET &#39;localhost:9200/_cat/indices?v&amp;pretty&#39;
health status index                       uuid                   pri rep docs.count docs.deleted store.size pri.store.size
yellow open   metricbeat-6.2.4-2018.06.01 2WRn5ddLRAm5E7J56pwRXA   5   1     127340            0     35.8mb         35.8mb
yellow open   metricbeat-6.2.4-2018.05.31 8dsKJT4ASEadN9CD9-uQ-A   5   1        136            0    317.2kb        317.2kb
green  open   .kibana                     tCI5Fu5BTda1gpDNm1cCeQ   1   0        126           14    316.8kb        316.8kb
</code></pre><p>system 정보를 얻어오는 거라 root 권한이 필요할 듯 한데 지금은 MBPr15에서는 루트 권한으로 그리고 mini2에서는 그냥 개인 계정으로 실행 중</p><h2 id=kibana-dashboard>Kibana dashboard</h2><h3 id=system-overview>System overview</h3><p><img src=/images/2018/05/elk_metricbeat_1.png alt=elk_metricbeat_1></p><h3 id=host-overview---mbpr15>Host overview - MBPr15</h3><p><img src=/images/2018/05/elk_metricbeat_2.png alt=elk_metricbeat_2></p><h3 id=host-overview---mini2>Host overview - mini2</h3><p><img src=/images/2018/05/elk_metricbeat_3.png alt=elk_metricbeat_3>
xcode command line update하느라 힘든 mini2. 위 그림보다 CPU utilization이 올라갔다.
<img src=/images/2018/05/elk_metricbeat_4.png alt=elk_metricbeat_4></p><h2 id=on-ubuntu>On ubuntu</h2><p>Linux의 경우 deb이나 rpm 패키지를 이용해서 설치할 수 있다. 이 경우 패키지가 설치되면 아래 위치에서 beat 관련 파일을 확인할 수 있다.</p><pre tabindex=0><code>$ ls -al /usr/share/metricbeat/
total 228
drwxr-xr-x   4 root root   4096  6월  1 08:48 ./
drwxr-xr-x 404 root root  16384  6월  1 09:32 ../
drwxr-xr-x   2 root root   4096  6월  1 08:48 bin/
-rw-r--r--   1 root root     41  4월 13 05:25 .build_hash.txt
drwxrwxr-x   4 root root   4096  6월  1 08:48 kibana/
-rw-r--r--   1 root root    583  4월 13 05:25 LICENSE.txt
-rw-r--r--   1 root root 190678  4월 13 05:25 NOTICE.txt
-rw-r--r--   1 root root    806  4월 13 05:25 README.md
</code></pre><h2 id=참고>참고</h2><ul><li><a href=http://www.kwangsiklee.com/ko/2018/04/%EB%A9%94%ED%8A%B8%EB%A6%AD%EB%B9%84%ED%8A%B8metricbeat%EB%A1%9C-%EC%8B%9C%EC%8A%A4%ED%85%9C-%EB%AA%A8%EB%8B%88%ED%84%B0%EB%A7%81-%ED%95%98%EA%B8%B0/>메트릭비트(metricbeat)로 시스템 모니터링 하기 | KWANGSIK LEE’s log</a></li><li><a href=https://logz.io/blog/metricbeat-tutorial/>A Metricbeat Tutorial: Getting Started</a></li><li><a href=https://logz.io/blog/filebeat-tutorial/>A Filebeat Tutorial: Getting Started</a></li><li><a href=https://logz.io/blog/elk-stack-on-docker/>Installing the ELK Stack on Docker</a></li></ul></content><p><a href=https://cychong47.github.io/tags/docker/>#Docker</a>
<a href=https://cychong47.github.io/tags/container/>#Container</a>
<a href=https://cychong47.github.io/tags/elk/>#Elk</a>
<a href=https://cychong47.github.io/tags/elasticsearch/>#Elasticsearch</a>
<a href=https://cychong47.github.io/tags/metricbeat/>#Metricbeat</a>
<a href=https://cychong47.github.io/tags/monitoring/>#Monitoring</a></p></main><footer>Made with <a href=https://github.com/janraasch/hugo-bearblog/>Hugo ʕ•ᴥ•ʔ Bear</a></footer></body></html>