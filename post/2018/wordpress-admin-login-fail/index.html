<!doctype html><html lang=en-us><head><meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>wordpress admin 계정 복구 | Keep calm and Write something</title><meta name=title content="wordpress admin 계정 복구"><meta name=description content="문제
블로그 보는 거 자체는 문제가 없는데 admin 계정으로 로그인 시도하면 반복해서 로그인 페이지로 redirect됨
http://sosa0sa.com/wp-login.php?redirect_to=http://sosa0sa.com/wp-admin/&amp;reauth=1
구글링을 하니 대부분 쿠키를 초기화하고, theme, plugin등을 초기화하라는 의견이 대부분. 모두 따라해 봤으니 제대로 동작하지 않는다&mldr; -_-;;;
마지막으로 wp_usermeta table에서 session_token 값을 초기화하라는 말이 있어 이것도 해 보기로. phpmyadmin을 설치해서 table의 값을 변경하라고 해서 phpmyadmin을 역시 docker로 설치해 보기로
https://wordpress.org/support/topic/possible-fix-for-sudden-redirect-loop-at-wp-login-with-reauth1/
Phpmyadmin docker 설치
Wordpress ansible-playbook 에 다음과 같이 추가
links를 통해 mysql container와 연결하고 PMA_HOST를 해당 mysql container의 name으로 지정하는 것이 중요한 내용임.
처음에는 PMA_HOST를 “localhost”나 “127.0.0.1”로 지정하니 정상적으로 mysql에 로그인이 되지 않음"><meta name=keywords content="Getting Started,wordpress,mysql,troubleshooting,"><meta property="og:url" content="https://cychong47.github.io/post/2018/wordpress-admin-login-fail/"><meta property="og:site_name" content="Keep calm and Write something"><meta property="og:title" content="wordpress admin 계정 복구"><meta property="og:description" content="문제 블로그 보는 거 자체는 문제가 없는데 admin 계정으로 로그인 시도하면 반복해서 로그인 페이지로 redirect됨
http://sosa0sa.com/wp-login.php?redirect_to=http://sosa0sa.com/wp-admin/&amp;reauth=1 구글링을 하니 대부분 쿠키를 초기화하고, theme, plugin등을 초기화하라는 의견이 대부분. 모두 따라해 봤으니 제대로 동작하지 않는다… -_-;;;
마지막으로 wp_usermeta table에서 session_token 값을 초기화하라는 말이 있어 이것도 해 보기로. phpmyadmin을 설치해서 table의 값을 변경하라고 해서 phpmyadmin을 역시 docker로 설치해 보기로
https://wordpress.org/support/topic/possible-fix-for-sudden-redirect-loop-at-wp-login-with-reauth1/
Phpmyadmin docker 설치 Wordpress ansible-playbook 에 다음과 같이 추가
links를 통해 mysql container와 연결하고 PMA_HOST를 해당 mysql container의 name으로 지정하는 것이 중요한 내용임. 처음에는 PMA_HOST를 “localhost”나 “127.0.0.1”로 지정하니 정상적으로 mysql에 로그인이 되지 않음"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2018-06-14T14:21:13+09:00"><meta property="article:modified_time" content="2019-02-28T14:04:18+00:00"><meta property="article:tag" content="Getting Started"><meta property="article:tag" content="Wordpress"><meta property="article:tag" content="Mysql"><meta property="article:tag" content="Troubleshooting"><meta name=twitter:card content="summary"><meta name=twitter:title content="wordpress admin 계정 복구"><meta name=twitter:description content="문제 블로그 보는 거 자체는 문제가 없는데 admin 계정으로 로그인 시도하면 반복해서 로그인 페이지로 redirect됨
http://sosa0sa.com/wp-login.php?redirect_to=http://sosa0sa.com/wp-admin/&amp;reauth=1 구글링을 하니 대부분 쿠키를 초기화하고, theme, plugin등을 초기화하라는 의견이 대부분. 모두 따라해 봤으니 제대로 동작하지 않는다… -_-;;;
마지막으로 wp_usermeta table에서 session_token 값을 초기화하라는 말이 있어 이것도 해 보기로. phpmyadmin을 설치해서 table의 값을 변경하라고 해서 phpmyadmin을 역시 docker로 설치해 보기로
https://wordpress.org/support/topic/possible-fix-for-sudden-redirect-loop-at-wp-login-with-reauth1/
Phpmyadmin docker 설치 Wordpress ansible-playbook 에 다음과 같이 추가
links를 통해 mysql container와 연결하고 PMA_HOST를 해당 mysql container의 name으로 지정하는 것이 중요한 내용임. 처음에는 PMA_HOST를 “localhost”나 “127.0.0.1”로 지정하니 정상적으로 mysql에 로그인이 되지 않음"><meta itemprop=name content="wordpress admin 계정 복구"><meta itemprop=description content="문제 블로그 보는 거 자체는 문제가 없는데 admin 계정으로 로그인 시도하면 반복해서 로그인 페이지로 redirect됨
http://sosa0sa.com/wp-login.php?redirect_to=http://sosa0sa.com/wp-admin/&amp;reauth=1 구글링을 하니 대부분 쿠키를 초기화하고, theme, plugin등을 초기화하라는 의견이 대부분. 모두 따라해 봤으니 제대로 동작하지 않는다… -_-;;;
마지막으로 wp_usermeta table에서 session_token 값을 초기화하라는 말이 있어 이것도 해 보기로. phpmyadmin을 설치해서 table의 값을 변경하라고 해서 phpmyadmin을 역시 docker로 설치해 보기로
https://wordpress.org/support/topic/possible-fix-for-sudden-redirect-loop-at-wp-login-with-reauth1/
Phpmyadmin docker 설치 Wordpress ansible-playbook 에 다음과 같이 추가
links를 통해 mysql container와 연결하고 PMA_HOST를 해당 mysql container의 name으로 지정하는 것이 중요한 내용임. 처음에는 PMA_HOST를 “localhost”나 “127.0.0.1”로 지정하니 정상적으로 mysql에 로그인이 되지 않음"><meta itemprop=datePublished content="2018-06-14T14:21:13+09:00"><meta itemprop=dateModified content="2019-02-28T14:04:18+00:00"><meta itemprop=wordCount content="606"><meta itemprop=keywords content="Getting Started,Wordpress,Mysql,Troubleshooting"><meta name=referrer content="no-referrer-when-downgrade"><style>:root{--width:720px;--font-main:Verdana, sans-serif;--font-secondary:Verdana, sans-serif;--font-scale:1em;--background-color:#fafafa;--heading-color:#222;--text-color:#444;--link-color:#3273dc;--visited-color:#8b6fcb;--blockquote-color:#222}@media(prefers-color-scheme:dark){:root{--background-color:#fafafa;--heading-color:#222;--text-color:#444;--link-color:#3273dc;--visited-color:#8b6fcb;--blockquote-color:#222}}body{font-family:var(--font-secondary);font-size:var(--font-scale);margin:auto;padding:20px;max-width:var(--width);text-align:left;background-color:var(--background-color);word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:var(--text-color)}h1,h2,h3,h4,h5,h6{font-family:var(--font-main);color:var(--heading-color)}a{color:var(--link-color);cursor:pointer;text-decoration:none}a:hover{text-decoration:underline}nav a{margin-right:8px}strong,b{color:var(--heading-color)}button{margin:0;cursor:pointer}time{font-family:monospace;font-style:normal;font-size:15px}main{line-height:1.6}table{width:100%}hr{border:0;border-top:1px dashed}img{max-width:100%}code{font-family:monospace;padding:2px;border-radius:3px}blockquote{border-left:1px solid #999;color:var(--blockquote-color);padding-left:20px;font-style:italic}footer{padding:25px 0;text-align:center}.title:hover{text-decoration:none}.title h1{font-size:1.5em}.inline{width:auto!important}.highlight,.code{border-radius:3px;margin-block-start:1em;margin-block-end:1em;overflow-x:auto}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:var(--visited-color)}</style></head><body><header><a href=/ class=title><h2>Keep calm and Write something</h2></a><nav><a href=/post/>Post</a>
<a href=/page/>Page</a>
<a href=/series/>Series</a>
<a href=/tags/>Tag</a>
<a href=/archive/>Archive</a>
<a href=/search/>Search</a></nav></header><main><content><h2 id=문제>문제</h2><p>블로그 보는 거 자체는 문제가 없는데 admin 계정으로 로그인 시도하면 반복해서 로그인 페이지로 redirect됨</p><pre tabindex=0><code>http://sosa0sa.com/wp-login.php?redirect_to=http://sosa0sa.com/wp-admin/&amp;reauth=1
</code></pre><p>구글링을 하니 대부분 쿠키를 초기화하고, theme, plugin등을 초기화하라는 의견이 대부분. 모두 따라해 봤으니 제대로 동작하지 않는다&mldr; <code>-_-</code>;;;</p><p>마지막으로 wp_usermeta table에서 session_token 값을 초기화하라는 말이 있어 이것도 해 보기로. <code>phpmyadmin</code>을 설치해서 table의 값을 변경하라고 해서 <code>phpmyadmin</code>을 역시 docker로 설치해 보기로</p><p><a href=https://wordpress.org/support/topic/possible-fix-for-sudden-redirect-loop-at-wp-login-with-reauth1/>https://wordpress.org/support/topic/possible-fix-for-sudden-redirect-loop-at-wp-login-with-reauth1/</a></p><h2 id=phpmyadmin-docker-설치>Phpmyadmin docker 설치</h2><p>Wordpress ansible-playbook 에 다음과 같이 추가</p><p>links를 통해 mysql container와 연결하고 PMA_HOST를 해당 mysql container의 name으로 지정하는 것이 중요한 내용임.
처음에는 PMA_HOST를 “localhost”나 “127.0.0.1”로 지정하니 정상적으로 mysql에 로그인이 되지 않음</p><pre tabindex=0><code>- name: Start phpmyadmin
    docker_container:
      name: phpmyadmin
      image: phpmyadmin/phpmyadmin
      links:
         - mysql:mysql
      # always pull the latest image
      pull: no
      state: started
      recreate: yes
      restart_policy: &#34;always&#34;
      ports:
         - &#34;8181:80&#34;
      env:
           PMA_HOST: &#34;mysql&#34;
           MYSQL_USERNAME: &#34;root&#34;
           MYSQL_ROOT_PASSWORD: &#34;root_password&#34;
</code></pre><p>그런데 mysql로 접속했는데 mysql의 DB 내용이 정상적으로 나오지 않음.
그런데 phpmyadmin 을 설치한 후 주소(http://192.168.1.200:8181)를 접근하니 예전에 본것과 다르게 뭔가 허전한 화면만 나온다.</p><p>아는 것도 없지만 그래도 혹시나 하고 docker에 bash로 접근해서 얼마전에 <code>influxDB</code>에서 사용해 본 명령어가 같을 듯 해서 입력해 봤는데 이것도 제대로 동작하지 않는다.</p><pre tabindex=0><code>mini2:~ cychong$ docker exec -it a7681c4ec35e bash
root@a7681c4ec35e:/# mysql
ERROR 1045 (28000): Access denied for user &#39;root&#39;@&#39;localhost&#39; (using password: YES)
root@a7681c4ec35e:/# mysql -u root -p
Enter password:
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 39
Server version: 8.0.11 MySQL Community Server - GPL

Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.

mysql&gt; show databases;
ERROR 1449 (HY000): The user specified as a definer (&#39;mysql.infoschema&#39;@&#39;localhost&#39;) does not exist
</code></pre><p>web으로 다시 phpmyadmin 화면에 접근했을 때 나온 에러 메시지를 찾아보기로
바로 이거</p><pre tabindex=0><code>The user specified as a definer (&#39;mysql.infoschema&#39;@&#39;localhost&#39;) does not exist
</code></pre><p>구글링을 하니 역시나 흔한 문제인 듯. 다음과 같은 글을 찾을 수 있어 글에서 시킨대로 해봤다.</p><p><a href=https://stackoverflow.com/questions/49992868/mysql-errorthe-user-specified-as-a-definer-mysql-infoschemalocalhost-doe>https://stackoverflow.com/questions/49992868/mysql-errorthe-user-specified-as-a-definer-mysql-infoschemalocalhost-doe</a></p><p>암호는 container 생성할 때 인자로 넣어주는 <code>MYSQL_ROOT_PASSWORD</code>값을 사용한다. wordpress.yaml 파일에서 확인 가능..</p><pre tabindex=0><code>root@a7681c4ec35e:/var/log# mysql_upgrade -u root -p
Enter password:
Checking if update is needed.
Checking server version.
Running queries to upgrade MySQL server.
Upgrading system table data.
Checking system database.
mysql.columns_priv                                 OK
mysql.component                                    OK
mysql.db                                           OK
mysql.default_roles                                OK
mysql.engine_cost                                  OK
mysql.func                                         OK
mysql.general_log                                  OK
mysql.global_grants                                OK
mysql.gtid_executed                                OK
mysql.help_category                                OK
mysql.help_keyword                                 OK
mysql.help_relation                                OK
mysql.help_topic                                   OK
mysql.innodb_index_stats                           OK
mysql.innodb_table_stats                           OK
mysql.ndb_binlog_index                             OK
mysql.password_history                             OK
mysql.plugin                                       OK
mysql.procs_priv                                   OK
mysql.proxies_priv                                 OK
mysql.role_edges                                   OK
mysql.server_cost                                  OK
mysql.servers                                      OK
mysql.slave_master_info                            OK
mysql.slave_relay_log_info                         OK
mysql.slave_worker_info                            OK
mysql.slow_log                                     OK
mysql.tables_priv                                  OK
mysql.time_zone                                    OK
mysql.time_zone_leap_second                        OK
mysql.time_zone_name                               OK
mysql.time_zone_transition                         OK
mysql.time_zone_transition_type                    OK
mysql.user                                         OK
Found outdated sys schema version 1.5.1.
Upgrading the sys schema.
Checking databases.
sys.sys_config                                     OK
wordpress_db.wp_commentmeta                        OK
wordpress_db.wp_comments                           OK
wordpress_db.wp_links                              OK
wordpress_db.wp_options                            OK
wordpress_db.wp_postmeta                           OK
wordpress_db.wp_posts                              OK
wordpress_db.wp_term_relationships                 OK
wordpress_db.wp_term_taxonomy                      OK
wordpress_db.wp_termmeta                           OK
wordpress_db.wp_terms                              OK
wordpress_db.wp_usermeta                           OK
wordpress_db.wp_users                              OK
Upgrade process completed successfully.
Checking if update is needed.
root@a7681c4ec35e:/var/log#
</code></pre><p>이제 다시 <code>phpmyadmin</code>화면을 접근하니 이제 정상적인(?) 뭔가가 보인다.</p><p><img src=/images/2018/06/phpmyadmin_works.png alt=phpmyadmin_works></p><p>뭔가 제대로 되는 것 같다. 다시 wordpress admin 계정으로 로그인하니 이젠 된다!!! Finally&mldr;</p><h2 id=그래도-안될때>그래도 안될때</h2><p>(2019.02.28) wordpress가 5.1로 업데이트 되어 그걸 적용했더니 database 파일도 업그레이드를 해야 한다고. 그래서 <code>해라</code> 그랬더니 또 로그인이 안된다. 이번에는 위의 <code>mysql_upgrade</code> 명령을 써도 안되고&mldr;.</p><p>다행히 구글링에서 유용한 정보를 찾았다. 처음 본 순간 왠지 잘 될 것 같았는데 정말로 한번에 문제를 해결해줬다.
<a href=https://www.fixrunner.com/cannot-login-wordpress-admin-area/>https://www.fixrunner.com/cannot-login-wordpress-admin-area/</a></p><p>한 줄 요약하면 mysql database에 저장되어 있는 로그인 암호를 직접 변경하는 것.</p><p>wordpress database에서 <code>wp_user</code>라는 테이블의 <code>user_pass</code>라는 필드를 변경하는 거다.
phpmyadmin으로 수정하는 창에서 보니 결국(?) 이런 sql 명령으로 변경할 수 있다고 한다.
아래 <code>새 암호</code>에 원하는 새로운 암호를 넣으면 그걸 md5 hash한 값을 <code>user_pass</code> 필드에 저장한다.</p><pre tabindex=0><code>UPDATE `wp_users` SET `user_pass` = MD5(&#39;새 암호&#39;) WHERE `wp_users`.`ID` = 1;
</code></pre><p>다행히 오랫동안 헤매지 않고 해결해서 다행이다.</p></content><p><a href=https://cychong47.github.io/tags/getting-started/>#Getting Started</a>
<a href=https://cychong47.github.io/tags/wordpress/>#Wordpress</a>
<a href=https://cychong47.github.io/tags/mysql/>#Mysql</a>
<a href=https://cychong47.github.io/tags/troubleshooting/>#Troubleshooting</a></p></main><footer>Made with <a href=https://github.com/janraasch/hugo-bearblog/>Hugo ʕ•ᴥ•ʔ Bear</a></footer></body></html>