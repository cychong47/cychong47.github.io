<!doctype html><html lang=en-us><head><meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>(책) Violent Python | Keep calm and Write something</title><meta name=title content="(책) Violent Python"><meta name=description content="오래만에 재밌는 책을 봤다.
해커를 위한 책이라고 하지만, 해킹에 관한 기법보다는 network application을 작성하는데 유용한 scapy, dpkt 그리고 정규식에 대한 설명이 유용하다.
마침 요 근래 업무용으로 Python을 이용해서 패킷 만들고, 송/수신하는 유틸리티를 만들고 있어 Impacket 모듈을 많이 사용했는데 그것보다 scapy 가 훨씬 편해 보인다.
새 책을 사긴 그렇고 중고책을 하나 구할 까 했는데 알라딘에서 중고책 매입가가 4천원 대. 작년 초에 나온 책인데 너무 싸게 매입하는 게 아닌가
일단 책 보면서 유용하다 싶은 내용을 몇 가지 주제로 나눠 정리했다."><meta name=keywords content="Python,dpkt,scapy,Book,"><meta property="og:url" content="https://cychong47.github.io/post/2014/caeg-violent-python/"><meta property="og:site_name" content="Keep calm and Write something"><meta property="og:title" content="(책) Violent Python"><meta property="og:description" content="오래만에 재밌는 책을 봤다.
해커를 위한 책이라고 하지만, 해킹에 관한 기법보다는 network application을 작성하는데 유용한 scapy, dpkt 그리고 정규식에 대한 설명이 유용하다. 마침 요 근래 업무용으로 Python을 이용해서 패킷 만들고, 송/수신하는 유틸리티를 만들고 있어 Impacket 모듈을 많이 사용했는데 그것보다 scapy 가 훨씬 편해 보인다.
새 책을 사긴 그렇고 중고책을 하나 구할 까 했는데 알라딘에서 중고책 매입가가 4천원 대. 작년 초에 나온 책인데 너무 싸게 매입하는 게 아닌가
일단 책 보면서 유용하다 싶은 내용을 몇 가지 주제로 나눠 정리했다."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2014-09-27T16:43:27+09:00"><meta property="article:modified_time" content="2018-08-19T22:06:31+00:00"><meta property="article:tag" content="Python"><meta property="article:tag" content="Dpkt"><meta property="article:tag" content="Scapy"><meta property="article:tag" content="Book"><meta name=twitter:card content="summary"><meta name=twitter:title content="(책) Violent Python"><meta name=twitter:description content="오래만에 재밌는 책을 봤다.
해커를 위한 책이라고 하지만, 해킹에 관한 기법보다는 network application을 작성하는데 유용한 scapy, dpkt 그리고 정규식에 대한 설명이 유용하다. 마침 요 근래 업무용으로 Python을 이용해서 패킷 만들고, 송/수신하는 유틸리티를 만들고 있어 Impacket 모듈을 많이 사용했는데 그것보다 scapy 가 훨씬 편해 보인다.
새 책을 사긴 그렇고 중고책을 하나 구할 까 했는데 알라딘에서 중고책 매입가가 4천원 대. 작년 초에 나온 책인데 너무 싸게 매입하는 게 아닌가
일단 책 보면서 유용하다 싶은 내용을 몇 가지 주제로 나눠 정리했다."><meta itemprop=name content="(책) Violent Python"><meta itemprop=description content="오래만에 재밌는 책을 봤다.
해커를 위한 책이라고 하지만, 해킹에 관한 기법보다는 network application을 작성하는데 유용한 scapy, dpkt 그리고 정규식에 대한 설명이 유용하다. 마침 요 근래 업무용으로 Python을 이용해서 패킷 만들고, 송/수신하는 유틸리티를 만들고 있어 Impacket 모듈을 많이 사용했는데 그것보다 scapy 가 훨씬 편해 보인다.
새 책을 사긴 그렇고 중고책을 하나 구할 까 했는데 알라딘에서 중고책 매입가가 4천원 대. 작년 초에 나온 책인데 너무 싸게 매입하는 게 아닌가
일단 책 보면서 유용하다 싶은 내용을 몇 가지 주제로 나눠 정리했다."><meta itemprop=datePublished content="2014-09-27T16:43:27+09:00"><meta itemprop=dateModified content="2018-08-19T22:06:31+00:00"><meta itemprop=wordCount content="524"><meta itemprop=keywords content="Python,Dpkt,Scapy,Book"><meta name=referrer content="no-referrer-when-downgrade"><style>:root{--width:720px;--font-main:Verdana, sans-serif;--font-secondary:Verdana, sans-serif;--font-scale:1em;--background-color:#fafafa;--heading-color:#222;--text-color:#444;--link-color:#3273dc;--visited-color:#8b6fcb;--blockquote-color:#222}@media(prefers-color-scheme:dark){:root{--background-color:#fafafa;--heading-color:#222;--text-color:#444;--link-color:#3273dc;--visited-color:#8b6fcb;--blockquote-color:#222}}body{font-family:var(--font-secondary);font-size:var(--font-scale);margin:auto;padding:20px;max-width:var(--width);text-align:left;background-color:var(--background-color);word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:var(--text-color)}h1,h2,h3,h4,h5,h6{font-family:var(--font-main);color:var(--heading-color)}a{color:var(--link-color);cursor:pointer;text-decoration:none}a:hover{text-decoration:underline}nav a{margin-right:8px}strong,b{color:var(--heading-color)}button{margin:0;cursor:pointer}time{font-family:monospace;font-style:normal;font-size:15px}main{line-height:1.6}table{width:100%}hr{border:0;border-top:1px dashed}img{max-width:100%}code{font-family:monospace;padding:2px;border-radius:3px}blockquote{border-left:1px solid #999;color:var(--blockquote-color);padding-left:20px;font-style:italic}footer{padding:25px 0;text-align:center}.title:hover{text-decoration:none}.title h1{font-size:1.5em}.inline{width:auto!important}.highlight,.code{border-radius:3px;margin-block-start:1em;margin-block-end:1em;overflow-x:auto}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:var(--visited-color)}</style></head><body><header><a href=/ class=title><h2>Keep calm and Write something</h2></a><nav><a href=/post/>Post</a>
<a href=/page/>Page</a>
<a href=/series/>Series</a>
<a href=/tags/>Tag</a>
<a href=/archive/>Archive</a>
<a href=/search/>Search</a></nav></header><main><content><p>오래만에 재밌는 책을 봤다.</p><p>해커를 위한 책이라고 하지만, 해킹에 관한 기법보다는 network application을 작성하는데 유용한 scapy, dpkt 그리고 정규식에 대한 설명이 유용하다.
마침 요 근래 업무용으로 Python을 이용해서 패킷 만들고, 송/수신하는 유틸리티를 만들고 있어 Impacket 모듈을 많이 사용했는데 그것보다 scapy 가 훨씬 편해 보인다.</p><p>새 책을 사긴 그렇고 중고책을 하나 구할 까 했는데 알라딘에서 중고책 매입가가 4천원 대. 작년 초에 나온 책인데 너무 싸게 매입하는 게 아닌가</p><p>일단 책 보면서 유용하다 싶은 내용을 몇 가지 주제로 나눠 정리했다.</p><h3 id=소스-코드를-받을-수-있는-곳은>소스 코드를 받을 수 있는 곳은</h3><ul><li><a href=https://github.com/shadow-box/Violent-Python-Examples>github</a></li><li><a href=http://booksite.elsevier.com/9781597499576/chapters.php>COMPANION MATERIALS</a></li></ul><p>예제를 하나하나 보면 참 배울게 많아 보인다.</p><h3 id=semaphore>Semaphore</h3><pre><code>	screenLock = Semaphore(value = 1)
	screenLock.acquire()
	screeLock.release(()
</code></pre><h3 id=pxssh-library>pxssh library</h3><pre><code>	s = pxssh.pxssh()
	s.login(host, user, password)
	s.sendline(xxx)
	s.prompt()  
</code></pre><h2 id=scapy>scapy</h2><ul><li><p>haslayer() is powerful to check if packet has known protocol<br>from scapy.all import *</p><pre><code>  if pkt.haslayer(IP)  
  if pkt.haslayer(TCP)    
  if pkt.haslayer(ICMP)
</code></pre></li><li><p>To see the file name use scapy</p><pre><code>  $ scapy
  Welcome to Scapy  
  &gt;&gt;&gt; ls(IP)
  ...
</code></pre></li><li><p>CH4, 7-testFastFlux.py - pcap 파일을 읽어 특정 데이터를 가진 경우 확인</p><pre><code>   def handlePkt(pkt):
       if pkt.haslayer(DNSRR):
           rrname = pkt.getlayer(DNSRR).rrname
           rdata = pkt.getlayer(DNSRR).rdata 

   pkts = rdpcap('fastFlux.pcap')
   for pkt in pkts:
       handlePkt(pkt)
</code></pre></li><li><p>CH4, 6-spoofDetect.py - sniff해서 특정 데이터를 가진 패킷 확인</p><pre><code>  def testTTL(pkt):
      try:
          if pkt.haslayer(IP):
              ipsrc = pkt.getlayer(IP).src
              ttl = str(pkt.ttl)

  conf.iface = 'eth0'
  sniff(filter=&quot;tcp port 21&quot;, prn=testTTL, store=0)
  # filter is optional
</code></pre></li><li><p>Make a packet easily</p><pre><code>  IPlayer = IP(src=&quot;1.1.1.1&quot;, dst=&quot;2.2.2.2&quot;)  
  TCPlayer = TCP(sport=123, dport=456)  
  pkt = IPlayer / TCPlayer  
  send(pkt)  
</code></pre></li><li><p>or
pkt = IP(src=&ldquo;1.1.1.1&rdquo;, dst=&ldquo;2.2.2.2&rdquo;) / TCP(dport=456) / Raw(load="^\xB0\x02\x89\x06\xFE\xC8\x89F\x04\xB0\x06\x89F")
send(pkt, iface=&ldquo;eth0&rdquo;, count=10)</p><pre><code>  pkt = IP(src=&quot;1.1.1.1&quot;, dst=&quot;2.2.2.2&quot;) / TCP(dport=456) / Raw(load=&quot;Amanda&quot;)
  send(pkt, iface=&quot;eth0&quot;, count=10)  
</code></pre></li><li><p>Too see the packet has string XXX=YYY and get YYY</p><pre><code>  raw = raw.sprintf(&quot;%Raw.load%&quot;)  
  name=re.findall(&quot;(?i)XXX=(.*)&amp;&quot;, raw)
</code></pre></li><li><p>Too see the string &ldquo;Amanda&rdquo; with tcpdump, use <code>-A</code> option which means ASCII</p></li><li><p>CH5, 7-uavSniff.py - good example of using Class</p></li></ul><h2 id=dpkt-module>DPKT module</h2><h3 id=p144>p144</h3><ul><li><p>CH4, 4-googleEarthPcap.py</p></li><li><p>IP 주소를 이용해 IP의 물리적인 위치 정보를 찾고, 이를 이용해 google earth에 표시하기 위해 KML 파일 생성</p></li><li><p>dpkt를 이용한 패킷 분석</p></li><li><p>dpkt는 pip로 설치 불가</p><pre><code>  for ts, buf in pcap:  
      ethernet = dpkt.ethernet.Ethernet(buf)  
      ip = eth.data
      src = socket.ntoa(ip.src)  
</code></pre></li></ul><h3 id=p147>p147</h3><ul><li><p>dpkt을 이용한 HTTP 분석</p></li><li><p>상위 protocol header를 가리킬 때 x.data 사용</p></li><li><p>5-findDDoS.py</p><pre><code>  tcp = ip.data  
  http = dpkt.http.Request(tcp.data)  
  if http.method == 'GET':
  	uri = http.uri.lower()  
  	if '.zip' in uri:
  		print &quot;bingo&quot;  
</code></pre></li></ul><h3 id=p149>p149</h3><pre><code>    tcp = ip.data  
    sport = tcp.sport
    dport = tcp.dport  
    if '!lazor' in tcp.data.lower():
    	print &quot;bingo&quot;  
</code></pre><ul><li><p>except KeyboardInterrupt:</p><pre><code>  try:
  	foobar()
  except KeyboardInterrupt:
  	sys.exit(0)  
</code></pre></li></ul><h3 id=regular-expression>Regular Expression</h3><pre><code>    &gt;&gt;&gt; print re.findall(&quot;(?i)XXX=(.*)&quot;, &quot;!#ASFDASFASDFAS#$%$#XXX=YYY&quot;)
    ['YYY']
    &gt;&gt;&gt; print re.findall(&quot;XXX=(.*)&quot;, &quot;!#ASFDASFASDFAS#$%$#XXX=YYY&quot;)
	['YYY']

	왜 `(?i)`를 사용하는 걸까?

	&gt;&gt;&gt; re.findall(r'[0-9a-zA-Z]{3}', &quot;123 2314 13&quot;)
	['123', '231']
</code></pre><h3 id=mechanize-module>Mechanize module</h3><pre><code>    # -*- coding: utf-8 -*-
    import mechanize


    def viewPage(url):
        browser = mechanize.Browser()
        page = browser.open(url)
        source_code = page.read()
        print source_code


    viewPage('http://www.syngress.com/')
</code></pre><h3 id=twitter-api>Twitter API</h3><ul><li>CH6, 9-twitterInterests.py</li></ul><h2 id=template>Template</h2><pre><code>	#!/usr/bin/python                                                                
	# -*- coding: utf-8 -*-

	def main(): 
	    parser = optparse.OptionParser('usage %prog -i &lt;interface&gt;') 
	    parser.add_option('-i', dest='interface', type='string', help='specify interface to listen on')

	    (options, args) = parser.parse_args() 
	 
	    if options.interface == None: 
	        print parser.usage 
	        exit(0) 
	    else: 
	        conf.iface = options.interface 

	    try:
	        print '[*] Starting Credit Card Sniffer.'
	        sniff(filter='tcp', prn=findCreditCard, store=0)
	    except KeyboardInterrupt:
	        exit(0)


	if __name__ == '__main__':
	    main()
</code></pre><h2 id=templateclass>Template(Class)</h2><pre><code>	#!/usr/bin/python                                                                
	# -*- coding: utf-8 -*-

	class testThread(threading.Thread):

	    def __init__(self):
	        threading.Thread.__init__(self)

	        # add intialize variables or initialization functions

	    def run(self):
	    	# main function of this class

	def main():
	    testInstance = testThread()
	    testInstance.start()
</code></pre></content><p><a href=https://cychong47.github.io/tags/python/>#Python</a>
<a href=https://cychong47.github.io/tags/dpkt/>#Dpkt</a>
<a href=https://cychong47.github.io/tags/scapy/>#Scapy</a>
<a href=https://cychong47.github.io/tags/book/>#Book</a></p></main><footer>Made with <a href=https://github.com/janraasch/hugo-bearblog/>Hugo ʕ•ᴥ•ʔ Bear</a></footer></body></html>