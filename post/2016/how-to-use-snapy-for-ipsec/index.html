<!doctype html><html lang=en-us><head><meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>how to build IPsec packet with scapy | Keep calm and Write something</title><meta name=title content="how to build IPsec packet with scapy"><meta name=description content="import modules
$ python
>>> from scapy.all import *
>>> from scapy.layers.ipsec import *
build plaintext packet
>>> p = IP(src='1.1.1.1', dst='2.2.2.2') / TCP(sport=45012, dport=80) / Raw('testdata') 
>>> p = IP(str(p))
setup SA
>>> sa = SecurityAssociation(ESP, spi=0xdeadbeef, crypt_algo='AES-CBC',crypt_key='sixteenbytes key')
Encrypt w/o IV
>>> e = sa.encrypt(p, 5)
>>> e
<IP  version=4L ihl=5L tos=0x0 len=76 id=1 flags= frag=0L ttl=64 proto=esp chksum=0x747a src=1.1.1.1 dst=2.2.2.2 |<ESP  spi=0xdeadbeef seq=5 data='uD\x7fdj19\xe7\xc4\xff8\x10\xcdQ\xf0\xa6\x1e!\x84\xc3>!\x18\xa6\xf6\xb8\x93\xc6it\x9a\xfc\x1c\xee\xe5C\xcd\xf0\x7fD\xca\x8d\xadKh\xa8\xe5x' |>>
>>> e.show()
###[ IP ]###
  version   = 4L
  ihl       = 5L
  tos       = 0x0
  len       = 76
  id        = 1
  flags     = 
  frag      = 0L
  ttl       = 64
  proto     = esp
  chksum    = 0x747a
  src       = 1.1.1.1
  dst       = 2.2.2.2
  \options   \
###[ ESP ]###
     spi       = 0xdeadbeef
     seq       = 5
     data      = 'uD\x7fdj19\xe7\xc4\xff8\x10\xcdQ\xf0\xa6\x1e!\x84\xc3>!\x18\xa6\xf6\xb8\x93\xc6it\x9a\xfc\x1c\xee\xe5C\xcd\xf0\x7fD\xca\x8d\xadKh\xa8\xe5x'
Encrypt w/ IV
>>> e = sa.encrypt(p, 5, &#34;1234567890123456&#34;)
>>> e
<IP  version=4L ihl=5L tos=0x0 len=76 id=1 flags= frag=0L ttl=64 proto=esp chksum=0x747a src=1.1.1.1 dst=2.2.2.2 |<ESP  spi=0xdeadbeef seq=5 data='1234567890123456\xa4\x0b\xebZ\xa7\xc8\xb6\x95\xfb\x13\x07\xc5TD\xa2\xe7DP\xfcP\xa5y\xc4\x06W\xe8\xf5\xf0\x86\xe1\x0c\xfd' |>>
>>> e.show()
###[ IP ]###
  version   = 4L
  ihl       = 5L
  tos       = 0x0
  len       = 76
  id        = 1
  flags     = 
  frag      = 0L
  ttl       = 64
  proto     = esp
  chksum    = 0x747a
  src       = 1.1.1.1
  dst       = 2.2.2.2
  \options   \
###[ ESP ]###
     spi       = 0xdeadbeef
     seq       = 5
     data      = '1234567890123456\xa4\x0b\xebZ\xa7\xc8\xb6\x95\xfb\x13\x07\xc5TD\xa2\xe7DP\xfcP\xa5y\xc4\x06W\xe8\xf5\xf0\x86\xe1\x0c\xfd'
data 의 시작 부분에  IV값 &lsquo;1234567890123456&rsquo;이 있음을 알 수 있다.
ESP는 SPI(4B), SEQ(4B), IV(16B) , Encrypted Data 형태로 구성된다."><meta name=keywords content="Python,scapy,IPsec,공부,"><meta property="og:url" content="https://cychong47.github.io/post/2016/how-to-use-snapy-for-ipsec/"><meta property="og:site_name" content="Keep calm and Write something"><meta property="og:title" content="how to build IPsec packet with scapy"><meta property="og:description" content="import modules $ python >>> from scapy.all import * >>> from scapy.layers.ipsec import * build plaintext packet >>> p = IP(src='1.1.1.1', dst='2.2.2.2') / TCP(sport=45012, dport=80) / Raw('testdata') >>> p = IP(str(p)) setup SA >>> sa = SecurityAssociation(ESP, spi=0xdeadbeef, crypt_algo='AES-CBC',crypt_key='sixteenbytes key') Encrypt w/o IV >>> e = sa.encrypt(p, 5) >>> e <IP version=4L ihl=5L tos=0x0 len=76 id=1 flags= frag=0L ttl=64 proto=esp chksum=0x747a src=1.1.1.1 dst=2.2.2.2 |<ESP spi=0xdeadbeef seq=5 data='uD\x7fdj19\xe7\xc4\xff8\x10\xcdQ\xf0\xa6\x1e!\x84\xc3>!\x18\xa6\xf6\xb8\x93\xc6it\x9a\xfc\x1c\xee\xe5C\xcd\xf0\x7fD\xca\x8d\xadKh\xa8\xe5x' |>> >>> e.show() ###[ IP ]### version = 4L ihl = 5L tos = 0x0 len = 76 id = 1 flags = frag = 0L ttl = 64 proto = esp chksum = 0x747a src = 1.1.1.1 dst = 2.2.2.2 \options \ ###[ ESP ]### spi = 0xdeadbeef seq = 5 data = 'uD\x7fdj19\xe7\xc4\xff8\x10\xcdQ\xf0\xa6\x1e!\x84\xc3>!\x18\xa6\xf6\xb8\x93\xc6it\x9a\xfc\x1c\xee\xe5C\xcd\xf0\x7fD\xca\x8d\xadKh\xa8\xe5x' Encrypt w/ IV >>> e = sa.encrypt(p, 5, &#34;1234567890123456&#34;) >>> e <IP version=4L ihl=5L tos=0x0 len=76 id=1 flags= frag=0L ttl=64 proto=esp chksum=0x747a src=1.1.1.1 dst=2.2.2.2 |<ESP spi=0xdeadbeef seq=5 data='1234567890123456\xa4\x0b\xebZ\xa7\xc8\xb6\x95\xfb\x13\x07\xc5TD\xa2\xe7DP\xfcP\xa5y\xc4\x06W\xe8\xf5\xf0\x86\xe1\x0c\xfd' |>> >>> e.show() ###[ IP ]### version = 4L ihl = 5L tos = 0x0 len = 76 id = 1 flags = frag = 0L ttl = 64 proto = esp chksum = 0x747a src = 1.1.1.1 dst = 2.2.2.2 \options \ ###[ ESP ]### spi = 0xdeadbeef seq = 5 data = '1234567890123456\xa4\x0b\xebZ\xa7\xc8\xb6\x95\xfb\x13\x07\xc5TD\xa2\xe7DP\xfcP\xa5y\xc4\x06W\xe8\xf5\xf0\x86\xe1\x0c\xfd' data 의 시작 부분에 IV값 ‘1234567890123456’이 있음을 알 수 있다. ESP는 SPI(4B), SEQ(4B), IV(16B) , Encrypted Data 형태로 구성된다."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2016-02-14T14:59:42+09:00"><meta property="article:modified_time" content="2018-04-01T02:38:40+00:00"><meta property="article:tag" content="Python"><meta property="article:tag" content="Scapy"><meta property="article:tag" content="IPsec"><meta property="article:tag" content="공부"><meta name=twitter:card content="summary"><meta name=twitter:title content="how to build IPsec packet with scapy"><meta name=twitter:description content="import modules $ python >>> from scapy.all import * >>> from scapy.layers.ipsec import * build plaintext packet >>> p = IP(src='1.1.1.1', dst='2.2.2.2') / TCP(sport=45012, dport=80) / Raw('testdata') >>> p = IP(str(p)) setup SA >>> sa = SecurityAssociation(ESP, spi=0xdeadbeef, crypt_algo='AES-CBC',crypt_key='sixteenbytes key') Encrypt w/o IV >>> e = sa.encrypt(p, 5) >>> e <IP version=4L ihl=5L tos=0x0 len=76 id=1 flags= frag=0L ttl=64 proto=esp chksum=0x747a src=1.1.1.1 dst=2.2.2.2 |<ESP spi=0xdeadbeef seq=5 data='uD\x7fdj19\xe7\xc4\xff8\x10\xcdQ\xf0\xa6\x1e!\x84\xc3>!\x18\xa6\xf6\xb8\x93\xc6it\x9a\xfc\x1c\xee\xe5C\xcd\xf0\x7fD\xca\x8d\xadKh\xa8\xe5x' |>> >>> e.show() ###[ IP ]### version = 4L ihl = 5L tos = 0x0 len = 76 id = 1 flags = frag = 0L ttl = 64 proto = esp chksum = 0x747a src = 1.1.1.1 dst = 2.2.2.2 \options \ ###[ ESP ]### spi = 0xdeadbeef seq = 5 data = 'uD\x7fdj19\xe7\xc4\xff8\x10\xcdQ\xf0\xa6\x1e!\x84\xc3>!\x18\xa6\xf6\xb8\x93\xc6it\x9a\xfc\x1c\xee\xe5C\xcd\xf0\x7fD\xca\x8d\xadKh\xa8\xe5x' Encrypt w/ IV >>> e = sa.encrypt(p, 5, &#34;1234567890123456&#34;) >>> e <IP version=4L ihl=5L tos=0x0 len=76 id=1 flags= frag=0L ttl=64 proto=esp chksum=0x747a src=1.1.1.1 dst=2.2.2.2 |<ESP spi=0xdeadbeef seq=5 data='1234567890123456\xa4\x0b\xebZ\xa7\xc8\xb6\x95\xfb\x13\x07\xc5TD\xa2\xe7DP\xfcP\xa5y\xc4\x06W\xe8\xf5\xf0\x86\xe1\x0c\xfd' |>> >>> e.show() ###[ IP ]### version = 4L ihl = 5L tos = 0x0 len = 76 id = 1 flags = frag = 0L ttl = 64 proto = esp chksum = 0x747a src = 1.1.1.1 dst = 2.2.2.2 \options \ ###[ ESP ]### spi = 0xdeadbeef seq = 5 data = '1234567890123456\xa4\x0b\xebZ\xa7\xc8\xb6\x95\xfb\x13\x07\xc5TD\xa2\xe7DP\xfcP\xa5y\xc4\x06W\xe8\xf5\xf0\x86\xe1\x0c\xfd' data 의 시작 부분에 IV값 ‘1234567890123456’이 있음을 알 수 있다. ESP는 SPI(4B), SEQ(4B), IV(16B) , Encrypted Data 형태로 구성된다."><meta itemprop=name content="how to build IPsec packet with scapy"><meta itemprop=description content="import modules $ python >>> from scapy.all import * >>> from scapy.layers.ipsec import * build plaintext packet >>> p = IP(src='1.1.1.1', dst='2.2.2.2') / TCP(sport=45012, dport=80) / Raw('testdata') >>> p = IP(str(p)) setup SA >>> sa = SecurityAssociation(ESP, spi=0xdeadbeef, crypt_algo='AES-CBC',crypt_key='sixteenbytes key') Encrypt w/o IV >>> e = sa.encrypt(p, 5) >>> e <IP version=4L ihl=5L tos=0x0 len=76 id=1 flags= frag=0L ttl=64 proto=esp chksum=0x747a src=1.1.1.1 dst=2.2.2.2 |<ESP spi=0xdeadbeef seq=5 data='uD\x7fdj19\xe7\xc4\xff8\x10\xcdQ\xf0\xa6\x1e!\x84\xc3>!\x18\xa6\xf6\xb8\x93\xc6it\x9a\xfc\x1c\xee\xe5C\xcd\xf0\x7fD\xca\x8d\xadKh\xa8\xe5x' |>> >>> e.show() ###[ IP ]### version = 4L ihl = 5L tos = 0x0 len = 76 id = 1 flags = frag = 0L ttl = 64 proto = esp chksum = 0x747a src = 1.1.1.1 dst = 2.2.2.2 \options \ ###[ ESP ]### spi = 0xdeadbeef seq = 5 data = 'uD\x7fdj19\xe7\xc4\xff8\x10\xcdQ\xf0\xa6\x1e!\x84\xc3>!\x18\xa6\xf6\xb8\x93\xc6it\x9a\xfc\x1c\xee\xe5C\xcd\xf0\x7fD\xca\x8d\xadKh\xa8\xe5x' Encrypt w/ IV >>> e = sa.encrypt(p, 5, &#34;1234567890123456&#34;) >>> e <IP version=4L ihl=5L tos=0x0 len=76 id=1 flags= frag=0L ttl=64 proto=esp chksum=0x747a src=1.1.1.1 dst=2.2.2.2 |<ESP spi=0xdeadbeef seq=5 data='1234567890123456\xa4\x0b\xebZ\xa7\xc8\xb6\x95\xfb\x13\x07\xc5TD\xa2\xe7DP\xfcP\xa5y\xc4\x06W\xe8\xf5\xf0\x86\xe1\x0c\xfd' |>> >>> e.show() ###[ IP ]### version = 4L ihl = 5L tos = 0x0 len = 76 id = 1 flags = frag = 0L ttl = 64 proto = esp chksum = 0x747a src = 1.1.1.1 dst = 2.2.2.2 \options \ ###[ ESP ]### spi = 0xdeadbeef seq = 5 data = '1234567890123456\xa4\x0b\xebZ\xa7\xc8\xb6\x95\xfb\x13\x07\xc5TD\xa2\xe7DP\xfcP\xa5y\xc4\x06W\xe8\xf5\xf0\x86\xe1\x0c\xfd' data 의 시작 부분에 IV값 ‘1234567890123456’이 있음을 알 수 있다. ESP는 SPI(4B), SEQ(4B), IV(16B) , Encrypted Data 형태로 구성된다."><meta itemprop=datePublished content="2016-02-14T14:59:42+09:00"><meta itemprop=dateModified content="2018-04-01T02:38:40+00:00"><meta itemprop=wordCount content="577"><meta itemprop=keywords content="Python,Scapy,IPsec,공부"><meta name=referrer content="no-referrer-when-downgrade"><style>:root{--width:720px;--font-main:Verdana, sans-serif;--font-secondary:Verdana, sans-serif;--font-scale:1em;--background-color:#fafafa;--heading-color:#222;--text-color:#444;--link-color:#3273dc;--visited-color:#8b6fcb;--blockquote-color:#222}@media(prefers-color-scheme:dark){:root{--background-color:#fafafa;--heading-color:#222;--text-color:#444;--link-color:#3273dc;--visited-color:#8b6fcb;--blockquote-color:#222}}body{font-family:var(--font-secondary);font-size:var(--font-scale);margin:auto;padding:20px;max-width:var(--width);text-align:left;background-color:var(--background-color);word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:var(--text-color)}h1,h2,h3,h4,h5,h6{font-family:var(--font-main);color:var(--heading-color)}a{color:var(--link-color);cursor:pointer;text-decoration:none}a:hover{text-decoration:underline}nav a{margin-right:8px}strong,b{color:var(--heading-color)}button{margin:0;cursor:pointer}time{font-family:monospace;font-style:normal;font-size:15px}main{line-height:1.6}table{width:100%}hr{border:0;border-top:1px dashed}img{max-width:100%}code{font-family:monospace;padding:2px;border-radius:3px}blockquote{border-left:1px solid #999;color:var(--blockquote-color);padding-left:20px;font-style:italic}footer{padding:25px 0;text-align:center}.title:hover{text-decoration:none}.title h1{font-size:1.5em}.inline{width:auto!important}.highlight,.code{border-radius:3px;margin-block-start:1em;margin-block-end:1em;overflow-x:auto}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:var(--visited-color)}</style></head><body><header><a href=/ class=title><h2>Keep calm and Write something</h2></a><nav><a href=/post/>Post</a>
<a href=/page/>Page</a>
<a href=/series/>Series</a>
<a href=/tags/>Tag</a>
<a href=/archive/>Archive</a>
<a href=/search/>Search</a></nav></header><main><content><h2 id=import-modules>import modules</h2><pre tabindex=0><code>$ python
&gt;&gt;&gt; from scapy.all import *
&gt;&gt;&gt; from scapy.layers.ipsec import *
</code></pre><h2 id=build-plaintext-packet>build plaintext packet</h2><pre tabindex=0><code>&gt;&gt;&gt; p = IP(src=&#39;1.1.1.1&#39;, dst=&#39;2.2.2.2&#39;) / TCP(sport=45012, dport=80) / Raw(&#39;testdata&#39;) 
&gt;&gt;&gt; p = IP(str(p))
</code></pre><h2 id=setup-sa>setup SA</h2><pre tabindex=0><code>&gt;&gt;&gt; sa = SecurityAssociation(ESP, spi=0xdeadbeef, crypt_algo=&#39;AES-CBC&#39;,crypt_key=&#39;sixteenbytes key&#39;)
</code></pre><h2 id=encrypt-wo-iv>Encrypt w/o IV</h2><pre tabindex=0><code>&gt;&gt;&gt; e = sa.encrypt(p, 5)
&gt;&gt;&gt; e
&lt;IP  version=4L ihl=5L tos=0x0 len=76 id=1 flags= frag=0L ttl=64 proto=esp chksum=0x747a src=1.1.1.1 dst=2.2.2.2 |&lt;ESP  spi=0xdeadbeef seq=5 data=&#39;uD\x7fdj19\xe7\xc4\xff8\x10\xcdQ\xf0\xa6\x1e!\x84\xc3&gt;!\x18\xa6\xf6\xb8\x93\xc6it\x9a\xfc\x1c\xee\xe5C\xcd\xf0\x7fD\xca\x8d\xadKh\xa8\xe5x&#39; |&gt;&gt;
&gt;&gt;&gt; e.show()
###[ IP ]###
  version   = 4L
  ihl       = 5L
  tos       = 0x0
  len       = 76
  id        = 1
  flags     = 
  frag      = 0L
  ttl       = 64
  proto     = esp
  chksum    = 0x747a
  src       = 1.1.1.1
  dst       = 2.2.2.2
  \options   \
###[ ESP ]###
     spi       = 0xdeadbeef
     seq       = 5
     data      = &#39;uD\x7fdj19\xe7\xc4\xff8\x10\xcdQ\xf0\xa6\x1e!\x84\xc3&gt;!\x18\xa6\xf6\xb8\x93\xc6it\x9a\xfc\x1c\xee\xe5C\xcd\xf0\x7fD\xca\x8d\xadKh\xa8\xe5x&#39;
</code></pre><h2 id=encrypt-w-iv>Encrypt w/ IV</h2><pre tabindex=0><code>&gt;&gt;&gt; e = sa.encrypt(p, 5, &#34;1234567890123456&#34;)
&gt;&gt;&gt; e
&lt;IP  version=4L ihl=5L tos=0x0 len=76 id=1 flags= frag=0L ttl=64 proto=esp chksum=0x747a src=1.1.1.1 dst=2.2.2.2 |&lt;ESP  spi=0xdeadbeef seq=5 data=&#39;1234567890123456\xa4\x0b\xebZ\xa7\xc8\xb6\x95\xfb\x13\x07\xc5TD\xa2\xe7DP\xfcP\xa5y\xc4\x06W\xe8\xf5\xf0\x86\xe1\x0c\xfd&#39; |&gt;&gt;
&gt;&gt;&gt; e.show()
###[ IP ]###
  version   = 4L
  ihl       = 5L
  tos       = 0x0
  len       = 76
  id        = 1
  flags     = 
  frag      = 0L
  ttl       = 64
  proto     = esp
  chksum    = 0x747a
  src       = 1.1.1.1
  dst       = 2.2.2.2
  \options   \
###[ ESP ]###
     spi       = 0xdeadbeef
     seq       = 5
     data      = &#39;1234567890123456\xa4\x0b\xebZ\xa7\xc8\xb6\x95\xfb\x13\x07\xc5TD\xa2\xe7DP\xfcP\xa5y\xc4\x06W\xe8\xf5\xf0\x86\xe1\x0c\xfd&#39;
</code></pre><p>data 의 시작 부분에 IV값 &lsquo;1234567890123456&rsquo;이 있음을 알 수 있다.
ESP는 SPI(4B), SEQ(4B), IV(16B) , Encrypted Data 형태로 구성된다.</p><p>만일 IV값의 길이가 틀리면 다음와 같이 에러 출력</p><pre tabindex=0><code>&gt;&gt;&gt; e = sa.encrypt(p, 5, &#34;1234567890&#34;)
Traceback (most recent call last):
  File &#34;&lt;stdin&gt;&#34;, line 1, in &lt;module&gt;
  File &#34;ipsec.py&#34;, line 903, in encrypt
    return self._encrypt_esp(pkt, seq_num=seq_num, iv=iv)
  File &#34;ipsec.py&#34;, line 787, in _encrypt_esp
    raise TypeError(&#39;iv length must be %s&#39; % self.crypt_algo.iv_size)
TypeError: iv length must be 16
</code></pre><h2 id=securityassocaition-옵션>SecurityAssocaition 옵션</h2><h3 id=1-tunnel_header>1. <code>tunnel_header</code></h3><p>Tunnel mode를 사용하려면 tunnel_header 인자로 outer IP header instance를 넘긴다.</p><pre tabindex=0><code>&gt;&gt;&gt; outer_ip = IP(src=&#39;10.10.10.10&#39;, dst=&#39;20.20.20.20&#39;)
&gt;&gt;&gt; sa = SecurityAssociation(ESP, spi=0xdeadbeef, crypt_algo=&#39;AES-CBC&#39;,crypt_key=&#39;sixteenbytes key&#39;, tunnel_header=outer_ip)
&gt;&gt;&gt; e = sa.encrypt(p, 5, &#34;1234567890123456&#34;)
&gt;&gt;&gt; e 
&lt;IP  version=4L ihl=5L tos=0x0 len=108 id=1 flags= frag=0L ttl=64 proto=esp chksum=0x3e24 src=10.10.10.10 dst=20.20.20.20 |&lt;ESP  spi=0xdeadbeef seq=5 data=&#39;1234567890123456`\xc6\xa9\xe9Q\x97-\xd6\xe5\x07\xb3\x85\xfb\xc9\xeaz\x07~\xfe\x14\xd1\x19\xd8F\x8cS\x10[\x8f\xfe\x93_ut\xef1\xc0\xc4|\xdb\xccH\xea\xf8\xd2\xd0jj\xeeD\x88\x80\xc5}U\xb5_x)\xaal/,\x96&#39; |&gt;&gt;
&gt;&gt;&gt; e.show()
###[ IP ]###
  version   = 4L
  ihl       = 5L
  tos       = 0x0
  len       = 108
  id        = 1
  flags     = 
  frag      = 0L
  ttl       = 64
  proto     = esp
  chksum    = 0x3e24
  src       = 10.10.10.10
  dst       = 20.20.20.20
  \options   \
###[ ESP ]###
     spi       = 0xdeadbeef
     seq       = 5
     data      = &#39;1234567890123456`\xc6\xa9\xe9Q\x97-\xd6\xe5\x07\xb3\x85\xfb\xc9\xeaz\x07~\xfe\x14\xd1\x19\xd8F\x8cS\x10[\x8f\xfe\x93_ut\xef1\xc0\xc4|\xdb\xccH\xea\xf8\xd2\xd0jj\xeeD\x88\x80\xc5}U\xb5_x)\xaal/,\x96&#39;   
</code></pre><p>Tunnel mode를 사용하지 않은 경우와 별반 차이가 없어 보이지만, IP의 total length값이 기존 76바이에서 108바이트로 변경되었고, ESP data값도 달라졌다.
Tunnel mode의 경우 ESP data에 원본 패킷 전체가 포함되는 반면 Transport mode이 경우 L4 layer이상만 포함되므로 값이 달라진다.
IP total length의 경우 32바이트가 차이나는데 20 + 12 ???? FIMXE</p><h3 id=2-nat_t_header>2. <code>nat_t_header</code></h3><p>NAT traversal을 위해는 UDP encapsulation을 이용하는데 이 역시 SA 를 생성할 때 지정할 수 있다.
IP total length의 경우 추가된 8byte의 UDP header가 고려되어 108byte에서 116byte로 커졌다.</p><pre tabindex=0><code>&gt;&gt;&gt; nat_t_udp = UDP(dport=4500)            
&gt;&gt;&gt; sa = SecurityAssociation(ESP, spi=0xdeadbeef, crypt_algo=&#39;AES-CBC&#39;,crypt_key=&#39;sixteenbytes key&#39;, tunnel_header=outer_ip, nat_t_header=nat_t_udp)
&gt;&gt;&gt; e = sa.encrypt(p, 5, &#34;1234567890123456&#34;)
&gt;&gt;&gt; e
&lt;IP  version=4L ihl=5L tos=0x0 len=116 id=1 flags= frag=0L ttl=64 proto=udp chksum=0x3e3d src=10.10.10.10 dst=20.20.20.20 options=[] |&lt;UDP  sport=domain dport=ipsec_nat_t len=8 chksum=0x0 |&lt;ESP  spi=0xdeadbeef seq=5 data=&#39;1234567890123456`\xc6\xa9\xe9Q\x97-\xd6\xe5\x07\xb3\x85\xfb\xc9\xeaz\x07~\xfe\x14\xd1\x19\xd8F\x8cS\x10[\x8f\xfe\x93_ut\xef1\xc0\xc4|\xdb\xccH\xea\xf8\xd2\xd0jj\xeeD\x88\x80\xc5}U\xb5_x)\xaal/,\x96&#39; |&gt;&gt;&gt;
&gt;&gt;&gt; e.show()
###[ IP ]###
  version   = 4L
  ihl       = 5L
  tos       = 0x0
  len       = 116
  id        = 1
  flags     = 
  frag      = 0L
  ttl       = 64
  proto     = udp
  chksum    = 0x3e3d
  src       = 10.10.10.10
  dst       = 20.20.20.20
  \options   \
###[ UDP ]###
     sport     = domain
     dport     = ipsec_nat_t
     len       = 8
     chksum    = 0x0
###[ ESP ]###
        spi       = 0xdeadbeef
        seq       = 5
        data      = &#39;1234567890123456`\xc6\xa9\xe9Q\x97-\xd6\xe5\x07\xb3\x85\xfb\xc9\xeaz\x07~\xfe\x14\xd1\x19\xd8F\x8cS\x10[\x8f\xfe\x93_ut\xef1\xc0\xc4|\xdb\xccH\xea\xf8\xd2\xd0jj\xeeD\x88\x80\xc5}U\xb5_x)\xaal/,\x96&#39;
</code></pre></content><p><a href=https://cychong47.github.io/tags/python/>#Python</a>
<a href=https://cychong47.github.io/tags/scapy/>#Scapy</a>
<a href=https://cychong47.github.io/tags/ipsec/>#IPsec</a>
<a href=https://cychong47.github.io/tags/%EA%B3%B5%EB%B6%80/>#공부</a></p></main><footer>Made with <a href=https://github.com/janraasch/hugo-bearblog/>Hugo ʕ•ᴥ•ʔ Bear</a></footer></body></html>