<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Scapy on Keep calm and Write something</title><link>https://cychong47.github.io/tags/scapy/</link><description>Recent content in Scapy on Keep calm and Write something</description><generator>Hugo</generator><language>en-us</language><lastBuildDate>Sun, 19 Aug 2018 22:06:31 +0000</lastBuildDate><atom:link href="https://cychong47.github.io/tags/scapy/index.xml" rel="self" type="application/rss+xml"/><item><title>Parsing http header with scary</title><link>https://cychong47.github.io/post/2017/parsing-http-header-with-scary/</link><pubDate>Sun, 01 Oct 2017 09:36:35 +0900</pubDate><guid>https://cychong47.github.io/post/2017/parsing-http-header-with-scary/</guid><description>&lt;h3 id="정규식으로-http-분석"&gt;정규식으로 http 분석&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;def processHTTP(data):

 str_method = &amp;quot;&amp;quot;
 str_uri = &amp;quot;&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id="정규표현식을-통해-넘어온-데이터에서-method-uri-http-버전-정보등으로-구분함"&gt;정규표현식을 통해 넘어온 데이터에서 METHOD, URI, HTTP 버전 정보등으로 구분함&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;h = re.search(&amp;quot;(?P&amp;lt;method&amp;gt;(^GET|^POST|^PUT|^DELETE)) (?P&amp;lt;uri&amp;gt;.+) (?P&amp;lt;version&amp;gt;.+)&amp;quot;, data)
if not h: return &amp;quot;Error&amp;quot; # 정규표현식에 해당하는 데이터가 없는 경우 Error 를 리턴해줌

# method 로 정의된 부준은 str_method 에 저장
if h.group(&amp;quot;method&amp;quot;): str_method = h.group(&amp;quot;method&amp;quot;)
# URI 데이터는 str_uri 에 저장
if h.group(&amp;quot;uri&amp;quot;): str_uri = h.group(&amp;quot;uri&amp;quot;)

return str_method,str_uri # method 와 uri 를 리턴해 줌
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;출처 : &lt;a href="http://www.packetinside.com/2010/11/scapy-"&gt;http://www.packetinside.com/2010/11/scapy-&lt;/a&gt;로-패킷-핸들링하는-프로그램-만들기-세번째.html?showComment=1423994884595&lt;/p&gt;</description></item><item><title>(Scapy) Suppress Scapy warning message</title><link>https://cychong47.github.io/post/2016/scapy-suppress-scapy-warning-message/</link><pubDate>Thu, 03 Mar 2016 14:50:24 +0900</pubDate><guid>https://cychong47.github.io/post/2016/scapy-suppress-scapy-warning-message/</guid><description>&lt;h1 id="without-suppressing-scapy-ipv6-warning"&gt;Without Suppressing Scapy IPv6 warning&lt;/h1&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;cychong@ubuntu:~$ python
Python 2.7.6 (default, Jun 22 2015, 17:58:13)
[GCC 4.8.2] on linux2
Type &amp;#34;help&amp;#34;, &amp;#34;copyright&amp;#34;, &amp;#34;credits&amp;#34; or &amp;#34;license&amp;#34; for more information.
&amp;gt;&amp;gt;&amp;gt; from scapy.all import *
WARNING: No route found for IPv6 destination :: (no default route?)
&amp;gt;&amp;gt;&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id="suppress-scapy-ipv6-warning"&gt;Suppress scapy IPv6 warning&lt;/h1&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;cychong@ubuntu:~$ python
Python 2.7.6 (default, Jun 22 2015, 17:58:13)
[GCC 4.8.2] on linux2
Type &amp;#34;help&amp;#34;, &amp;#34;copyright&amp;#34;, &amp;#34;credits&amp;#34; or &amp;#34;license&amp;#34; for more information.
&amp;gt;&amp;gt;&amp;gt; import logging
&amp;gt;&amp;gt;&amp;gt; logging.getLogger(&amp;#34;scapy.runtime&amp;#34;).setLevel(logging.ERROR)
&amp;gt;&amp;gt;&amp;gt; from scapy.all import *
&amp;gt;&amp;gt;&amp;gt;
&lt;/code&gt;&lt;/pre&gt;</description></item><item><title>how to build IPsec packet with scapy</title><link>https://cychong47.github.io/post/2016/how-to-use-snapy-for-ipsec/</link><pubDate>Sun, 14 Feb 2016 14:59:42 +0900</pubDate><guid>https://cychong47.github.io/post/2016/how-to-use-snapy-for-ipsec/</guid><description>&lt;h2 id="import-modules"&gt;import modules&lt;/h2&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;$ python
&amp;gt;&amp;gt;&amp;gt; from scapy.all import *
&amp;gt;&amp;gt;&amp;gt; from scapy.layers.ipsec import *
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id="build-plaintext-packet"&gt;build plaintext packet&lt;/h2&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; p = IP(src=&amp;#39;1.1.1.1&amp;#39;, dst=&amp;#39;2.2.2.2&amp;#39;) / TCP(sport=45012, dport=80) / Raw(&amp;#39;testdata&amp;#39;) 
&amp;gt;&amp;gt;&amp;gt; p = IP(str(p))
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id="setup-sa"&gt;setup SA&lt;/h2&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; sa = SecurityAssociation(ESP, spi=0xdeadbeef, crypt_algo=&amp;#39;AES-CBC&amp;#39;,crypt_key=&amp;#39;sixteenbytes key&amp;#39;)
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id="encrypt-wo-iv"&gt;Encrypt w/o IV&lt;/h2&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; e = sa.encrypt(p, 5)
&amp;gt;&amp;gt;&amp;gt; e
&amp;lt;IP version=4L ihl=5L tos=0x0 len=76 id=1 flags= frag=0L ttl=64 proto=esp chksum=0x747a src=1.1.1.1 dst=2.2.2.2 |&amp;lt;ESP spi=0xdeadbeef seq=5 data=&amp;#39;uD\x7fdj19\xe7\xc4\xff8\x10\xcdQ\xf0\xa6\x1e!\x84\xc3&amp;gt;!\x18\xa6\xf6\xb8\x93\xc6it\x9a\xfc\x1c\xee\xe5C\xcd\xf0\x7fD\xca\x8d\xadKh\xa8\xe5x&amp;#39; |&amp;gt;&amp;gt;
&amp;gt;&amp;gt;&amp;gt; e.show()
###[ IP ]###
 version = 4L
 ihl = 5L
 tos = 0x0
 len = 76
 id = 1
 flags = 
 frag = 0L
 ttl = 64
 proto = esp
 chksum = 0x747a
 src = 1.1.1.1
 dst = 2.2.2.2
 \options \
###[ ESP ]###
 spi = 0xdeadbeef
 seq = 5
 data = &amp;#39;uD\x7fdj19\xe7\xc4\xff8\x10\xcdQ\xf0\xa6\x1e!\x84\xc3&amp;gt;!\x18\xa6\xf6\xb8\x93\xc6it\x9a\xfc\x1c\xee\xe5C\xcd\xf0\x7fD\xca\x8d\xadKh\xa8\xe5x&amp;#39;
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id="encrypt-w-iv"&gt;Encrypt w/ IV&lt;/h2&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; e = sa.encrypt(p, 5, &amp;#34;1234567890123456&amp;#34;)
&amp;gt;&amp;gt;&amp;gt; e
&amp;lt;IP version=4L ihl=5L tos=0x0 len=76 id=1 flags= frag=0L ttl=64 proto=esp chksum=0x747a src=1.1.1.1 dst=2.2.2.2 |&amp;lt;ESP spi=0xdeadbeef seq=5 data=&amp;#39;1234567890123456\xa4\x0b\xebZ\xa7\xc8\xb6\x95\xfb\x13\x07\xc5TD\xa2\xe7DP\xfcP\xa5y\xc4\x06W\xe8\xf5\xf0\x86\xe1\x0c\xfd&amp;#39; |&amp;gt;&amp;gt;
&amp;gt;&amp;gt;&amp;gt; e.show()
###[ IP ]###
 version = 4L
 ihl = 5L
 tos = 0x0
 len = 76
 id = 1
 flags = 
 frag = 0L
 ttl = 64
 proto = esp
 chksum = 0x747a
 src = 1.1.1.1
 dst = 2.2.2.2
 \options \
###[ ESP ]###
 spi = 0xdeadbeef
 seq = 5
 data = &amp;#39;1234567890123456\xa4\x0b\xebZ\xa7\xc8\xb6\x95\xfb\x13\x07\xc5TD\xa2\xe7DP\xfcP\xa5y\xc4\x06W\xe8\xf5\xf0\x86\xe1\x0c\xfd&amp;#39;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;data 의 시작 부분에 IV값 &amp;lsquo;1234567890123456&amp;rsquo;이 있음을 알 수 있다.
ESP는 SPI(4B), SEQ(4B), IV(16B) , Encrypted Data 형태로 구성된다.&lt;/p&gt;</description></item><item><title>fragment missing test with scapy</title><link>https://cychong47.github.io/post/2016/fragment-missing-test-with-scapy/</link><pubDate>Sun, 14 Feb 2016 13:57:41 +0900</pubDate><guid>https://cychong47.github.io/post/2016/fragment-missing-test-with-scapy/</guid><description>&lt;p&gt;다음과 같이 scapy를 이용해서 fragment를 쉽게 만들 수 있다.&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;from scapy.all import *

dip=&amp;#34;10.0.0.1&amp;#34;
payload=&amp;#34; &amp;#34;*1000

packet=IP(dst=dip)/UDP(dport=0x1234)/payload
 
frag_list=fragment(packet,fragsize=500)
 
counter=1
for fragment in frag_list:
 print &amp;#34;Packet no%d&amp;#34; %counter
 print 

 fragment.show()
 counter+=1
 send(fragment)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;frag_list에서 counter 변수를 확인해서 전송하지 않으면 간단하게 fragment가 수신되지 않은 경우에 시험할 수 있음.&lt;/p&gt;
&lt;p&gt;필요하면 frag_list의 순서를 뒤집는 것도 가능하고, 각 fragment의 offset값을 조정하거나 패킷 크기를 변경하면 다른 비정상 경우도 쉽게 시험할 수 있다.&lt;/p&gt;
&lt;p&gt;&lt;a href="http://www.secdev.org/projects/scapy/doc/usage.html#interactive-tutorial"&gt;scapy interactive tutorial&lt;/a&gt;&lt;/p&gt;</description></item><item><title>(책) Violent Python</title><link>https://cychong47.github.io/post/2014/caeg-violent-python/</link><pubDate>Sat, 27 Sep 2014 16:43:27 +0900</pubDate><guid>https://cychong47.github.io/post/2014/caeg-violent-python/</guid><description>&lt;p&gt;오래만에 재밌는 책을 봤다.&lt;/p&gt;
&lt;p&gt;해커를 위한 책이라고 하지만, 해킹에 관한 기법보다는 network application을 작성하는데 유용한 scapy, dpkt 그리고 정규식에 대한 설명이 유용하다.
마침 요 근래 업무용으로 Python을 이용해서 패킷 만들고, 송/수신하는 유틸리티를 만들고 있어 Impacket 모듈을 많이 사용했는데 그것보다 scapy 가 훨씬 편해 보인다.&lt;/p&gt;
&lt;p&gt;새 책을 사긴 그렇고 중고책을 하나 구할 까 했는데 알라딘에서 중고책 매입가가 4천원 대. 작년 초에 나온 책인데 너무 싸게 매입하는 게 아닌가&lt;/p&gt;
&lt;p&gt;일단 책 보면서 유용하다 싶은 내용을 몇 가지 주제로 나눠 정리했다.&lt;/p&gt;</description></item></channel></rss>