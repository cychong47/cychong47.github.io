<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Http on Keep calm and Write something</title><link>https://cychong47.github.io/tags/http/</link><description>Recent content in Http on Keep calm and Write something</description><generator>Hugo</generator><language>en-us</language><lastBuildDate>Sun, 01 Apr 2018 02:38:51 +0000</lastBuildDate><atom:link href="https://cychong47.github.io/tags/http/index.xml" rel="self" type="application/rss+xml"/><item><title>Parsing http header with scary</title><link>https://cychong47.github.io/post/2017/parsing-http-header-with-scary/</link><pubDate>Sun, 01 Oct 2017 09:36:35 +0900</pubDate><guid>https://cychong47.github.io/post/2017/parsing-http-header-with-scary/</guid><description>&lt;h3 id="정규식으로-http-분석"&gt;정규식으로 http 분석&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;def processHTTP(data):

 str_method = &amp;quot;&amp;quot;
 str_uri = &amp;quot;&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id="정규표현식을-통해-넘어온-데이터에서-method-uri-http-버전-정보등으로-구분함"&gt;정규표현식을 통해 넘어온 데이터에서 METHOD, URI, HTTP 버전 정보등으로 구분함&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;h = re.search(&amp;quot;(?P&amp;lt;method&amp;gt;(^GET|^POST|^PUT|^DELETE)) (?P&amp;lt;uri&amp;gt;.+) (?P&amp;lt;version&amp;gt;.+)&amp;quot;, data)
if not h: return &amp;quot;Error&amp;quot; # 정규표현식에 해당하는 데이터가 없는 경우 Error 를 리턴해줌

# method 로 정의된 부준은 str_method 에 저장
if h.group(&amp;quot;method&amp;quot;): str_method = h.group(&amp;quot;method&amp;quot;)
# URI 데이터는 str_uri 에 저장
if h.group(&amp;quot;uri&amp;quot;): str_uri = h.group(&amp;quot;uri&amp;quot;)

return str_method,str_uri # method 와 uri 를 리턴해 줌
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;출처 : &lt;a href="http://www.packetinside.com/2010/11/scapy-"&gt;http://www.packetinside.com/2010/11/scapy-&lt;/a&gt;로-패킷-핸들링하는-프로그램-만들기-세번째.html?showComment=1423994884595&lt;/p&gt;</description></item><item><title>Google's Load Balancer</title><link>https://cychong47.github.io/post/2017/googles-load-balancer/</link><pubDate>Sun, 01 Oct 2017 08:34:30 +0900</pubDate><guid>https://cychong47.github.io/post/2017/googles-load-balancer/</guid><description>&lt;h1 id="maglev"&gt;Maglev&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Google( &lt;a href="https://research.google.com/pubs/pub44824.html"&gt;https://research.google.com/pubs/pub44824.html&lt;/a&gt; )&lt;/li&gt;
&lt;li&gt;Used in Google Cloud since 2008&lt;/li&gt;
&lt;li&gt;Scalable load balancer
&lt;ul&gt;
&lt;li&gt;Consistent hashing&lt;/li&gt;
&lt;li&gt;Connection Tracking&lt;/li&gt;
&lt;li&gt;Scale-out model backed by router&amp;rsquo;s ECMP&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Bypass kernel space for performance.&lt;/li&gt;
&lt;li&gt;Support connection persistence&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id="network-architecture"&gt;Network Architecture&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;DNS - Routers - Maglevs - Service EndPoints.&lt;/li&gt;
&lt;li&gt;One service is served by one or more VIPs
&lt;ul&gt;
&lt;li&gt;DNS returns VIP considering geolocation and load of location&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;One VIP is served by multiple Maglevs
&lt;ul&gt;
&lt;li&gt;Router use ECMP to select one Maglev&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;One VIP is mapped to multiple Service EndPoints
&lt;ul&gt;
&lt;li&gt;Maglev select Service EndPoint by seletion algorithm and connection tracking table&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Maglev use GRE to send incoming packet to Service EndPoint or another Maglev
&lt;ul&gt;
&lt;li&gt;Send to IP fragment to another special Maglev servers&lt;/li&gt;
&lt;li&gt;Use only 3-tuple for IP fragment&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Each Service EndPoint use Direct Server Return(DSR)&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id="maglev-1"&gt;Maglev&lt;/h1&gt;
&lt;h2 id="controller"&gt;Controller&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Responsible for VIP announcement with BGP&lt;/li&gt;
&lt;li&gt;Check health status of forwarder&lt;/li&gt;
&lt;li&gt;If forwarder is not headthy, withdraw all VIP announcements&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="forwarder"&gt;Forwarder&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Each VIP has one or multiple backend pools(BP)&lt;/li&gt;
&lt;li&gt;BP contain physical IP address of the Service EndPoint&lt;/li&gt;
&lt;li&gt;Each BP has specific health checking methods - depends on the service requirement(just reachability or more)&lt;/li&gt;
&lt;li&gt;Config Manager parse and update configuration of forwarder&amp;rsquo;s behavior based on the &lt;strong&gt;Config Objects&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Sharding
&lt;ul&gt;
&lt;li&gt;Sharding of Maglev enables service isolation - new service or QoS&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="backend-selection"&gt;Backend Selection&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Consistent Hashing distribute loads&lt;/li&gt;
&lt;li&gt;Record selection in &lt;strong&gt;LOCAL connection tracking table&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;Connection tracking table is &lt;strong&gt;not shared&lt;/strong&gt; with another Maglev&lt;/li&gt;
&lt;li&gt;Does not guarantee consistency on Maglev or Service EndPoint Changes(add/delete)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;For different traffic type
&lt;ul&gt;
&lt;li&gt;TCP SYN : select Backend and record it in connection tracking table&lt;/li&gt;
&lt;li&gt;TCP non-SYN : lookup connection tracking table&lt;/li&gt;
&lt;li&gt;5-tuple : (maybe) lookup connection tracking table and select backend if not found&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id="consistent-hashing"&gt;Consistent Hashing&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;If Maglev is added or removed, router select different Maglev for the exsiting session - ECMP is changed&lt;/li&gt;
&lt;li&gt;If one Maglev&amp;rsquo;s local connection tracking table is overflowed, it will lose previous selection&lt;/li&gt;
&lt;li&gt;To resolve this issues,
&lt;ul&gt;
&lt;li&gt;Synchronize local connection tracking table between Maglevs -&amp;gt; overhead, overhead, overhead&lt;/li&gt;
&lt;li&gt;Consistent hashing for minimize disruption in member changes&lt;/li&gt;
&lt;li&gt;Maglev hashing - load balancing and minimal disruption on member changes&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id="reference"&gt;reference&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://blog.acolyer.org/2016/03/21/maglev-a-fast-and-reliable-software-network-load-balancer/"&gt;Maglev: A Fast and Reliable Software Network Load Balancer&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://blog.carlosgaldino.com/consistent-hashing.html"&gt;Consistent Hashing&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://dzone.com/articles/simple-magic-consistent"&gt;The Simple Magic of Consistent Hashing&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description></item></channel></rss>